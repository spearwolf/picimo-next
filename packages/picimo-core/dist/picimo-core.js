!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("gl-matrix"),require("@picimo/utils")):"function"==typeof define&&define.amd?define(["exports","gl-matrix","@picimo/utils"],e):e(t.PicimoCore={},t.glMatrix,t.PicimoUtils)}(this,function(t,e,r){"use strict";var n=function(t){return"object"==typeof t?null!==t:"function"==typeof t},i=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t},o=function(t){try{return!!t()}catch(t){return!0}},a=!o(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a});function u(t,e){return t(e={exports:{}},e.exports),e.exports}var s=u(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),c=s.document,f=n(c)&&n(c.createElement),h=function(t){return f?c.createElement(t):{}},l=!a&&!o(function(){return 7!=Object.defineProperty(h("div"),"a",{get:function(){return 7}}).a}),v=function(t,e){if(!n(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!n(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")},d=Object.defineProperty,y={f:a?Object.defineProperty:function(t,e,r){if(i(t),e=v(e,!0),i(r),l)try{return d(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},p=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},g=a?function(t,e,r){return y.f(t,e,p(1,r))}:function(t,e,r){return t[e]=r,t},m={}.hasOwnProperty,w=function(t,e){return m.call(t,e)},b=0,x=Math.random(),A=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++b+x).toString(36))},O=u(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),E=(O.version,u(function(t){var e=A("src"),r=Function.toString,n=(""+r).split("toString");O.inspectSource=function(t){return r.call(t)},(t.exports=function(t,r,i,o){var a="function"==typeof i;a&&(w(i,"name")||g(i,"name",r)),t[r]!==i&&(a&&(w(i,e)||g(i,e,t[r]?""+t[r]:n.join(String(r)))),t===s?t[r]=i:o?t[r]?t[r]=i:g(t,r,i):(delete t[r],g(t,r,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||r.call(this)})})),_=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},S=u(function(t){var e=s["__core-js_shared__"]||(s["__core-js_shared__"]={});(t.exports=function(t,r){return e[t]||(e[t]=void 0!==r?r:{})})("versions",[]).push({version:O.version,mode:"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})}),k=u(function(t){var e=S("wks"),r=s.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:A)("Symbol."+t))}).store=e}),P=function(t,e,r){var n=k(t),i=r(_,n,""[t]),a=i[0],u=i[1];o(function(){var e={};return e[n]=function(){return 7},7!=""[t](e)})&&(E(String.prototype,t,a),g(RegExp.prototype,n,2==e?function(t,e){return u.call(t,this,e)}:function(t){return u.call(t,this)}))};P("match",1,function(t,e,r){return[function(r){var n=t(this),i=null==r?void 0:r[e];return void 0!==i?i.call(r,n):new RegExp(r)[e](String(n))},r]});var V=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},T=function(t,e,r){if(V(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,i){return t.call(e,r,n,i)}}return function(){return t.apply(e,arguments)}},L=function(t,e,r){var n,i,o,a,u=t&L.F,c=t&L.G,f=t&L.S,h=t&L.P,l=t&L.B,v=c?s:f?s[e]||(s[e]={}):(s[e]||{}).prototype,d=c?O:O[e]||(O[e]={}),y=d.prototype||(d.prototype={});for(n in c&&(r=e),r)o=((i=!u&&v&&void 0!==v[n])?v:r)[n],a=l&&i?T(o,s):h&&"function"==typeof o?T(Function.call,o):o,v&&E(v,n,o,t&L.U),d[n]!=o&&g(d,n,a),h&&y[n]!=o&&(y[n]=o)};s.core=O,L.F=1,L.G=2,L.S=4,L.P=8,L.B=16,L.W=32,L.U=64,L.R=128;var j=L,R="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",F="["+R+"]",I=RegExp("^"+F+F+"*"),M=RegExp(F+F+"*$"),C=function(t,e,r){var n={},i=o(function(){return!!R[t]()||"​"!="​"[t]()}),a=n[t]=i?e(N):R[t];r&&(n[r]=a),j(j.P+j.F*i,"String",n)},N=C.trim=function(t,e){return t=String(_(t)),1&e&&(t=t.replace(I,"")),2&e&&(t=t.replace(M,"")),t};C("trim",function(t){return function(){return t(this,3)}});var D=function(t){return"number"==typeof t},B=function(t,e){if(D(t)&&D(e))return t+e;if(D(t))switch(t){case 0:return e;default:return"".concat(t," + ").concat(e)}else{if(!D(e))return"".concat(t," + ").concat(e);switch(e){case 0:return t;default:return"".concat(t," + ").concat(e)}}},U=function(t,e){if(D(t)&&D(e))return t-e;if(D(t))switch(t){case 0:return"-".concat(e);default:return"".concat(t," - ").concat(e)}else{if(!D(e))return"".concat(t," - ").concat(e);switch(e){case 0:return t;default:return"".concat(t," - ").concat(e)}}},G=function(t,e){if(D(e)&&D(t))return t*e;if(D(t))switch(t){case 0:return 0;case 1:return e;default:return"".concat(t," * ").concat(e)}else{if(!D(e))return"".concat(t," * ").concat(e);switch(e){case 0:return 0;case 1:return t;default:return"".concat(t," * ").concat(e)}}},H=function(t){var e="".concat(t).trim();return e.match(/^[0-9]+$/)?"".concat(e,".0"):e},Y=function(t){return"return ".concat(t,";")},W=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,l=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,v=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,d=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,y=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1,p=(arguments.length>16&&void 0!==arguments[16]?arguments[16]:H)||function(t){return"".concat(t)};return"mat4(".concat(p(t),", ").concat(p(e),", ").concat(p(r),", ").concat(p(n),", ").concat(p(i),", ").concat(p(o),", ").concat(p(a),", ").concat(p(u),", ").concat(p(s),", ").concat(p(c),", ").concat(p(f),", ").concat(p(h),", ").concat(p(l),", ").concat(p(v),", ").concat(p(d),", ").concat(p(y),")")},X=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rotate",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"\nmat4 ".concat(t,"(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1.0 - c;\n  ").concat(Y(W(B(G("oc",e*e),"c"),U(G("oc",e*r),G(n,"s")),B(G("oc",n*e),G(r,"s")),0,B(G("oc",e*r),G(n,"s")),B(G("oc",r*r),"c"),U(G("oc",r*n),G(e,"s")),0,U(G("oc",n*e),G(r,"s")),B(G("oc",r*n),G(e,"s")),B(G("oc",n*n),"c"))),"\n}")},z=Object.freeze({add:B,sub:U,mul:G,asFloat:H,ret:Y,mat4:W,rotate:X,rotateZ:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rotateZ";return X(t,0,0,1)}});function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Z(t,e,r,n,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function q(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t){Z(o,n,i,a,u,"next",t)}function u(t){Z(o,n,i,a,u,"throw",t)}a(void 0)})}}function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function J(t,e,r){return e&&Q(t.prototype,e),r&&Q(t,r),t}function tt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rt(t,e)}function et(t){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t,e){return(rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function it(t,e,r){return(it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=et(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function ot(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var at=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$(this,t),e<r?(this.minX=e,this.maxX=r):(this.minX=r,this.maxX=e),n<i?(this.minY=n,this.maxY=i):(this.minY=i,this.maxY=n)}return J(t,[{key:"addPoint",value:function(t,e){t<this.minX?this.minX=t:t>this.maxX&&(this.maxX=t),e<this.minY?this.minY=e:e>this.maxY&&(this.maxY=e)}},{key:"isInside",value:function(t,e){return t>=this.minX&&t<this.maxX&&e>=this.minY&&e<this.maxY}},{key:"isIntersection",value:function(t){return!(t.maxX<=this.minX||t.minX>=this.maxX||t.maxY<=this.minY||t.minY>=this.maxY)}},{key:"width",get:function(){return this.maxX-this.minX},set:function(t){this.maxX=this.minX+t}},{key:"height",get:function(){return this.maxY-this.minY},set:function(t){this.maxY=this.minY+t}},{key:"centerX",get:function(){return this.minX+(this.maxX-this.minX)/2}},{key:"centerY",get:function(){return this.minY+(this.maxY-this.minY)/2}}]),t}(),ut=function(){var t=i(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};a&&"g"!=/./g.flags&&y.f(RegExp.prototype,"flags",{configurable:!0,get:ut});var st=/./.toString,ct=function(t){E(RegExp.prototype,"toString",t,!0)};o(function(){return"/a/b"!=st.call({source:"a",flags:"b"})})?ct(function(){var t=i(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?ut.call(t):void 0)}):"toString"!=st.name&&ct(function(){return st.call(this)});var ft=Date.prototype,ht=ft.toString,lt=ft.getTime;new Date(NaN)+""!="Invalid Date"&&E(ft,"toString",function(){var t=lt.call(this);return t==t?ht.call(this):"Invalid Date"}),P("replace",2,function(t,e,r){return[function(n,i){var o=t(this),a=null==n?void 0:n[e];return void 0!==a?a.call(n,o,i):r.call(String(o),n,i)},r]});for(var vt,dt=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})},yt=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;$(this,t),this.type=e,this.data_=r,this.id=n&&n.id?String(n.id):dt(),this.serial=n&&"number"==typeof n.serial?n.serial:1,this.hints=n}return J(t,[{key:"touch",value:function(){this.serial++}},{key:"isSynced",value:function(t){var e=this.serial;return e>0&&e===t.serial}},{key:"needSync",value:function(t){return!this.isSynced(t)}},{key:"sync",value:function(t,e){this.needSync(t)&&(e(this.data),this.serial=t.serial)}},{key:"hasHint",value:function(t,e){return 1===arguments.length?Boolean(this.hints&&t in this.hints):Boolean(this.hints&&t in this.hints&&this.hints[t]===e)}},{key:"hint",value:function(t){return this.hints&&this.hints[t]}},{key:"data",get:function(){return this.data_},set:function(t){t!==this.data_&&(this.data_=t,this.touch())}}]),t}(),pt=A("typed_array"),gt=A("view"),mt=!(!s.ArrayBuffer||!s.DataView),wt=mt,bt=0,xt="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");bt<9;)(vt=s[xt[bt++]])?(g(vt.prototype,pt,!0),g(vt.prototype,gt,!0)):wt=!1;var At={ABV:mt,CONSTR:wt,TYPED:pt,VIEW:gt},Ot=function(t,e,r){for(var n in e)E(t,n,e[n],r);return t},Et=function(t,e,r,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(r+": incorrect invocation!");return t},_t=Math.ceil,St=Math.floor,kt=function(t){return isNaN(t=+t)?0:(t>0?St:_t)(t)},Pt=Math.min,Vt=function(t){return t>0?Pt(kt(t),9007199254740991):0},Tt=function(t){if(void 0===t)return 0;var e=kt(t),r=Vt(e);if(e!==r)throw RangeError("Wrong length!");return r},Lt={}.toString,jt=function(t){return Lt.call(t).slice(8,-1)},Rt=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==jt(t)?t.split(""):Object(t)},Ft=function(t){return Rt(_(t))},It=Math.max,Mt=Math.min,Ct=function(t,e){return(t=kt(t))<0?It(t+e,0):Mt(t,e)},Nt=function(t){return function(e,r,n){var i,o=Ft(e),a=Vt(o.length),u=Ct(n,a);if(t&&r!=r){for(;a>u;)if((i=o[u++])!=i)return!0}else for(;a>u;u++)if((t||u in o)&&o[u]===r)return t||u||0;return!t&&-1}},Dt=S("keys"),Bt=function(t){return Dt[t]||(Dt[t]=A(t))},Ut=Nt(!1),Gt=Bt("IE_PROTO"),Ht=function(t,e){var r,n=Ft(t),i=0,o=[];for(r in n)r!=Gt&&w(n,r)&&o.push(r);for(;e.length>i;)w(n,r=e[i++])&&(~Ut(o,r)||o.push(r));return o},Yt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Wt=Yt.concat("length","prototype"),Xt={f:Object.getOwnPropertyNames||function(t){return Ht(t,Wt)}},zt=function(t){return Object(_(t))},Kt=function(t){for(var e=zt(this),r=Vt(e.length),n=arguments.length,i=Ct(n>1?arguments[1]:void 0,r),o=n>2?arguments[2]:void 0,a=void 0===o?r:Ct(o,r);a>i;)e[i++]=t;return e},Zt=y.f,qt=k("toStringTag"),$t=function(t,e,r){t&&!w(t=r?t:t.prototype,qt)&&Zt(t,qt,{configurable:!0,value:e})},Qt=u(function(t,e){var r=Xt.f,n=y.f,i="prototype",u="Wrong index!",c=s.ArrayBuffer,f=s.DataView,h=s.Math,l=s.RangeError,v=s.Infinity,d=c,p=h.abs,m=h.pow,w=h.floor,b=h.log,x=h.LN2,A=a?"_b":"buffer",O=a?"_l":"byteLength",E=a?"_o":"byteOffset";function _(t,e,r){var n,i,o,a=new Array(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?m(2,-24)-m(2,-77):0,h=0,l=t<0||0===t&&1/t<0?1:0;for((t=p(t))!=t||t===v?(i=t!=t?1:0,n=s):(n=w(b(t)/x),t*(o=m(2,-n))<1&&(n--,o*=2),(t+=n+c>=1?f/o:f*m(2,1-c))*o>=2&&(n++,o/=2),n+c>=s?(i=0,n=s):n+c>=1?(i=(t*o-1)*m(2,e),n+=c):(i=t*m(2,c-1)*m(2,e),n=0));e>=8;a[h++]=255&i,i/=256,e-=8);for(n=n<<e|i,u+=e;u>0;a[h++]=255&n,n/=256,u-=8);return a[--h]|=128*l,a}function S(t,e,r){var n,i=8*r-e-1,o=(1<<i)-1,a=o>>1,u=i-7,s=r-1,c=t[s--],f=127&c;for(c>>=7;u>0;f=256*f+t[s],s--,u-=8);for(n=f&(1<<-u)-1,f>>=-u,u+=e;u>0;n=256*n+t[s],s--,u-=8);if(0===f)f=1-a;else{if(f===o)return n?NaN:c?-v:v;n+=m(2,e),f-=a}return(c?-1:1)*n*m(2,f-e)}function k(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function P(t){return[255&t]}function V(t){return[255&t,t>>8&255]}function T(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function L(t){return _(t,52,8)}function j(t){return _(t,23,4)}function R(t,e,r){n(t[i],e,{get:function(){return this[r]}})}function F(t,e,r,n){var i=Tt(+r);if(i+e>t[O])throw l(u);var o=t[A]._b,a=i+t[E],s=o.slice(a,a+e);return n?s:s.reverse()}function I(t,e,r,n,i,o){var a=Tt(+r);if(a+e>t[O])throw l(u);for(var s=t[A]._b,c=a+t[E],f=n(+i),h=0;h<e;h++)s[c+h]=f[o?h:e-h-1]}if(At.ABV){if(!o(function(){c(1)})||!o(function(){new c(-1)})||o(function(){return new c,new c(1.5),new c(NaN),"ArrayBuffer"!=c.name})){for(var M,C=(c=function(t){return Et(this,c),new d(Tt(t))})[i]=d[i],N=r(d),D=0;N.length>D;)(M=N[D++])in c||g(c,M,d[M]);C.constructor=c}var B=new f(new c(2)),U=f[i].setInt8;B.setInt8(0,2147483648),B.setInt8(1,2147483649),!B.getInt8(0)&&B.getInt8(1)||Ot(f[i],{setInt8:function(t,e){U.call(this,t,e<<24>>24)},setUint8:function(t,e){U.call(this,t,e<<24>>24)}},!0)}else c=function(t){Et(this,c,"ArrayBuffer");var e=Tt(t);this._b=Kt.call(new Array(e),0),this[O]=e},f=function(t,e,r){Et(this,f,"DataView"),Et(t,c,"DataView");var n=t[O],i=kt(e);if(i<0||i>n)throw l("Wrong offset!");if(i+(r=void 0===r?n-i:Vt(r))>n)throw l("Wrong length!");this[A]=t,this[E]=i,this[O]=r},a&&(R(c,"byteLength","_l"),R(f,"buffer","_b"),R(f,"byteLength","_l"),R(f,"byteOffset","_o")),Ot(f[i],{getInt8:function(t){return F(this,1,t)[0]<<24>>24},getUint8:function(t){return F(this,1,t)[0]},getInt16:function(t){var e=F(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=F(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return k(F(this,4,t,arguments[1]))},getUint32:function(t){return k(F(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return S(F(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return S(F(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){I(this,1,t,P,e)},setUint8:function(t,e){I(this,1,t,P,e)},setInt16:function(t,e){I(this,2,t,V,e,arguments[2])},setUint16:function(t,e){I(this,2,t,V,e,arguments[2])},setInt32:function(t,e){I(this,4,t,T,e,arguments[2])},setUint32:function(t,e){I(this,4,t,T,e,arguments[2])},setFloat32:function(t,e){I(this,4,t,j,e,arguments[2])},setFloat64:function(t,e){I(this,8,t,L,e,arguments[2])}});$t(c,"ArrayBuffer"),$t(f,"DataView"),g(f[i],At.VIEW,!0),e.ArrayBuffer=c,e.DataView=f}),Jt=k("toStringTag"),te="Arguments"==jt(function(){return arguments}()),ee=function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Jt))?r:te?jt(e):"Object"==(n=jt(e))&&"function"==typeof e.callee?"Arguments":n},re={},ne=k("iterator"),ie=Array.prototype,oe=function(t){return void 0!==t&&(re.Array===t||ie[ne]===t)},ae=Object.keys||function(t){return Ht(t,Yt)},ue=a?Object.defineProperties:function(t,e){i(t);for(var r,n=ae(e),o=n.length,a=0;o>a;)y.f(t,r=n[a++],e[r]);return t},se=s.document,ce=se&&se.documentElement,fe=Bt("IE_PROTO"),he=function(){},le=function(){var t,e=h("iframe"),r=Yt.length;for(e.style.display="none",ce.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),le=t.F;r--;)delete le.prototype[Yt[r]];return le()},ve=Object.create||function(t,e){var r;return null!==t?(he.prototype=i(t),r=new he,he.prototype=null,r[fe]=t):r=le(),void 0===e?r:ue(r,e)},de=Bt("IE_PROTO"),ye=Object.prototype,pe=Object.getPrototypeOf||function(t){return t=zt(t),w(t,de)?t[de]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ye:null},ge=k("iterator"),me=O.getIteratorMethod=function(t){if(null!=t)return t[ge]||t["@@iterator"]||re[ee(t)]},we=Array.isArray||function(t){return"Array"==jt(t)},be=k("species"),xe=function(t,e){return new(function(t){var e;return we(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!we(e.prototype)||(e=void 0),n(e)&&null===(e=e[be])&&(e=void 0)),void 0===e?Array:e}(t))(e)},Ae=function(t,e){var r=1==t,n=2==t,i=3==t,o=4==t,a=6==t,u=5==t||a,s=e||xe;return function(e,c,f){for(var h,l,v=zt(e),d=Rt(v),y=T(c,f,3),p=Vt(d.length),g=0,m=r?s(e,p):n?s(e,0):void 0;p>g;g++)if((u||g in d)&&(l=y(h=d[g],g,v),t))if(r)m[g]=l;else if(l)switch(t){case 3:return!0;case 5:return h;case 6:return g;case 2:m.push(h)}else if(o)return!1;return a?-1:i||o?o:m}},Oe=k("species"),Ee=function(t,e){var r,n=i(t).constructor;return void 0===n||null==(r=i(n)[Oe])?e:V(r)},_e=k("unscopables"),Se=Array.prototype;null==Se[_e]&&g(Se,_e,{});var ke=function(t){Se[_e][t]=!0},Pe=function(t,e){return{value:e,done:!!t}},Ve={};g(Ve,k("iterator"),function(){return this});var Te=function(t,e,r){t.prototype=ve(Ve,{next:p(1,r)}),$t(t,e+" Iterator")},Le=k("iterator"),je=!([].keys&&"next"in[].keys()),Re=function(){return this},Fe=function(t,e,r,n,i,o,a){Te(r,e,n);var u,s,c,f=function(t){if(!je&&t in d)return d[t];switch(t){case"keys":case"values":return function(){return new r(this,t)}}return function(){return new r(this,t)}},h=e+" Iterator",l="values"==i,v=!1,d=t.prototype,y=d[Le]||d["@@iterator"]||i&&d[i],p=y||f(i),m=i?l?f("entries"):p:void 0,w="Array"==e&&d.entries||y;if(w&&(c=pe(w.call(new t)))!==Object.prototype&&c.next&&($t(c,h,!0),"function"!=typeof c[Le]&&g(c,Le,Re)),l&&y&&"values"!==y.name&&(v=!0,p=function(){return y.call(this)}),(je||v||!d[Le])&&g(d,Le,p),re[e]=p,re[h]=Re,i)if(u={values:l?p:f("values"),keys:o?p:f("keys"),entries:m},a)for(s in u)s in d||E(d,s,u[s]);else j(j.P+j.F*(je||v),e,u);return u},Ie=Fe(Array,"Array",function(t,e){this._t=Ft(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,Pe(1)):Pe(0,"keys"==e?r:"values"==e?t[r]:[r,t[r]])},"values");re.Arguments=re.Array,ke("keys"),ke("values"),ke("entries");var Me=k("iterator"),Ce=!1;try{[7][Me]().return=function(){Ce=!0}}catch(t){}var Ne=function(t,e){if(!e&&!Ce)return!1;var r=!1;try{var n=[7],i=n[Me]();i.next=function(){return{done:r=!0}},n[Me]=function(){return i},t(n)}catch(t){}return r},De=k("species"),Be=function(t){var e=s[t];a&&e&&!e[De]&&y.f(e,De,{configurable:!0,get:function(){return this}})},Ue=[].copyWithin||function(t,e){var r=zt(this),n=Vt(r.length),i=Ct(t,n),o=Ct(e,n),a=arguments.length>2?arguments[2]:void 0,u=Math.min((void 0===a?n:Ct(a,n))-o,n-i),s=1;for(o<i&&i<o+u&&(s=-1,o+=u-1,i+=u-1);u-- >0;)o in r?r[i]=r[o]:delete r[i],i+=s,o+=s;return r},Ge={f:{}.propertyIsEnumerable},He=Object.getOwnPropertyDescriptor,Ye={f:a?He:function(t,e){if(t=Ft(t),e=v(e,!0),l)try{return He(t,e)}catch(t){}if(w(t,e))return p(!Ge.f.call(t,e),t[e])}},We=u(function(t){if(a){var e=s,r=o,i=j,u=At,c=Qt,f=T,h=Et,l=p,d=g,m=Ot,b=kt,x=Vt,O=Tt,E=Ct,_=v,S=w,P=ee,V=n,L=zt,R=oe,F=ve,I=pe,M=Xt.f,C=me,N=A,D=k,B=Ae,U=Nt,G=Ee,H=Ie,Y=re,W=Ne,X=Be,z=Kt,K=Ue,Z=y,q=Ye,$=Z.f,Q=q.f,J=e.RangeError,tt=e.TypeError,et=e.Uint8Array,rt=Array.prototype,nt=c.ArrayBuffer,it=c.DataView,ot=B(0),at=B(2),ut=B(3),st=B(4),ct=B(5),ft=B(6),ht=U(!0),lt=U(!1),vt=H.values,dt=H.keys,yt=H.entries,pt=rt.lastIndexOf,gt=rt.reduce,mt=rt.reduceRight,wt=rt.join,bt=rt.sort,xt=rt.slice,_t=rt.toString,St=rt.toLocaleString,Pt=D("iterator"),Lt=D("toStringTag"),jt=N("typed_constructor"),Rt=N("def_constructor"),Ft=u.CONSTR,It=u.TYPED,Mt=u.VIEW,Dt=B(1,function(t,e){return Yt(G(t,t[Rt]),e)}),Bt=r(function(){return 1===new et(new Uint16Array([1]).buffer)[0]}),Ut=!!et&&!!et.prototype.set&&r(function(){new et(1).set({})}),Gt=function(t,e){var r=b(t);if(r<0||r%e)throw J("Wrong offset!");return r},Ht=function(t){if(V(t)&&It in t)return t;throw tt(t+" is not a typed array!")},Yt=function(t,e){if(!(V(t)&&jt in t))throw tt("It is not a typed array constructor!");return new t(e)},Wt=function(t,e){return Zt(G(t,t[Rt]),e)},Zt=function(t,e){for(var r=0,n=e.length,i=Yt(t,n);n>r;)i[r]=e[r++];return i},qt=function(t,e,r){$(t,e,{get:function(){return this._d[r]}})},$t=function(t){var e,r,n,i,o,a,u=L(t),s=arguments.length,c=s>1?arguments[1]:void 0,h=void 0!==c,l=C(u);if(null!=l&&!R(l)){for(a=l.call(u),n=[],e=0;!(o=a.next()).done;e++)n.push(o.value);u=n}for(h&&s>2&&(c=f(c,arguments[2],2)),e=0,r=x(u.length),i=Yt(this,r);r>e;e++)i[e]=h?c(u[e],e):u[e];return i},Jt=function(){for(var t=0,e=arguments.length,r=Yt(this,e);e>t;)r[t]=arguments[t++];return r},te=!!et&&r(function(){St.call(new et(1))}),ne=function(){return St.apply(te?xt.call(Ht(this)):Ht(this),arguments)},ie={copyWithin:function(t,e){return K.call(Ht(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return st(Ht(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return z.apply(Ht(this),arguments)},filter:function(t){return Wt(this,at(Ht(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return ct(Ht(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return ft(Ht(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){ot(Ht(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return lt(Ht(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ht(Ht(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return wt.apply(Ht(this),arguments)},lastIndexOf:function(t){return pt.apply(Ht(this),arguments)},map:function(t){return Dt(Ht(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return gt.apply(Ht(this),arguments)},reduceRight:function(t){return mt.apply(Ht(this),arguments)},reverse:function(){for(var t,e=Ht(this).length,r=Math.floor(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this},some:function(t){return ut(Ht(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return bt.call(Ht(this),t)},subarray:function(t,e){var r=Ht(this),n=r.length,i=E(t,n);return new(G(r,r[Rt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,x((void 0===e?n:E(e,n))-i))}},ae=function(t,e){return Wt(this,xt.call(Ht(this),t,e))},ue=function(t){Ht(this);var e=Gt(arguments[1],1),r=this.length,n=L(t),i=x(n.length),o=0;if(i+e>r)throw J("Wrong length!");for(;o<i;)this[e+o]=n[o++]},se={entries:function(){return yt.call(Ht(this))},keys:function(){return dt.call(Ht(this))},values:function(){return vt.call(Ht(this))}},ce=function(t,e){return V(t)&&t[It]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},fe=function(t,e){return ce(t,e=_(e,!0))?l(2,t[e]):Q(t,e)},he=function(t,e,r){return!(ce(t,e=_(e,!0))&&V(r)&&S(r,"value"))||S(r,"get")||S(r,"set")||r.configurable||S(r,"writable")&&!r.writable||S(r,"enumerable")&&!r.enumerable?$(t,e,r):(t[e]=r.value,t)};Ft||(q.f=fe,Z.f=he),i(i.S+i.F*!Ft,"Object",{getOwnPropertyDescriptor:fe,defineProperty:he}),r(function(){_t.call({})})&&(_t=St=function(){return wt.call(this)});var le=m({},ie);m(le,se),d(le,Pt,se.values),m(le,{slice:ae,set:ue,constructor:function(){},toString:_t,toLocaleString:ne}),qt(le,"buffer","b"),qt(le,"byteOffset","o"),qt(le,"byteLength","l"),qt(le,"length","e"),$(le,Lt,{get:function(){return this[It]}}),t.exports=function(t,n,o,a){var s=t+((a=!!a)?"Clamped":"")+"Array",c="get"+t,f="set"+t,l=e[s],v=l||{},y=l&&I(l),p=!l||!u.ABV,g={},m=l&&l.prototype,w=function(t,e){$(t,e,{get:function(){return function(t,e){var r=t._d;return r.v[c](e*n+r.o,Bt)}(this,e)},set:function(t){return function(t,e,r){var i=t._d;a&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[f](e*n+i.o,r,Bt)}(this,e,t)},enumerable:!0})};p?(l=o(function(t,e,r,i){h(t,l,s,"_d");var o,a,u,c,f=0,v=0;if(V(e)){if(!(e instanceof nt||"ArrayBuffer"==(c=P(e))||"SharedArrayBuffer"==c))return It in e?Zt(l,e):$t.call(l,e);o=e,v=Gt(r,n);var y=e.byteLength;if(void 0===i){if(y%n)throw J("Wrong length!");if((a=y-v)<0)throw J("Wrong length!")}else if((a=x(i)*n)+v>y)throw J("Wrong length!");u=a/n}else u=O(e),o=new nt(a=u*n);for(d(t,"_d",{b:o,o:v,l:a,e:u,v:new it(o)});f<u;)w(t,f++)}),m=l.prototype=F(le),d(m,"constructor",l)):r(function(){l(1)})&&r(function(){new l(-1)})&&W(function(t){new l,new l(null),new l(1.5),new l(t)},!0)||(l=o(function(t,e,r,i){var o;return h(t,l,s),V(e)?e instanceof nt||"ArrayBuffer"==(o=P(e))||"SharedArrayBuffer"==o?void 0!==i?new v(e,Gt(r,n),i):void 0!==r?new v(e,Gt(r,n)):new v(e):It in e?Zt(l,e):$t.call(l,e):new v(O(e))}),ot(y!==Function.prototype?M(v).concat(M(y)):M(v),function(t){t in l||d(l,t,v[t])}),l.prototype=m,m.constructor=l);var b=m[Pt],A=!!b&&("values"==b.name||null==b.name),E=se.values;d(l,jt,!0),d(m,It,s),d(m,Mt,!0),d(m,Rt,l),(a?new l(1)[Lt]==s:Lt in m)||$(m,Lt,{get:function(){return s}}),g[s]=l,i(i.G+i.W+i.F*(l!=v),g),i(i.S,s,{BYTES_PER_ELEMENT:n}),i(i.S+i.F*r(function(){v.of.call(l,1)}),s,{from:$t,of:Jt}),"BYTES_PER_ELEMENT"in m||d(m,"BYTES_PER_ELEMENT",n),i(i.P,s,ie),X(s),i(i.P+i.F*Ut,s,{set:ue}),i(i.P+i.F*!A,s,se),m.toString!=_t&&(m.toString=_t),i(i.P+i.F*r(function(){new l(1).slice()}),s,{slice:ae}),i(i.P+i.F*(r(function(){return[1,2].toLocaleString()!=new l([1,2]).toLocaleString()})||!r(function(){m.toLocaleString.call([1,2])})),s,{toLocaleString:ne}),Y[s]=A?b:E,A||d(m,Pt,E)}}else t.exports=function(){}});We("Uint16",2,function(t){return function(e,r,n){return t(this,e,r,n)}});var Xe,ze,Ke,Ze=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"static";$(this,t),this.objectCount=e,this.itemCount=r,this.length=e*r,this.array=new Uint16Array(this.length),this.ref=new yt("ElementIndexArray",this,{usage:n,target:"ELEMENT_ARRAY_BUFFER",typedArray:this.array})}return J(t,null,[{key:"Generate",value:function(e,r,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"static",a=new t(e,r.length,o),u=0;u<e;++u)for(var s=0;s<r.length;++s)a.array[u*a.itemCount+s]=r[s]+(u+i)*n;return a}}]),t}(),qe=function(){function t(e,r){$(this,t),this.primitiveType=e,this.elementIndexArray=r}return J(t,null,[{key:"createQuads",value:function(e){return new t("TRIANGLES",Ze.Generate(e,[0,1,2,0,2,3],4))}}]),t}(),$e=Math.PI/180,Qe=function(){function t(){$(this,t),this.mat4=e.mat4.create()}return J(t,[{key:"identity",value:function(){e.mat4.identity(this.mat4)}},{key:"ortho",value:function(t,r){var n=t>>1,i=r>>1,o=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(2,16))>>1;e.mat4.ortho(this.mat4,-n,n,-i,i,-o,o)}},{key:"perspective",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=t/r,o=r/2,a=2*Math.atan(o/n);e.mat4.perspective(this.mat4,a,i,0,2e3),e.mat4.translate(this.mat4,this.mat4,[0,0,-n])}},{key:"translate",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.mat4.translate(this.mat4,this.mat4,[t,r,n])}},{key:"scale",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;e.mat4.scale(this.mat4,this.mat4,[t,r,n])}},{key:"rotateX",value:function(t){e.mat4.rotateX(this.mat4,this.mat4,t*$e)}},{key:"rotateY",value:function(t){e.mat4.rotateY(this.mat4,this.mat4,t*$e)}},{key:"rotateZ",value:function(t){e.mat4.rotateZ(this.mat4,this.mat4,t*$e)}},{key:"multiply",value:function(t,r){e.mat4.multiply(this.mat4,t.mat4,r.mat4)}},{key:"copy",value:function(t){e.mat4.copy(this.mat4,t.mat4)}},{key:"clone",value:function(){var e=new t;return e.copy(this),e}},{key:"x",get:function(){return this.mat4[12]},set:function(t){this.mat4[12]=t}},{key:"y",get:function(){return this.mat4[13]},set:function(t){this.mat4[13]=t}},{key:"z",get:function(){return this.mat4[14]},set:function(t){this.mat4[14]=t}},{key:"sx",get:function(){return this.mat4[0]},set:function(t){this.mat4[0]=t}},{key:"sy",get:function(){return this.mat4[5]},set:function(t){this.mat4[5]=t}},{key:"sz",get:function(){return this.mat4[10]},set:function(t){this.mat4[10]=t}}]),t}(),Je=function(t,e,r,n){try{return n?e(i(r)[0],r[1]):e(r)}catch(e){var o=t.return;throw void 0!==o&&i(o.call(t)),e}},tr=u(function(t){var e={},r={},n=t.exports=function(t,n,o,a,u){var s,c,f,h,l=u?function(){return t}:me(t),v=T(o,a,n?2:1),d=0;if("function"!=typeof l)throw TypeError(t+" is not iterable!");if(oe(l)){for(s=Vt(t.length);s>d;d++)if((h=n?v(i(c=t[d])[0],c[1]):v(t[d]))===e||h===r)return h}else for(f=l.call(t);!(c=f.next()).done;)if((h=Je(f,v,c.value,n))===e||h===r)return h};n.BREAK=e,n.RETURN=r}),er=function(t,e,r){var n=void 0===r;switch(e.length){case 0:return n?t():t.call(r);case 1:return n?t(e[0]):t.call(r,e[0]);case 2:return n?t(e[0],e[1]):t.call(r,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(r,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(r,e[0],e[1],e[2],e[3])}return t.apply(r,e)},rr=s.process,nr=s.setImmediate,ir=s.clearImmediate,or=s.MessageChannel,ar=s.Dispatch,ur=0,sr={},cr=function(){var t=+this;if(sr.hasOwnProperty(t)){var e=sr[t];delete sr[t],e()}},fr=function(t){cr.call(t.data)};nr&&ir||(nr=function(t){for(var e=[],r=1;arguments.length>r;)e.push(arguments[r++]);return sr[++ur]=function(){er("function"==typeof t?t:Function(t),e)},Xe(ur),ur},ir=function(t){delete sr[t]},"process"==jt(rr)?Xe=function(t){rr.nextTick(T(cr,t,1))}:ar&&ar.now?Xe=function(t){ar.now(T(cr,t,1))}:or?(Ke=(ze=new or).port2,ze.port1.onmessage=fr,Xe=T(Ke.postMessage,Ke,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(Xe=function(t){s.postMessage(t+"","*")},s.addEventListener("message",fr,!1)):Xe="onreadystatechange"in h("script")?function(t){ce.appendChild(h("script")).onreadystatechange=function(){ce.removeChild(this),cr.call(t)}}:function(t){setTimeout(T(cr,t,1),0)});var hr={set:nr,clear:ir},lr=hr.set,vr=s.MutationObserver||s.WebKitMutationObserver,dr=s.process,yr=s.Promise,pr="process"==jt(dr);function gr(t){var e,r;this.promise=new t(function(t,n){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=n}),this.resolve=V(e),this.reject=V(r)}var mr,wr,br,xr,Ar={f:function(t){return new gr(t)}},Or=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},Er=s.navigator,_r=Er&&Er.userAgent||"",Sr=hr.set,kr=function(){var t,e,r,n=function(){var n,i;for(pr&&(n=dr.domain)&&n.exit();t;){i=t.fn,t=t.next;try{i()}catch(n){throw t?r():e=void 0,n}}e=void 0,n&&n.enter()};if(pr)r=function(){dr.nextTick(n)};else if(!vr||s.navigator&&s.navigator.standalone)if(yr&&yr.resolve){var i=yr.resolve(void 0);r=function(){i.then(n)}}else r=function(){lr.call(s,n)};else{var o=!0,a=document.createTextNode("");new vr(n).observe(a,{characterData:!0}),r=function(){a.data=o=!o}}return function(n){var i={fn:n,next:void 0};e&&(e.next=i),t||(t=i,r()),e=i}}(),Pr=s.TypeError,Vr=s.process,Tr=Vr&&Vr.versions,Lr=Tr&&Tr.v8||"",jr=s.Promise,Rr="process"==ee(Vr),Fr=function(){},Ir=wr=Ar.f,Mr=!!function(){try{var t=jr.resolve(1),e=(t.constructor={})[k("species")]=function(t){t(Fr,Fr)};return(Rr||"function"==typeof PromiseRejectionEvent)&&t.then(Fr)instanceof e&&0!==Lr.indexOf("6.6")&&-1===_r.indexOf("Chrome/66")}catch(t){}}(),Cr=function(t){var e;return!(!n(t)||"function"!=typeof(e=t.then))&&e},Nr=function(t,e){if(!t._n){t._n=!0;var r=t._c;kr(function(){for(var n=t._v,i=1==t._s,o=0,a=function(e){var r,o,a,u=i?e.ok:e.fail,s=e.resolve,c=e.reject,f=e.domain;try{u?(i||(2==t._h&&Ur(t),t._h=1),!0===u?r=n:(f&&f.enter(),r=u(n),f&&(f.exit(),a=!0)),r===e.promise?c(Pr("Promise-chain cycle")):(o=Cr(r))?o.call(r,s,c):s(r)):c(n)}catch(t){f&&!a&&f.exit(),c(t)}};r.length>o;)a(r[o++]);t._c=[],t._n=!1,e&&!t._h&&Dr(t)})}},Dr=function(t){Sr.call(s,function(){var e,r,n,i=t._v,o=Br(t);if(o&&(e=Or(function(){Rr?Vr.emit("unhandledRejection",i,t):(r=s.onunhandledrejection)?r({promise:t,reason:i}):(n=s.console)&&n.error&&n.error("Unhandled promise rejection",i)}),t._h=Rr||Br(t)?2:1),t._a=void 0,o&&e.e)throw e.v})},Br=function(t){return 1!==t._h&&0===(t._a||t._c).length},Ur=function(t){Sr.call(s,function(){var e;Rr?Vr.emit("rejectionHandled",t):(e=s.onrejectionhandled)&&e({promise:t,reason:t._v})})},Gr=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Nr(e,!0))},Hr=function(t){var e,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw Pr("Promise can't be resolved itself");(e=Cr(t))?kr(function(){var n={_w:r,_d:!1};try{e.call(t,T(Hr,n,1),T(Gr,n,1))}catch(t){Gr.call(n,t)}}):(r._v=t,r._s=1,Nr(r,!1))}catch(t){Gr.call({_w:r,_d:!1},t)}}};function Yr(t,e){var n,i,o,a;t.imgEl=r.isPowerOf2(e.width)&&r.isPowerOf2(e.height)?e:(n=e,i=r.findNextPowerOf2(n.width),o=r.findNextPowerOf2(n.height),(a=document.createElement("canvas")).width=i,a.height=o,a.getContext("2d").drawImage(n,0,0),a),t.origWidth=e.width,t.origHeight=e.height}Mr||(jr=function(t){Et(this,jr,"Promise","_h"),V(t),mr.call(this);try{t(T(Hr,this,1),T(Gr,this,1))}catch(t){Gr.call(this,t)}},(mr=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=Ot(jr.prototype,{then:function(t,e){var r=Ir(Ee(this,jr));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=Rr?Vr.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&Nr(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),br=function(){var t=new mr;this.promise=t,this.resolve=T(Hr,t,1),this.reject=T(Gr,t,1)},Ar.f=Ir=function(t){return t===jr||t===xr?new br(t):wr(t)}),j(j.G+j.W+j.F*!Mr,{Promise:jr}),$t(jr,"Promise"),Be("Promise"),xr=O.Promise,j(j.S+j.F*!Mr,"Promise",{reject:function(t){var e=Ir(this);return(0,e.reject)(t),e.promise}}),j(j.S+j.F*!Mr,"Promise",{resolve:function(t){return function(t,e){if(i(t),n(e)&&e.constructor===t)return e;var r=Ar.f(t);return(0,r.resolve)(e),r.promise}(this,t)}}),j(j.S+j.F*!(Mr&&Ne(function(t){jr.all(t).catch(Fr)})),"Promise",{all:function(t){var e=this,r=Ir(e),n=r.resolve,i=r.reject,o=Or(function(){var r=[],o=0,a=1;tr(t,!1,function(t){var u=o++,s=!1;r.push(void 0),a++,e.resolve(t).then(function(t){s||(s=!0,r[u]=t,--a||n(r))},i)}),--a||n(r)});return o.e&&i(o.v),r.promise},race:function(t){var e=this,r=Ir(e),n=r.reject,i=Or(function(){tr(t,!1,function(t){e.resolve(t).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}});var Wr=function(){function t(e){var r,n=this;$(this,t),"string"==typeof e?(r=new window.Image).src=e:r=e,!1===r.onLoaded||0===r.width&&0===r.height?(this.imgEl=null,this.onLoaded=new Promise(function(t){var e=r.onload;r.onload=function(){e&&e.call(r),Yr(n,r),t(n)}})):(Yr(this,r),this.onLoaded=Promise.resolve(this))}return J(t,[{key:"isComplete",get:function(){return null!=this.imgEl}},{key:"width",get:function(){return this.imgEl&&this.imgEl.width||0}},{key:"height",get:function(){return this.imgEl&&this.imgEl.height||0}}]),t}(),Xr=function(){function t(e){var r=e.devicePixelRatio,n=e.fit,i=e.height,o=e.perspective,a=e.pixelRatio,u=e.width;$(this,t),this.desiredWidth=u||0,this.desiredHeight=i||0,this.desiredPixelRatio=a,this.customDevicePixelRatio=r,this.fit=n,this.perspective=o,this.lastPerspective=void 0,this.width=0,this.height=0,this.pixelRatio=0,this.rawWidth=0,this.rawHeight=0,this.mat4=new Qe}return J(t,[{key:"updateOrtho",value:function(t,e){var r=this.perspective;return(t!==this.width||e!==this.height||r!==this.lastPerspective)&&(this.width=t,this.height=e,this.lastPerspective=r,r>0?this.mat4.perspective(t,e,r):this.mat4.ortho(t,e),this.pixelRatio=this.rawHeight/e,!0)}},{key:"update",value:function(t,e){this.rawWidth=t,this.rawHeight=e;var r=this.desiredPixelRatio;if("number"==typeof r&&r>0){var n=this.devicePixelRatio*r,i=t/n,o=e/n;return this.updateOrtho(i,o)}if("fill"===this.fit&&this.desiredWidth>0&&this.desiredHeight>0)return this.updateOrtho(this.desiredWidth,this.desiredHeight);if(("cover"===this.fit||"contain"===this.fit)&&this.desiredWidth>=0&&this.desiredHeight>=0){var a=e/t,u=this.desiredHeight/this.desiredWidth,s="cover"===this.fit,c=this.desiredWidth,f=this.desiredHeight;if(0===this.desiredWidth&&this.desiredHeight||a<u||1===a&&u>1){if(c=this.desiredHeight/e*t,s){var h=this.desiredWidth/c;c*=h,f*=h}}else if((this.desiredWidth&&0===this.desiredHeight||a>u||1===a&&u<1)&&(f=this.desiredWidth/t*e,s)){var l=this.desiredHeight/f;c*=l,f*=l}return this.updateOrtho(c,f)}return!1}},{key:"devicePixelRatio",get:function(){return this.customDevicePixelRatio||window.devicePixelRatio||1}},{key:"perspective",set:function(t){this._perspective="number"==typeof t?Math.abs(t):0},get:function(){return this._perspective}}]),t}(),zr={f:Object.getOwnPropertySymbols},Kr=Object.assign,Zr=!Kr||o(function(){var t={},e={},r=Symbol(),n="abcdefghijklmnopqrst";return t[r]=7,n.split("").forEach(function(t){e[t]=t}),7!=Kr({},t)[r]||Object.keys(Kr({},e)).join("")!=n})?function(t,e){for(var r=zt(t),n=arguments.length,i=1,o=zr.f,a=Ge.f;n>i;)for(var u,s=Rt(arguments[i++]),c=o?ae(s).concat(o(s)):ae(s),f=c.length,h=0;f>h;)a.call(s,u=c[h++])&&(r[u]=s[u]);return r}:Kr;j(j.S+j.F,"Object",{assign:Zr});var qr=function(t){function e(t,r,n,i){var o;return $(this,e),(o=nt(this,et(e).call(this,r,n,Object.assign({serial:0},i)))).name=t,o}return tt(e,yt),e}();qr.UNIFORM="uniform",qr.ATTRIB="attrib",qr.TEXTURE_2D="tex2d";for(var $r=function(t){function e(t,r,n){return $(this,e),nt(this,et(e).call(this,t,qr.UNIFORM,r,n))}return tt(e,qr),e}(),Qr="projection",Jr=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qr;return $(this,e),nt(this,et(e).call(this,r,t.mat4,{projection:t}))}return tt(e,$r),J(e,[{key:"update",value:function(t,e){this.projection.update(t,e)&&this.touch()}},{key:"projection",get:function(){return this.hint("projection")}}]),e}(),tn=k("iterator"),en=k("toStringTag"),rn=re.Array,nn={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},on=ae(nn),an=0;an<on.length;an++){var un,sn=on[an],cn=nn[sn],fn=s[sn],hn=fn&&fn.prototype;if(hn&&(hn[tn]||g(hn,tn,rn),hn[en]||g(hn,en,sn),re[sn]=rn,cn))for(un in Ie)hn[un]||E(hn,un,Ie[un],!0)}var ln=function(t){return function(e,r){var n,i,o=String(_(e)),a=kt(r),u=o.length;return a<0||a>=u?t?"":void 0:(n=o.charCodeAt(a))<55296||n>56319||a+1===u||(i=o.charCodeAt(a+1))<56320||i>57343?t?o.charAt(a):n:t?o.slice(a,a+2):i-56320+(n-55296<<10)+65536}}(!0);Fe(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,r=this._i;return r>=e.length?{value:void 0,done:!0}:(t=ln(e,r),this._i+=t.length,{value:t,done:!1})});var vn=u(function(t){var e=A("meta"),r=y.f,i=0,a=Object.isExtensible||function(){return!0},u=!o(function(){return a(Object.preventExtensions({}))}),s=function(t){r(t,e,{value:{i:"O"+ ++i,w:{}}})},c=t.exports={KEY:e,NEED:!1,fastKey:function(t,r){if(!n(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!w(t,e)){if(!a(t))return"F";if(!r)return"E";s(t)}return t[e].i},getWeak:function(t,r){if(!w(t,e)){if(!a(t))return!0;if(!r)return!1;s(t)}return t[e].w},onFreeze:function(t){return u&&c.NEED&&a(t)&&!w(t,e)&&s(t),t}}}),dn=(vn.KEY,vn.NEED,vn.fastKey,vn.getWeak,vn.onFreeze,function(t,e){if(!n(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}),yn=y.f,pn=vn.fastKey,gn=a?"_s":"size",mn=function(t,e){var r,n=pn(e);if("F"!==n)return t._i[n];for(r=t._f;r;r=r.n)if(r.k==e)return r},wn={getConstructor:function(t,e,r,n){var i=t(function(t,o){Et(t,i,e,"_i"),t._t=e,t._i=ve(null),t._f=void 0,t._l=void 0,t[gn]=0,null!=o&&tr(o,r,t[n],t)});return Ot(i.prototype,{clear:function(){for(var t=dn(this,e),r=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];t._f=t._l=void 0,t[gn]=0},delete:function(t){var r=dn(this,e),n=mn(r,t);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[gn]--}return!!n},forEach:function(t){dn(this,e);for(var r,n=T(t,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(t){return!!mn(dn(this,e),t)}}),a&&yn(i.prototype,"size",{get:function(){return dn(this,e)[gn]}}),i},def:function(t,e,r){var n,i,o=mn(t,e);return o?o.v=r:(t._l=o={i:i=pn(e,!0),k:e,v:r,p:n=t._l,n:void 0,r:!1},t._f||(t._f=o),n&&(n.n=o),t[gn]++,"F"!==i&&(t._i[i]=o)),t},getEntry:mn,setStrong:function(t,e,r){Fe(t,e,function(t,r){this._t=dn(t,e),this._k=r,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?Pe(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,Pe(1))},r?"entries":"values",!r,!0),Be(e)}},bn=function(t,e){if(i(t),!n(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},xn={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{(r=T(Function.call,Ye.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return bn(t,n),e?t.__proto__=n:r(t,n),t}}({},!1):void 0),check:bn}.set,An=function(t,e,r){var i,o=e.constructor;return o!==r&&"function"==typeof o&&(i=o.prototype)!==r.prototype&&n(i)&&xn&&xn(t,i),t},On=(function(t,e,r,i,a,u){var c=s[t],f=c,h=a?"set":"add",l=f&&f.prototype,v={},d=function(t){var e=l[t];E(l,t,"delete"==t?function(t){return!(u&&!n(t))&&e.call(this,0===t?0:t)}:"has"==t?function(t){return!(u&&!n(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return u&&!n(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,r){return e.call(this,0===t?0:t,r),this})};if("function"==typeof f&&(u||l.forEach&&!o(function(){(new f).entries().next()}))){var y=new f,p=y[h](u?{}:-0,1)!=y,g=o(function(){y.has(1)}),m=Ne(function(t){new f(t)}),w=!u&&o(function(){for(var t=new f,e=5;e--;)t[h](e,e);return!t.has(-0)});m||((f=e(function(e,r){Et(e,f,t);var n=An(new c,e,f);return null!=r&&tr(r,a,n[h],n),n})).prototype=l,l.constructor=f),(g||w)&&(d("delete"),d("has"),a&&d("get")),(w||p)&&d(h),u&&l.clear&&delete l.clear}else f=i.getConstructor(e,t,a,h),Ot(f.prototype,r),vn.NEED=!0;$t(f,t),v[t]=f,j(j.G+j.W+j.F*(f!=c),v),u||i.setStrong(f,t,a)}("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=wn.getEntry(dn(this,"Map"),t);return e&&e.v},set:function(t,e){return wn.def(dn(this,"Map"),0===t?0:t,e)}},wn,!0),y.f),En=Function.prototype,_n=/^\s*function ([^ (]*)/;"name"in En||a&&On(En,"name",{configurable:!0,get:function(){try{return(""+this).match(_n)[1]}catch(t){return""}}});var Sn,kn,Pn,Vn;Sn="keys",kn=function(){return function(t){return ae(zt(t))}},Pn=(O.Object||{})[Sn]||Object[Sn],(Vn={})[Sn]=kn(Pn),j(j.S+j.F*o(function(){Pn(1)}),"Object",Vn);var Tn=function(t,e){return!!t&&o(function(){e?t.call(null,function(){},1):t.call(null)})},Ln=Ae(0),jn=Tn([].forEach,!0);j(j.P+j.F*!jn,"Array",{forEach:function(t){return Ln(this,t,arguments[1])}}),j(j.S,"Object",{create:ve}),j(j.G+j.W+j.F*!At.ABV,{DataView:Qt.DataView}),We("Uint8",1,function(t){return function(e,r,n){return t(this,e,r,n)}}),We("Uint32",4,function(t){return function(e,r,n){return t(this,e,r,n)}}),We("Int8",1,function(t){return function(e,r,n){return t(this,e,r,n)}}),We("Int32",4,function(t){return function(e,r,n){return t(this,e,r,n)}}),We("Int16",2,function(t){return function(e,r,n){return t(this,e,r,n)}}),We("Float32",4,function(t){return function(e,r,n){return t(this,e,r,n)}});var Rn={float32:Float32Array,int16:Int16Array,int32:Int32Array,int8:Int8Array,uint16:Uint16Array,uint32:Uint32Array,uint8:Uint8Array},Fn=function(t,e,r){var n=t*e;if(r instanceof ArrayBuffer){if(n>r.byteLength)throw new TypeError("VOArray: [data] buffer is too small! needs ".concat(n," bytes (capacity=").concat(t," bytesPerVO=").concat(e,") but has ").concat(r.byteLength," bytes!"));return new DataView(r,0,n)}if(ArrayBuffer.isView(r)){var i=r.byteOffset,o=r.byteLength;if(n>o)throw new TypeError("VOArray: [data] buffer is too small! needs ".concat(n," bytes (capacity=").concat(t," bytesPerVO=").concat(e,") but has ").concat(o," (byteOffset=").concat(i,") bytes!"));return new DataView(r.buffer,i,n)}throw new TypeError("VOArray: [data] must be instanceof ArrayBuffer, DataView or TypedArray!")},In=function(t,e,r,n){var i={};return n.forEach(function(n){var o=Rn[n],a=new o(t,e,r/o.BYTES_PER_ELEMENT);i[function(t){return"".concat(t,"Array")}(n)]=a}),i},Mn=function(){function t(e,r,n,i,o){if($(this,t),r%4!=0)throw new TypeError("new VOArray: bytesPerVO must be divisible by 4 (but is not!) bytesPerVO=".concat(r));if(this.capacity=e,this.bytesPerVO=r,this.arrayTypes=n.slice(0),i){var a=Fn(e,r,i);this.buffer=a.buffer,this.bufferByteOffset=a.byteOffset,this.bufferByteLength=a.byteLength}else this.buffer=new ArrayBuffer(e*r),this.bufferByteOffset=0,this.bufferByteLength=this.buffer.byteLength;Object.assign(this,In(this.buffer,this.bufferByteOffset,this.bufferByteLength,n)),this.ref=new yt("VOArray",this,Object.assign({typedArray:this.toUint32Array(),serial:1},o))}return J(t,[{key:"copy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.bytesPerVO/Uint32Array.BYTES_PER_ELEMENT,n=0;e>0&&(n=e*r),this.toUint32Array().set(t.toUint32Array(),n)}},{key:"toUint32Array",value:function(){var t=this.uint32Array;if(!t){var e=this.bytesPerVO/Uint32Array.BYTES_PER_ELEMENT;return this.uint32Array=new Uint32Array(this.buffer,this.bufferByteOffset,this.capacity*e),this.uint32Array}return t}},{key:"subarray",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.bytesPerVO,i=this.bufferByteOffset+e*n,o=r*n;return new t(r,n,this.arrayTypes,new DataView(this.buffer,i,o))}}]),t}(),Cn=Ae(1);j(j.P+j.F*!Tn([].map,!0),"Array",{map:function(t){return Cn(this,t,arguments[1])}}),j(j.S,"Array",{isArray:we});var Nn={float32:4,int16:2,int32:4,int8:1,uint16:2,uint32:4,uint8:1},Dn={float32:function(t){return t.float32Array},int32:function(t){return t.int32Array},int16:function(t){return t.int16Array},int8:function(t){return t.int8Array},uint32:function(t){return t.uint32Array},uint16:function(t){return t.uint16Array},uint8:function(t){return t.uint8Array}},Bn=function(t){return t[0].toUpperCase()+t.substr(1)},Un=function(t,e,r){if(t.scalars){var n=t.scalars[r];if(void 0!==n)return n}return"".concat(e,"_").concat(r)},Gn=function(t,e){return function(){return t(this.voArray)[e]}},Hn=function(t,e,r,n,i){return function(){for(var o=t(this.voArray),a=0;a<r;++a)for(var u=0;u<e;++u)o[a*n+i+u]=arguments[a*e+u]}},Yn=function(t,e,r,n){return function(i){for(var o=t(this.voArray),a=0;a<e;++a)o[a*r+n]=i}},Wn=function(){function t(e,r,n,i,o,a,u){$(this,t),this.name=e,this.type=r,this.size=n,this.uniform=a,this.scalars=u,this.bytesPerElement=Nn[this.type],this.bytesPerVertex=this.bytesPerElement*n,this.byteOffset="number"!=typeof o?i*this.bytesPerElement:o,this.offset="number"!=typeof i?o/this.bytesPerElement:i}return J(t,[{key:"vertexAttrCount",value:function(t){return t.bytesPerVertex/this.bytesPerElement}}],[{key:"defineProperties",value:function(t,e,r){var n=t.name,i=Dn[t.type],o=r.vertexCount,a=t.vertexAttrCount(r),u=t.byteOffset/t.bytesPerElement;if(1===t.size)if(t.uniform){var s=Gn(i,u),c=Yn(i,o,a,u);t.getValue=function(t){return s.call(t)},t.setValue=function(t,e){return c.call(t,e)},e[n]={get:s,set:c,enumerable:!0}}else{var f=Hn(i,1,o,a,u);t.setValue=function(t,e){return f.apply(t,e)},e["set".concat(Bn(n))]={value:f,enumerable:!0};for(var h=[],l=0;l<r.vertexCount;++l){var v=Gn(i,u+l*a);h.push(v),e[n+l]={get:v,set:Hn(i,1,1,0,u+l*a),enumerable:!0}}t.getValue=function(t,e){return h[e].call(t)}}else if(t.size>=2)if(t.uniform){var d=function(t,e){return function(r){return t(this.voArray)[e+r]}}(i,u),y=function(t,e,r,n,i){return function(){for(var o=t(this.voArray),a=0;a<r;++a)for(var u=0;u<e;++u)o[a*n+i+u]=arguments[u]}}(i,t.size,o,a,u);t.getValue=function(t,e,r){return d.call(t,r)},t.setValue=function(t,e){return y.apply(t,e)},e["get".concat(Bn(n))]={value:d,enumerable:!0},e["set".concat(Bn(n))]={value:y,enumerable:!0};for(var p=0;p<t.size;++p){e[Un(t,n,p)]={get:Gn(i,u+p),set:Yn(i,o,a,u+p),enumerable:!0}}}else{var g=Hn(i,t.size,o,a,u);t.setValue=function(t,e){return g.apply(t,e)},e["set".concat(Bn(n))]={value:g,enumerable:!0};for(var m=[],w=0;w<r.vertexCount;++w){for(var b=[],x=0;x<t.size;++x){var A=Un(t,n,x)+w,O=Gn(i,u+w*a+x);b.push(O),e[A]={get:O,set:Hn(i,1,1,0,u+w*a+x),enumerable:!0}}m.push(b)}t.getValue=function(t,e,r){return m[e][r].call(t)}}}}]),t}(),Xn=function(t,e){var r;if(Array.isArray(e)?r=e:"object"===K(e)&&(r=Object.keys(e).map(function(t){var r=e[t];return Object.assign({name:t},Array.isArray(r)?{scalars:r}:r)})),!r)throw new Error("VODescriptor:createAttributes: attributes should be an array or an object!");t.attr={},t.scalars=[];for(var n=0,i=0,o=0;o<r.length;++o){var a=r[o],u=a.size;void 0===u&&(u=Array.isArray(a.scalars)?a.scalars.length:1);var s=a.type||"float32";void 0!==a.name&&(t.scalars.push(a.name),t.attr[a.name]=new Wn(a.name,s,u,n,i,!!a.uniform,a.scalars)),n+=u,i+=Nn[s]*u}t.rightPadBytesPerVertex=i%4>0?4-i%4:0,t.bytesPerVertex=i+t.rightPadBytesPerVertex,t.bytesPerVO=t.bytesPerVertex*t.vertexCount,t.vertexAttrCount=n,t.attrList=t.scalars.map(function(e){return t.attr[e]})},zn=function(t,e){"object"===K(e)&&Object.keys(e).forEach(function(r){var n=e[r];"string"==typeof n?void 0!==(n=t.attr[n])&&(t.attr[r]=n):t.attr[r]=new Wn(r,n.type,n.size,n.offset,n.byteOffset,!!n.uniform,n.scalars)})},Kn=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={toArray:{value:function(t){return function(e){for(var r=[],n=Array.isArray(e)?e.map(function(e){return t.attr[e]}):t.attrList,i=n.length,o=0;o<t.vertexCount;++o)for(var a=0;a<i;++a)for(var u=n[a],s=0;s<u.size;++s)r.push(u.getValue(this,o,s));return r}}(t)}};Object.keys(t.attr).forEach(function(e){var n=t.attr[e];Wn.defineProperties(n,r,t)}),t.voPrototype=Object.create(e,r)},Zn=Ae(2);j(j.P+j.F*!Tn([].filter,!0),"Array",{filter:function(t){return Zn(this,t,arguments[1])}});var qn=[].sort,$n=[1,2,3];j(j.P+j.F*(o(function(){$n.sort(void 0)})||!o(function(){$n.sort(null)})||!Tn(qn)),"Array",{sort:function(t){return void 0===t?qn.call(zt(this)):qn.call(zt(this),V(t))}});var Qn=function(t){t.typedArrays={float32:!1,int16:!1,int32:!1,int8:!1,uint16:!1,uint32:!1,uint8:!1},Object.keys(t.attr).forEach(function(e){t.typedArrays[t.attr[e].type]=!0}),t.typeList=Object.keys(t.typedArrays).filter(function(e){return t.typedArrays[e]}).sort()},Jn=function(){function t(e){var r=e.vertexCount,n=e.instanceOf,i=e.attributes,o=e.aliases,a=e.proto;$(this,t),this.vertexCount=parseInt(r,10)||1,this.isInstanced=null!=n,this.base=n,Xn(this,i),zn(this,o),Kn(this,a),Qn(this)}return J(t,[{key:"createVOArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Mn(t,this.bytesPerVO,this.typeList,null,Object.assign({descriptor:this,usage:"dynamic",doubleBuffer:!0},e))}},{key:"createVO",value:function(t,e){var r=this,n=function(t,e,r){if(t.descriptor=e,!t.descriptor)throw new Error("VODescriptor:createVO: could not read descriptor!");if(t.voArray=r||t.descriptor.createVOArray(),t.descriptor.bytesPerVO!==t.voArray.bytesPerVO&&t.descriptor.typeList.join()!==t.voArray.arrayTypes.join())throw new TypeError("VODescriptor:createVO: descriptor and voArray are not compatible with each other!");return t}(Object.create(this.voPrototype),this,t);switch(K(e)){case"function":e(n);break;case"object":Object.keys(e).forEach(function(t){var i=r.attr[t];i?i.setValue(n,e[t]):"function"==typeof n[t]?n[t](e[t]):n[t]=e[t]})}return n}},{key:"hasAttribute",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=this.attr[t];return r&&r.size===e}},{key:"maxIndexedVOPoolSize",get:function(){return Math.floor(65536/this.vertexCount)}}]),t}(),ti=function(){function t(e,r,n,i){if($(this,t),this.id=n||dt(),this.type=e,this.ctx=Object.assign({},i),r instanceof HTMLElement)this.strings=[r.textContent],this.values=[];else if(Array.isArray(r)){var o=ot(r,2);this.strings=o[0],this.values=o[1]}else this.strings=[String(r)],this.values=[]}return J(t,[{key:"compile",value:function(e){var r=this,n=[this.strings[0]],i=Object.assign({},this.ctx,e);return this.values.forEach(function(e,o){var a=e;if("function"==typeof e)a=e(i);else if(e instanceof t){if(e.type!==t.PARTIAL)throw new Error("ShaderSource.compile() panic! Only PARTIAL's are allowed to embed into shader sources! (but type=".concat(e.type,")"));a=e.compile(i)}n.push(a,r.strings[o+1])}),n.join("")}}]),t}();ti.VERTEX_SHADER="VERTEX_SHADER",ti.FRAGMENT_SHADER="FRAGMENT_SHADER",ti.PARTIAL="PARTIAL",ti.vertexShader=function(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return new ti(ti.VERTEX_SHADER,[e,n],t&&t.id,t)}},ti.fragmentShader=function(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return new ti(ti.FRAGMENT_SHADER,[e,n],t&&t.id,t)}},ti.partial=function(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return new ti(ti.PARTIAL,[e,n],t&&t.id,t)}},ti.fromElement=function(t){var e=t.getAttribute("type");if("x-shader/vertex"===e)e=ti.VERTEX_SHADER;else{if("x-shader/fragment"!==e)throw new Error('ShaderSource.fromElement() panic! Invalid type="'.concat(e,'" attribute value (should be "x-shader/vertex" or "x-shader/fragment")'));e=ti.FRAGMENT_SHADER}return new ti(e,t,t.getAttribute("id"))};var ei=function(){function t(){$(this,t),this.descriptors=new Map,this.vertexShaders=new Map,this.fragmentShaders=new Map}return J(t,[{key:"createDescriptor",value:function(t,e){var r=e instanceof Jn?e:new Jn(e);return this.descriptors.set(t,r),t}},{key:"addVertexShader",value:function(t,e){if(e.type!==ti.VERTEX_SHADER)throw new Error("addVertexShader: shaderSource has wrong type=".concat(e.type," (expected type=").concat(ti.VERTEX_SHADER,")"));return this.vertexShaders.set(t,e),t}},{key:"addFragmentShader",value:function(t,e){if(e.type!==ti.FRAGMENT_SHADER)throw new Error("addFragmentShader: shaderSource has wrong type=".concat(e.type," (expected type=").concat(ti.FRAGMENT_SHADER,")"));return this.fragmentShaders.set(t,e),t}},{key:"createVertexShader",value:function(t){var e=new ti(ti.VERTEX_SHADER,t);return this.vertexShaders.set(e.id,e),e.id}},{key:"createFragmentShader",value:function(t){var e=new ti(ti.FRAGMENT_SHADER,t);return this.fragmentShaders.set(e.id,e),e.id}},{key:"getDescriptor",value:function(t){return this.descriptors.get(t)}},{key:"getVertexShader",value:function(t){return this.vertexShaders.get(t)}},{key:"getFragmentShader",value:function(t){return this.fragmentShaders.get(t)}}]),t}(),ri=function(t){function e(t,r){return $(this,e),nt(this,et(e).call(this,t,qr.ATTRIB,r))}return tt(e,qr),e}(),ni=[].slice,ii={},oi=Function.bind||function(t){var e=V(this),r=ni.call(arguments,1),i=function(){var n=r.concat(ni.call(arguments));return this instanceof i?function(t,e,r){if(!(e in ii)){for(var n=[],i=0;i<e;i++)n[i]="a["+i+"]";ii[e]=Function("F,a","return new F("+n.join(",")+")")}return ii[e](t,r)}(e,n.length,n):er(e,n,t)};return n(e.prototype)&&(i.prototype=e.prototype),i};j(j.P,"Function",{bind:oi});var ai=function(){function t(e){$(this,t),this.shaderVars=e}return J(t,[{key:"pushVar",value:function(t){this.shaderVars.forEach(t.pushVar.bind(t))}},{key:"popVar",value:function(t){this.shaderVars.forEach(t.popVar.bind(t))}}]),t}();function ui(t,e){switch(e){case qr.UNIFORM:return t.uniform;case qr.ATTRIB:return t.attrib;case qr.TEXTURE_2D:return t.tex2d;default:return null}}function si(t,e,r){var n=ui(t,e),i=n.get(r);return i||(i=[],n.set(r,i)),i}var ci=function(){function t(){$(this,t),this.uniform=new Map,this.attrib=new Map,this.tex2d=new Map}return J(t,[{key:"clear",value:function(){this.uniform.clear(),this.attrib.clear(),this.tex2d.clear()}},{key:"pushVar",value:function(t){t instanceof ai?t.pushVar(this):si(this,t.type,t.name).push(t)}},{key:"popVar",value:function(t){if(t instanceof ai)t.popVar(this);else for(var e=si(this,t.type,t.name),r=e.length,n=0;n<r;++n)if(e[n]===t)return void(e.length=n)}},{key:"curVar",value:function(t){var e=ui(this,t.type).get(t.name);return e&&e.length?e[e.length-1]:null}},{key:"curUniform",value:function(t){var e=this.uniform.get(t);return e&&e.length?e[e.length-1]:null}},{key:"curAttrib",value:function(t){var e=this.attrib.get(t);return e&&e.length?e[e.length-1]:null}},{key:"curTex2d",value:function(t){var e=this.tex2d.get(t);return e&&e.length?e[e.length-1]:null}}]),t}(),fi=function t(e,r,n){$(this,t),this.id=n||dt(),this.vertexShader=e,this.fragmentShader=r};j(j.S+j.F*!a,"Object",{defineProperty:y.f});var hi=function(t){function e(t){var r;return $(this,e),r=nt(this,et(e).call(this,[])),Object.keys(t).forEach(function(e){r.addUniform(e,t[e])}),r}return tt(e,ai),J(e,[{key:"addUniform",value:function(t,e,r){var n=e instanceof Xr,i=n?new Jr(e,t):new $r(t,e,r);this.shaderVars.push(i),Object.defineProperty(this,"".concat(t,"Uniform"),{value:i,enumerable:!0}),n?Object.defineProperty(this,t,{enumerable:!0,get:function(){return i.projection}}):Object.defineProperty(this,t,{enumerable:!0,get:function(){return i.data},set:function(t){i.data=t}})}}]),e}(),li=function(){function t(e,r,n){$(this,t),this.name=e,this.descriptor=r,this.bufferSource=n}return J(t,[{key:"bufferSource",set:function(t){this.bufferSource_=t,this.ref=t instanceof Mn?t.ref:t.voArray.ref},get:function(){return this.bufferSource_}},{key:"attrDescriptor",get:function(){return this.descriptor.attr[this.name]}}]),t}(),vi=function(){function t(e,r){$(this,t),this.name=e,this.shaderVar=r}return J(t,[{key:"type",get:function(){return this.shaderVar.type}},{key:"data",get:function(){return this.shaderVar.data}},{key:"serial",get:function(){return this.shaderVar.serial}}]),t}(),di=function(t){function e(t,r){var n;$(this,e),n=nt(this,et(e).call(this,[]));var i,o=r||t.descriptor;return Object.keys(o.attr).forEach(function(e){i?n.shaderVars.push(new vi(e,i)):(i=new ri(e,new li(e,o,t)),n.shaderVars.push(i))}),n}return tt(e,ai),J(e,[{key:"touch",value:function(){return this.shaderVars[0].touch()}},{key:"bufferSource",get:function(){return this.shaderVars[0].data.bufferSource}},{key:"serial",get:function(){return this.shaderVars[0].serial}}]),e}(),yi=Nt(!1),pi=[].indexOf,gi=!!pi&&1/[1].indexOf(1,-0)<0;j(j.P+j.F*(gi||!Tn(pi)),"Array",{indexOf:function(t){return gi?pi.apply(this,arguments)||0:yi(this,t,arguments[1])}});var mi=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.capacity-t.usedCount-t.allocatedCount,n=e>0&&e<r?e:r,i=t.allocatedCount+n,o=t.allocatedCount;o<i;o++){var a=t.voArray.subarray(o),u=t.descriptor.createVO(a);u.free=t.free.bind(t,u),t.availableVOs.push(u)}return n},wi=function(){function t(e,n){var i=this;$(this,t),this.id=dt(),this.descriptor=e,this.capacity=r.readOption(n,"capacity",this.descriptor.maxIndexedVOPoolSize),this.maxAllocVOSize=r.readOption(n,"maxAllocVOSize",0),this.voZero=r.readOption(n,"voZero",function(){return e.createVO()}),this.voNew=r.readOption(n,"voNew",function(){return e.createVO()}),this.usage=r.readOption(n,"usage","dynamic"),this.voArray=r.readOption(n,"voArray",function(){return e.createVOArray(i.capacity,{usage:i.usage,autotouch:r.readOption(n,"autotouch","dynamic"===i.usage),doubleBuffer:r.readOption(n,"doubleBuffer","dynamic"===i.usage)})}),this.availableVOs=[],this.usedVOs=[],mi(this,this.maxAllocVOSize)}return J(t,[{key:"alloc",value:function(){var t=this.availableVOs.shift();if(void 0===t){if(!(this.capacity-this.allocatedCount>0))return;mi(this,this.maxAllocVOSize),t=this.availableVOs.shift()}return this.usedVOs.push(t),t.voArray.copy(this.voNew.voArray),t}},{key:"multiAlloc",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.allocatedCount-this.usedCount<t&&mi(this,r.maxOf(this.maxAllocVOSize,t-this.allocatedCount-this.usedCount));for(var n=0;n<t;++n){var i=this.availableVOs.shift();if(void 0===i)break;this.usedVOs.push(i),i.voArray.copy(this.voNew.voArray),e.push(i)}return e}},{key:"free",value:function(t){if(Array.isArray(t))t.forEach(this.free.bind(this));else{var e=this.usedVOs.indexOf(t);if(-1!==e){var r=this.usedVOs.length-1;if(e!==r){var n=this.usedVOs[r];t.voArray.copy(n.voArray);var i=n.voArray;n.voArray=t.voArray,t.voArray=i,this.usedVOs.splice(e,1,n)}this.usedVOs.pop(),this.availableVOs.unshift(t),t.voArray.copy(this.voZero.voArray)}}}},{key:"usedCount",get:function(){return this.usedVOs.length}},{key:"availableCount",get:function(){return this.capacity-this.usedVOs.length}},{key:"allocatedCount",get:function(){return this.availableVOs.length+this.usedVOs.length}}]),t}(),bi=r.pick(["autotouch","capacity","doubleBuffer","maxAllocVOSize","usage","voArray"]),xi=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"size";switch(K(t)){case"string":return function(e,r,n,i){return i.attr[t].setValue(e,[r,n])};case"function":return t;case"object":case"boolean":if(!t)return null;default:throw new Error("SpriteGroup: invalid sprite size setter! (is ".concat(K(t)," but should be a function, string, null or false)"))}},Ai=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$(this,t),this.descriptor=e,r.base instanceof t?this.base=r.base:"object"===K(r.base)&&(this.base=new t(e.base,r.base));var n=r.voNew,i=r.voZero;n&&(n=e.createVO(null,n)),i&&(i=e.createVO(null,i)),this.spriteHook={setSize:xi(r.setSize)},this.voPool=new wi(e,Object.assign({maxAllocVOSize:1e3},bi(r),{voNew:n,voZero:i})),this.voPoolShaderAttribs=new di(this.voPool);var o=r.primitive;this.primitive="function"==typeof o?o(this.capacity):o,this.shaderProgram=r.shaderProgram,!this.shaderProgram&&r.vertexShader&&r.fragmentShader&&(this.shaderProgram=new fi(r.vertexShader,r.fragmentShader))}return J(t,[{key:"createSprite",value:function(t,e){var r=this.voPool.alloc(),n=this.spriteHook.setSize;return!n||void 0===t&&void 0===e||n(r,t,void 0!==e?e:t,this.descriptor),r}},{key:"createSprites",value:function(t,e,r){var n=this,i=this.voPool.multiAlloc(t),o=this.spriteHook.setSize;if(o&&(void 0!==e||void 0!==r)){var a=void 0!==r?r:e;i.forEach(function(t){return o(t,e,a,n.descriptor)})}return i}},{key:"touchVertexBuffers",value:function(){this.voPool.voArray.ref.touch()}},{key:"capacity",get:function(){return this.voPool.capacity}},{key:"usedCount",get:function(){return this.voPool.usedCount}},{key:"availableCount",get:function(){return this.voPool.availableCount}}]),t}(),Oi=function(){function t(){$(this,t),this.context=new Map}return J(t,[{key:"push",value:function(t,e){var r=this.context.get(t);return r?(r.push(e),r.length-1):(this.context.set(t,[e]),0)}},{key:"pop",value:function(t,e){var r=this.context.get(t);if(r)return void 0===e?r.pop():r.splice(e,r.length-e)}},{key:"get",value:function(t){var e=this.context.get(t);if(e){var r=e.length;if(r>0)return e[r-1]}}},{key:"clear",value:function(){this.context.forEach(function(t){t.length=0})}}]),t}(),Ei=(u(function(t){!function(e){var r,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag",c=e.regeneratorRuntime;if(c)t.exports=c;else{(c=e.regeneratorRuntime=t.exports).wrap=w;var f="suspendedStart",h="suspendedYield",l="executing",v="completed",d={},y={};y[a]=function(){return this};var p=Object.getPrototypeOf,g=p&&p(p(T([])));g&&g!==n&&i.call(g,a)&&(y=g);var m=O.prototype=x.prototype=Object.create(y);A.prototype=m.constructor=O,O.constructor=A,O[s]=A.displayName="GeneratorFunction",c.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===A||"GeneratorFunction"===(e.displayName||e.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,O):(t.__proto__=O,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(m),t},c.awrap=function(t){return{__await:t}},E(_.prototype),_.prototype[u]=function(){return this},c.AsyncIterator=_,c.async=function(t,e,r,n){var i=new _(w(t,e,r,n));return c.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},E(m),m[s]="Generator",m[a]=function(){return this},m.toString=function(){return"[object Generator]"},c.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},c.values=T,V.prototype={constructor:V,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,i){return u.type="throw",u.arg=t,e.next=n,i&&(e.method="next",e.arg=r),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:T(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),d}}}function w(t,e,r,n){var i=e&&e.prototype instanceof x?e:x,o=Object.create(i.prototype),a=new V(n||[]);return o._invoke=function(t,e,r){var n=f;return function(i,o){if(n===l)throw new Error("Generator is already running");if(n===v){if("throw"===i)throw o;return L()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var u=S(a,r);if(u){if(u===d)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=l;var s=b(t,e,r);if("normal"===s.type){if(n=r.done?v:h,s.arg===d)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n=v,r.method="throw",r.arg=s.arg)}}}(t,r,a),o}function b(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function x(){}function A(){}function O(){}function E(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function _(t){var e;this._invoke=function(r,n){function o(){return new Promise(function(e,o){!function e(r,n,o,a){var u=b(t[r],t,n);if("throw"!==u.type){var s=u.arg,c=s.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,o,a)},function(t){e("throw",t,o,a)}):Promise.resolve(c).then(function(t){s.value=t,o(s)},a)}a(u.arg)}(r,n,e,o)})}return e=e?e.then(o,o):o()}}function S(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,S(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=b(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function V(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function T(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())}),function(){function t(e,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;$(this,t);var s=n,c=i;if(e instanceof t)this.parent=e,this.image=null;else{if(!("object"===K(e)&&"width"in e&&"height"in e))throw new Error("new Texture() panic: unexpected source argument!");this.image=e,this.parent=null,this._ref=new yt("Texture",this,{flipY:r.readOption(u,"flipY",!1),repeatable:r.readOption(u,"repeatable",!1),premultiplyAlpha:r.readOption(u,"premultiplyAlpha",!0),nearest:r.readOption(u,"nearest",!0)}),"origWidth"in e&&"origHeight"in e&&(s=e.origWidth,c=e.origHeight)}this._width=s,this._height=c,this.x=o,this.y=a}var e;return J(t,[{key:"root",get:function(){return this.parent&&this.parent.root||this}},{key:"imgEl",get:function(){var t=this.root;return t.image.imgEl||t.image}},{key:"ref",get:function(){return this._ref||this.root.ref}},{key:"width",get:function(){return"number"==typeof this._width?this._width:this.image?this.image.width:this.parent?this.root.width:0},set:function(t){this._width=t}},{key:"height",get:function(){return"number"==typeof this._height?this._height:this.image?this.image.height:this.parent?this.root.height:0},set:function(t){this._height=t}},{key:"minS",get:function(){for(var t=this.x,e=this;null!=(e=e.parent);)t+=e.x;return t/this.root.image.width}},{key:"minT",get:function(){for(var t=this.y,e=this;null!=(e=e.parent);)t+=e.y;return t/this.root.image.height}},{key:"maxS",get:function(){for(var t=this.x+this.width,e=this;null!=(e=e.parent);)t+=e.x;return t/this.root.image.width}},{key:"maxT",get:function(){for(var t=this.y+this.height,e=this;null!=(e=e.parent);)t+=e.y;return t/this.root.image.height}}],[{key:"load",value:(e=q(regeneratorRuntime.mark(function e(r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new URL(r,window.location.href).href,e.next=3,new Wr(i).onLoaded;case 3:return o=e.sent,e.abrupt("return",new t(o,void 0,void 0,0,0,n));case 5:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})}]),t}()),_i=k("match"),Si=y.f,ki=Xt.f,Pi=s.RegExp,Vi=Pi,Ti=Pi.prototype,Li=/a/g,ji=/a/g,Ri=new Pi(Li)!==Li;if(a&&(!Ri||o(function(){return ji[k("match")]=!1,Pi(Li)!=Li||Pi(ji)==ji||"/a/i"!=Pi(Li,"i")}))){Pi=function(t,e){var r,i,o=this instanceof Pi,a=n(r=t)&&(void 0!==(i=r[_i])?!!i:"RegExp"==jt(r)),u=void 0===e;return!o&&a&&t.constructor===Pi&&u?t:An(Ri?new Vi(a&&!u?t.source:t,e):Vi((a=t instanceof Pi)?t.source:t,a&&u?ut.call(t):e),o?this:Ti,Pi)};for(var Fi=function(t){t in Pi||Si(Pi,t,{configurable:!0,get:function(){return Vi[t]},set:function(e){Vi[t]=e}})},Ii=ki(Vi),Mi=0;Ii.length>Mi;)Fi(Ii[Mi++]);Ti.constructor=Pi,Pi.prototype=Ti,E(s,"RegExp",Pi)}Be("RegExp");var Ci=function(t,e,r){e in t?y.f(t,e,p(0,r)):t[e]=r};j(j.S+j.F*!Ne(function(t){}),"Array",{from:function(t){var e,r,n,i,o=zt(t),a="function"==typeof this?this:Array,u=arguments.length,s=u>1?arguments[1]:void 0,c=void 0!==s,f=0,h=me(o);if(c&&(s=T(s,u>2?arguments[2]:void 0,2)),null==h||a==Array&&oe(h))for(r=new a(e=Vt(o.length));e>f;f++)Ci(r,f,c?s(o[f],f):o[f]);else for(i=h.call(o),r=new a;!(n=i.next()).done;f++)Ci(r,f,c?Je(i,s,[n.value,f],!0):n.value);return r.length=f,r}});var Ni=function(){function t(e){$(this,t),this.frameNames=Object.keys(e.frames),this.frames=e.frames,this.meta=e.meta,this.imageUrl=e.meta.image}var e;return J(t,null,[{key:"load",value:(e=q(regeneratorRuntime.mark(function e(r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(r,n);case 2:return i=e.sent,e.next=5,i.json();case 5:return o=e.sent,e.abrupt("return",new t(o));case 7:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})}]),t}(),Di=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;$(this,t),this.rootTexture=e,this.jsonDef=r,this.frames=new Map}var e;return J(t,[{key:"addFrame",value:function(t,e,r,n,i){this.frames.set(t,new Ei(this.rootTexture,e,r,n,i))}},{key:"addFrameAlias",value:function(t,e){this.frames.has(e)&&this.frames.set(t,this.frames.get(e))}},{key:"frame",value:function(t){return this.frames.get(t)}},{key:"randomFrame",value:function(){return r.sample(Array.from(this.frames.values()))}},{key:"randomFrameName",value:function(){return r.sample(this.frameNames())}},{key:"frameNames",value:function(t){var e=Array.from(this.frames.keys());if(t){var r=new RegExp(t);return e.filter(function(t){return r.test(t)})}return e}}],[{key:"load",value:(e=q(regeneratorRuntime.mark(function e(n,i){var o,a,u,s,c,f,h,l,v,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=new URL(n,window.location.href).href,e.next=3,Ni.load(o,r.readOption(i,"fetchOptions"));case 3:return a=e.sent,e.next=6,new Wr(r.readOption(i,"image",function(){return new URL(a.imageUrl,o).href},a)).onLoaded;case 6:for(u=e.sent,s=new Ei(u,void 0,void 0,0,0,r.readOption(i,"textureHints")),c=new t(s,a),f=a.frameNames,h=f.length,l=0;l<h;l++)v=f[l],d=a.frames[v].frame,c.addFrame(v,d.w,d.h,d.x,d.y);return e.abrupt("return",c);case 13:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})}]),t}(),Bi=function t(e){var r=this;$(this,t),this.texture=null,this.atlas=null,this.onReady=Promise.resolve(e).then(function(){var t=q(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e instanceof Di?(r.atlas=e,r.texture=e.rootTexture):r.texture=e,t.abrupt("return",e);case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}())},Ui=function(t){function e(t,r){var n;return $(this,e),(n=nt(this,et(e).call(this,t,qr.TEXTURE_2D,r))).texture=null,n}return tt(e,qr),e}(),Gi=function(){function t(){$(this,t),this.handles=new Map,this.shaderVars=new Map}return J(t,[{key:"loadTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=new Bi(Ei.load(e,r));return this.handles.set(t,n),n.onReady}},{key:"loadTextureAtlas",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=new Bi(Di.load(e,r));return this.handles.set(t,n),n.onReady}},{key:"getTexture",value:function(t){var e=this.handles.get(t);return e&&e.texture}},{key:"getTextureAtlas",value:function(t){var e=this.handles.get(t);return e&&e.atlas}},{key:"whenLoaded",value:function(t,e,r){var n=this.getTexture(t);if(n){var i=this.shaderVars.get(e);i||(i=new Ui(e),this.shaderVars.set(e,i)),i.texture=n,r(i)}}}]),t}(),Hi=function(){function t(e,r){$(this,t),this.textureLibrary=e,this.waitFor=Object.keys(r).map(function(t){return{shaderVarKey:t,textureId:r[t],isLoaded:!1}}),this.shaderVarGroup=new ai([]),this.shaderVarStore=new Map}return J(t,[{key:"whenLoaded",value:function(t){var e=this;this.isLoaded?t(this.shaderVarGroup):(this.waitFor.forEach(function(t){if(!t.isLoaded){var r=e.textureLibrary.getTexture(t.textureId);if(!r)return;var n=new Ui(t.shaderVarKey);n.texture=r,e.shaderVarGroup.shaderVars.push(n),t.isLoaded=!0}}),this.waitFor=this.waitFor.filter(function(t){return!1===t.isLoaded}),this.isLoaded&&t(this.shaderVarGroup))}},{key:"isLoaded",get:function(){return 0===this.waitFor.length&&this.shaderVarGroup.shaderVars.length>0}}]),t}(),Yi=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$(this,e),(n=nt(this,et(e).call(this,t,i))).textureLibrary=r.readOption(i,"textureLibrary",function(){return new Gi});var o=i.setTexCoordsByTexture;return n.spriteHook.setTexCoordsByTexture=null===o||!1===o?null:o||function(t,e){return t.setTexCoordsByTexture(e)},n.textures=Object.assign({},i.textures),n.shaderTextureGroup=null,n}return tt(e,Ai),J(e,[{key:"setTexture",value:function(t,e){this.textures[t]!==e&&(this.textures[t]=e,this.shaderTextureGroup=null)}},{key:"loadTextureAtlas",value:function(t,e,r){return this.setTexture(t,e),this.textureLibrary.loadTextureAtlas(e,e,r)}},{key:"getTexture",value:function(t){return this.textureLibrary.getTexture(this.textures[t])}},{key:"getTextureAtlas",value:function(t){return this.textureLibrary.getTextureAtlas(this.textures[t])}},{key:"whenTexturesLoaded",value:function(t){this.shaderTextureGroup||(this.shaderTextureGroup=new Hi(this.textureLibrary,this.textures)),this.shaderTextureGroup.whenLoaded(t)}},{key:"createSprite",value:function(t,r,n){var i,o;t&&void 0===r?(i=t.width,o=t.height):(i=r,o=n);var a=it(et(e.prototype),"createSprite",this).call(this,i,o),u=this.spriteHook.setTexCoordsByTexture;return u&&t&&u(a,t),a}}]),e}(),Wi=function(t){function e(t,r,n,i){return $(this,e),nt(this,et(e).call(this,t,t+n,r,r+i))}return tt(e,at),J(e,[{key:"x",get:function(){return this.minX},set:function(t){var e=this.width;this.minX=t,this.maxX=t+e}},{key:"y",get:function(){return this.minY},set:function(t){var e=this.height;this.minY=t,this.maxY=t+e}}]),e}();t.ShaderTool=z,t.AABB2=at,t.DataRef=yt,t.ElementIndexArray=Ze,t.IndexedPrimitive=qe,t.Mat4=Qe,t.PowerOf2Image=Wr,t.Projection=Xr,t.ProjectionUniform=Jr,t.ResourceLibrary=ei,t.ShaderAttribVariable=ri,t.ShaderContext=ci,t.ShaderProgram=fi,t.ShaderSource=ti,t.ShaderUniformGroup=hi,t.ShaderUniformVariable=$r,t.ShaderVariableBufferGroup=di,t.SpriteGroup=Ai,t.StackedContext=Oi,t.Texture=Ei,t.TextureAtlas=Di,t.TextureLibrary=Gi,t.TexturedSpriteGroup=Yi,t.VOArray=Mn,t.VODescriptor=Jn,t.VOPool=wi,t.Viewport=Wi,t.generateUuid=dt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=picimo-core.js.map
