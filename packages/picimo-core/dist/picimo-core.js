import{mat4}from"gl-matrix";import{isPowerOf2,findNextPowerOf2,readOption,maxOf,pick,sample}from"@picimo/utils";var _isObject=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_anObject=function(t){if(!_isObject(t))throw TypeError(t+" is not an object!");return t},_fails=function(t){try{return!!t()}catch(t){return!0}},_descriptors=!_fails(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a});function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var _global=createCommonjsModule(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),document$1=_global.document,is=_isObject(document$1)&&_isObject(document$1.createElement),_domCreate=function(t){return is?document$1.createElement(t):{}},_ie8DomDefine=!_descriptors&&!_fails(function(){return 7!=Object.defineProperty(_domCreate("div"),"a",{get:function(){return 7}}).a}),_toPrimitive=function(t,e){if(!_isObject(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!_isObject(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!_isObject(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!_isObject(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},dP=Object.defineProperty,f=_descriptors?Object.defineProperty:function(t,e,r){if(_anObject(t),e=_toPrimitive(e,!0),_anObject(r),_ie8DomDefine)try{return dP(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t},_objectDp={f:f},_propertyDesc=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},_hide=_descriptors?function(t,e,r){return _objectDp.f(t,e,_propertyDesc(1,r))}:function(t,e,r){return t[e]=r,t},hasOwnProperty={}.hasOwnProperty,_has=function(t,e){return hasOwnProperty.call(t,e)},id=0,px=Math.random(),_uid=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++id+px).toString(36))},_core=createCommonjsModule(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),_core_1=_core.version,_redefine=createCommonjsModule(function(t){var e=_uid("src"),r=Function.toString,n=(""+r).split("toString");_core.inspectSource=function(t){return r.call(t)},(t.exports=function(t,r,i,o){var a="function"==typeof i;a&&(_has(i,"name")||_hide(i,"name",r)),t[r]!==i&&(a&&(_has(i,e)||_hide(i,e,t[r]?""+t[r]:n.join(String(r)))),t===_global?t[r]=i:o?t[r]?t[r]=i:_hide(t,r,i):(delete t[r],_hide(t,r,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||r.call(this)})}),_defined=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},_library=!1,_shared=createCommonjsModule(function(t){var e=_global["__core-js_shared__"]||(_global["__core-js_shared__"]={});(t.exports=function(t,r){return e[t]||(e[t]=void 0!==r?r:{})})("versions",[]).push({version:_core.version,mode:_library?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})}),_wks=createCommonjsModule(function(t){var e=_shared("wks"),r=_global.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:_uid)("Symbol."+t))}).store=e}),_fixReWks=function(t,e,r){var n=_wks(t),i=r(_defined,n,""[t]),o=i[0],a=i[1];_fails(function(){var e={};return e[n]=function(){return 7},7!=""[t](e)})&&(_redefine(String.prototype,t,o),_hide(RegExp.prototype,n,2==e?function(t,e){return a.call(t,this,e)}:function(t){return a.call(t,this)}))};_fixReWks("match",1,function(t,e,r){return[function(r){var n=t(this),i=null==r?void 0:r[e];return void 0!==i?i.call(r,n):new RegExp(r)[e](String(n))},r]});var _aFunction=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},_ctx=function(t,e,r){if(_aFunction(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,i){return t.call(e,r,n,i)}}return function(){return t.apply(e,arguments)}},PROTOTYPE="prototype",$export=function(t,e,r){var n,i,o,a,s=t&$export.F,c=t&$export.G,u=t&$export.S,l=t&$export.P,f=t&$export.B,h=c?_global:u?_global[e]||(_global[e]={}):(_global[e]||{})[PROTOTYPE],d=c?_core:_core[e]||(_core[e]={}),p=d[PROTOTYPE]||(d[PROTOTYPE]={});for(n in c&&(r=e),r)o=((i=!s&&h&&void 0!==h[n])?h:r)[n],a=f&&i?_ctx(o,_global):l&&"function"==typeof o?_ctx(Function.call,o):o,h&&_redefine(h,n,o,t&$export.U),d[n]!=o&&_hide(d,n,a),l&&p[n]!=o&&(p[n]=o)};_global.core=_core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var _export=$export,_stringWs="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",space="["+_stringWs+"]",non="​",ltrim=RegExp("^"+space+space+"*"),rtrim=RegExp(space+space+"*$"),exporter=function(t,e,r){var n={},i=_fails(function(){return!!_stringWs[t]()||non[t]()!=non}),o=n[t]=i?e(trim):_stringWs[t];r&&(n[r]=o),_export(_export.P+_export.F*i,"String",n)},trim=exporter.trim=function(t,e){return t=String(_defined(t)),1&e&&(t=t.replace(ltrim,"")),2&e&&(t=t.replace(rtrim,"")),t},_stringTrim=exporter;_stringTrim("trim",function(t){return function(){return t(this,3)}});var isNumber=function(t){return"number"==typeof t},add=function(t,e){if(isNumber(t)&&isNumber(e))return t+e;if(isNumber(t))switch(t){case 0:return e;default:return"".concat(t," + ").concat(e)}else{if(!isNumber(e))return"".concat(t," + ").concat(e);switch(e){case 0:return t;default:return"".concat(t," + ").concat(e)}}},sub=function(t,e){if(isNumber(t)&&isNumber(e))return t-e;if(isNumber(t))switch(t){case 0:return"-".concat(e);default:return"".concat(t," - ").concat(e)}else{if(!isNumber(e))return"".concat(t," - ").concat(e);switch(e){case 0:return t;default:return"".concat(t," - ").concat(e)}}},mul=function(t,e){if(isNumber(e)&&isNumber(t))return t*e;if(isNumber(t))switch(t){case 0:return 0;case 1:return e;default:return"".concat(t," * ").concat(e)}else{if(!isNumber(e))return"".concat(t," * ").concat(e);switch(e){case 0:return 0;case 1:return t;default:return"".concat(t," * ").concat(e)}}},asFloat=function(t){var e="".concat(t).trim();return e.match(/^[0-9]+$/)?"".concat(e,".0"):e},ret=function(t){return"return ".concat(t,";")},mat4$1=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,d=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,p=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,_=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1,y=(arguments.length>16&&void 0!==arguments[16]?arguments[16]:asFloat)||function(t){return"".concat(t)};return"mat4(".concat(y(t),", ").concat(y(e),", ").concat(y(r),", ").concat(y(n),", ").concat(y(i),", ").concat(y(o),", ").concat(y(a),", ").concat(y(s),", ").concat(y(c),", ").concat(y(u),", ").concat(y(l),", ").concat(y(f),", ").concat(y(h),", ").concat(y(d),", ").concat(y(p),", ").concat(y(_),")")},rotate=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rotate",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"\nmat4 ".concat(t,"(float angle) {\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1.0 - c;\n  ").concat(ret(mat4$1(add(mul("oc",e*e),"c"),sub(mul("oc",e*r),mul(n,"s")),add(mul("oc",n*e),mul(r,"s")),0,add(mul("oc",e*r),mul(n,"s")),add(mul("oc",r*r),"c"),sub(mul("oc",r*n),mul(e,"s")),0,sub(mul("oc",n*e),mul(r,"s")),add(mul("oc",r*n),mul(e,"s")),add(mul("oc",n*n),"c"))),"\n}")},rotateZ=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rotateZ";return rotate(t,0,0,1)},ShaderTool=Object.freeze({add:add,sub:sub,mul:mul,asFloat:asFloat,ret:ret,mat4:mat4$1,rotate:rotate,rotateZ:rotateZ});function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function asyncGeneratorStep(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t){asyncGeneratorStep(o,n,i,a,s,"next",t)}function s(t){asyncGeneratorStep(o,n,i,a,s,"throw",t)}a(void 0)})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _get(t,e,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=_superPropBase(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArrayLimit(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var AABB2=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_classCallCheck(this,t),e<r?(this.minX=e,this.maxX=r):(this.minX=r,this.maxX=e),n<i?(this.minY=n,this.maxY=i):(this.minY=i,this.maxY=n)}return _createClass(t,[{key:"addPoint",value:function(t,e){t<this.minX?this.minX=t:t>this.maxX&&(this.maxX=t),e<this.minY?this.minY=e:e>this.maxY&&(this.maxY=e)}},{key:"isInside",value:function(t,e){return t>=this.minX&&t<this.maxX&&e>=this.minY&&e<this.maxY}},{key:"isIntersection",value:function(t){return!(t.maxX<=this.minX||t.minX>=this.maxX||t.maxY<=this.minY||t.minY>=this.maxY)}},{key:"width",get:function(){return this.maxX-this.minX},set:function(t){this.maxX=this.minX+t}},{key:"height",get:function(){return this.maxY-this.minY},set:function(t){this.maxY=this.minY+t}},{key:"centerX",get:function(){return this.minX+(this.maxX-this.minX)/2}},{key:"centerY",get:function(){return this.minY+(this.maxY-this.minY)/2}}]),t}(),_flags=function(){var t=_anObject(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};_descriptors&&"g"!=/./g.flags&&_objectDp.f(RegExp.prototype,"flags",{configurable:!0,get:_flags});var TO_STRING="toString",$toString=/./[TO_STRING],define=function(t){_redefine(RegExp.prototype,TO_STRING,t,!0)};_fails(function(){return"/a/b"!=$toString.call({source:"a",flags:"b"})})?define(function(){var t=_anObject(this);return"/".concat(t.source,"/","flags"in t?t.flags:!_descriptors&&t instanceof RegExp?_flags.call(t):void 0)}):$toString.name!=TO_STRING&&define(function(){return $toString.call(this)});var DateProto=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING$1="toString",$toString$1=DateProto[TO_STRING$1],getTime=DateProto.getTime;new Date(NaN)+""!=INVALID_DATE&&_redefine(DateProto,TO_STRING$1,function(){var t=getTime.call(this);return t==t?$toString$1.call(this):INVALID_DATE}),_fixReWks("replace",2,function(t,e,r){return[function(n,i){var o=t(this),a=null==n?void 0:n[e];return void 0!==a?a.call(n,o,i):r.call(String(o),n,i)},r]});for(var Typed,uuid=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^16*Math.random()>>t/4).toString(16)})},DataRef=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,t),this.type=e,this.data_=r,this.id=n&&n.id?String(n.id):uuid(),this.serial=n&&"number"==typeof n.serial?n.serial:1,this.hints=n}return _createClass(t,[{key:"touch",value:function(){this.serial++}},{key:"isSynced",value:function(t){var e=this.serial;return e>0&&e===t.serial}},{key:"needSync",value:function(t){return!this.isSynced(t)}},{key:"sync",value:function(t,e){this.needSync(t)&&(e(this.data),this.serial=t.serial)}},{key:"hasHint",value:function(t,e){return 1===arguments.length?Boolean(this.hints&&t in this.hints):Boolean(this.hints&&t in this.hints&&this.hints[t]===e)}},{key:"hint",value:function(t){return this.hints&&this.hints[t]}},{key:"data",get:function(){return this.data_},set:function(t){t!==this.data_&&(this.data_=t,this.touch())}}]),t}(),TYPED=_uid("typed_array"),VIEW=_uid("view"),ABV=!(!_global.ArrayBuffer||!_global.DataView),CONSTR=ABV,i=0,l=9,TypedArrayConstructors="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");i<l;)(Typed=_global[TypedArrayConstructors[i++]])?(_hide(Typed.prototype,TYPED,!0),_hide(Typed.prototype,VIEW,!0)):CONSTR=!1;var _typed={ABV:ABV,CONSTR:CONSTR,TYPED:TYPED,VIEW:VIEW},_redefineAll=function(t,e,r){for(var n in e)_redefine(t,n,e[n],r);return t},_anInstance=function(t,e,r,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(r+": incorrect invocation!");return t},ceil=Math.ceil,floor=Math.floor,_toInteger=function(t){return isNaN(t=+t)?0:(t>0?floor:ceil)(t)},min=Math.min,_toLength=function(t){return t>0?min(_toInteger(t),9007199254740991):0},_toIndex=function(t){if(void 0===t)return 0;var e=_toInteger(t),r=_toLength(e);if(e!==r)throw RangeError("Wrong length!");return r},toString={}.toString,_cof=function(t){return toString.call(t).slice(8,-1)},_iobject=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==_cof(t)?t.split(""):Object(t)},_toIobject=function(t){return _iobject(_defined(t))},max=Math.max,min$1=Math.min,_toAbsoluteIndex=function(t,e){return(t=_toInteger(t))<0?max(t+e,0):min$1(t,e)},_arrayIncludes=function(t){return function(e,r,n){var i,o=_toIobject(e),a=_toLength(o.length),s=_toAbsoluteIndex(n,a);if(t&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===r)return t||s||0;return!t&&-1}},shared=_shared("keys"),_sharedKey=function(t){return shared[t]||(shared[t]=_uid(t))},arrayIndexOf=_arrayIncludes(!1),IE_PROTO=_sharedKey("IE_PROTO"),_objectKeysInternal=function(t,e){var r,n=_toIobject(t),i=0,o=[];for(r in n)r!=IE_PROTO&&_has(n,r)&&o.push(r);for(;e.length>i;)_has(n,r=e[i++])&&(~arrayIndexOf(o,r)||o.push(r));return o},_enumBugKeys="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),hiddenKeys=_enumBugKeys.concat("length","prototype"),f$1=Object.getOwnPropertyNames||function(t){return _objectKeysInternal(t,hiddenKeys)},_objectGopn={f:f$1},_toObject=function(t){return Object(_defined(t))},_arrayFill=function(t){for(var e=_toObject(this),r=_toLength(e.length),n=arguments.length,i=_toAbsoluteIndex(n>1?arguments[1]:void 0,r),o=n>2?arguments[2]:void 0,a=void 0===o?r:_toAbsoluteIndex(o,r);a>i;)e[i++]=t;return e},def=_objectDp.f,TAG=_wks("toStringTag"),_setToStringTag=function(t,e,r){t&&!_has(t=r?t:t.prototype,TAG)&&def(t,TAG,{configurable:!0,value:e})},_typedBuffer=createCommonjsModule(function(t,e){var r=_objectGopn.f,n=_objectDp.f,i="prototype",o="Wrong index!",a=_global.ArrayBuffer,s=_global.DataView,c=_global.Math,u=_global.RangeError,l=_global.Infinity,f=a,h=c.abs,d=c.pow,p=c.floor,_=c.log,y=c.LN2,v=_descriptors?"_b":"buffer",g=_descriptors?"_l":"byteLength",m=_descriptors?"_o":"byteOffset";function b(t,e,r){var n,i,o,a=new Array(r),s=8*r-e-1,c=(1<<s)-1,u=c>>1,f=23===e?d(2,-24)-d(2,-77):0,v=0,g=t<0||0===t&&1/t<0?1:0;for((t=h(t))!=t||t===l?(i=t!=t?1:0,n=c):(n=p(_(t)/y),t*(o=d(2,-n))<1&&(n--,o*=2),(t+=n+u>=1?f/o:f*d(2,1-u))*o>=2&&(n++,o/=2),n+u>=c?(i=0,n=c):n+u>=1?(i=(t*o-1)*d(2,e),n+=u):(i=t*d(2,u-1)*d(2,e),n=0));e>=8;a[v++]=255&i,i/=256,e-=8);for(n=n<<e|i,s+=e;s>0;a[v++]=255&n,n/=256,s-=8);return a[--v]|=128*g,a}function x(t,e,r){var n,i=8*r-e-1,o=(1<<i)-1,a=o>>1,s=i-7,c=r-1,u=t[c--],f=127&u;for(u>>=7;s>0;f=256*f+t[c],c--,s-=8);for(n=f&(1<<-s)-1,f>>=-s,s+=e;s>0;n=256*n+t[c],c--,s-=8);if(0===f)f=1-a;else{if(f===o)return n?NaN:u?-l:l;n+=d(2,e),f-=a}return(u?-1:1)*n*d(2,f-e)}function O(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function E(t){return[255&t]}function A(t){return[255&t,t>>8&255]}function S(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function w(t){return b(t,52,8)}function T(t){return b(t,23,4)}function P(t,e,r){n(t[i],e,{get:function(){return this[r]}})}function k(t,e,r,n){var i=_toIndex(+r);if(i+e>t[g])throw u(o);var a=t[v]._b,s=i+t[m],c=a.slice(s,s+e);return n?c:c.reverse()}function C(t,e,r,n,i,a){var s=_toIndex(+r);if(s+e>t[g])throw u(o);for(var c=t[v]._b,l=s+t[m],f=n(+i),h=0;h<e;h++)c[l+h]=f[a?h:e-h-1]}if(_typed.ABV){if(!_fails(function(){a(1)})||!_fails(function(){new a(-1)})||_fails(function(){return new a,new a(1.5),new a(NaN),"ArrayBuffer"!=a.name})){for(var R,V=(a=function(t){return _anInstance(this,a),new f(_toIndex(t))})[i]=f[i],j=r(f),I=0;j.length>I;)(R=j[I++])in a||_hide(a,R,f[R]);V.constructor=a}var $=new s(new a(2)),L=s[i].setInt8;$.setInt8(0,2147483648),$.setInt8(1,2147483649),!$.getInt8(0)&&$.getInt8(1)||_redefineAll(s[i],{setInt8:function(t,e){L.call(this,t,e<<24>>24)},setUint8:function(t,e){L.call(this,t,e<<24>>24)}},!0)}else a=function(t){_anInstance(this,a,"ArrayBuffer");var e=_toIndex(t);this._b=_arrayFill.call(new Array(e),0),this[g]=e},s=function(t,e,r){_anInstance(this,s,"DataView"),_anInstance(t,a,"DataView");var n=t[g],i=_toInteger(e);if(i<0||i>n)throw u("Wrong offset!");if(i+(r=void 0===r?n-i:_toLength(r))>n)throw u("Wrong length!");this[v]=t,this[m]=i,this[g]=r},_descriptors&&(P(a,"byteLength","_l"),P(s,"buffer","_b"),P(s,"byteLength","_l"),P(s,"byteOffset","_o")),_redefineAll(s[i],{getInt8:function(t){return k(this,1,t)[0]<<24>>24},getUint8:function(t){return k(this,1,t)[0]},getInt16:function(t){var e=k(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=k(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return O(k(this,4,t,arguments[1]))},getUint32:function(t){return O(k(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return x(k(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return x(k(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){C(this,1,t,E,e)},setUint8:function(t,e){C(this,1,t,E,e)},setInt16:function(t,e){C(this,2,t,A,e,arguments[2])},setUint16:function(t,e){C(this,2,t,A,e,arguments[2])},setInt32:function(t,e){C(this,4,t,S,e,arguments[2])},setUint32:function(t,e){C(this,4,t,S,e,arguments[2])},setFloat32:function(t,e){C(this,4,t,T,e,arguments[2])},setFloat64:function(t,e){C(this,8,t,w,e,arguments[2])}});_setToStringTag(a,"ArrayBuffer"),_setToStringTag(s,"DataView"),_hide(s[i],_typed.VIEW,!0),e.ArrayBuffer=a,e.DataView=s}),TAG$1=_wks("toStringTag"),ARG="Arguments"==_cof(function(){return arguments}()),tryGet=function(t,e){try{return t[e]}catch(t){}},_classof=function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=tryGet(e=Object(t),TAG$1))?r:ARG?_cof(e):"Object"==(n=_cof(e))&&"function"==typeof e.callee?"Arguments":n},_iterators={},ITERATOR=_wks("iterator"),ArrayProto=Array.prototype,_isArrayIter=function(t){return void 0!==t&&(_iterators.Array===t||ArrayProto[ITERATOR]===t)},_objectKeys=Object.keys||function(t){return _objectKeysInternal(t,_enumBugKeys)},_objectDps=_descriptors?Object.defineProperties:function(t,e){_anObject(t);for(var r,n=_objectKeys(e),i=n.length,o=0;i>o;)_objectDp.f(t,r=n[o++],e[r]);return t},document$2=_global.document,_html=document$2&&document$2.documentElement,IE_PROTO$1=_sharedKey("IE_PROTO"),Empty=function(){},PROTOTYPE$1="prototype",createDict=function(){var t,e=_domCreate("iframe"),r=_enumBugKeys.length;for(e.style.display="none",_html.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),createDict=t.F;r--;)delete createDict[PROTOTYPE$1][_enumBugKeys[r]];return createDict()},_objectCreate=Object.create||function(t,e){var r;return null!==t?(Empty[PROTOTYPE$1]=_anObject(t),r=new Empty,Empty[PROTOTYPE$1]=null,r[IE_PROTO$1]=t):r=createDict(),void 0===e?r:_objectDps(r,e)},IE_PROTO$2=_sharedKey("IE_PROTO"),ObjectProto=Object.prototype,_objectGpo=Object.getPrototypeOf||function(t){return t=_toObject(t),_has(t,IE_PROTO$2)?t[IE_PROTO$2]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ObjectProto:null},ITERATOR$1=_wks("iterator"),core_getIteratorMethod=_core.getIteratorMethod=function(t){if(null!=t)return t[ITERATOR$1]||t["@@iterator"]||_iterators[_classof(t)]},_isArray=Array.isArray||function(t){return"Array"==_cof(t)},SPECIES=_wks("species"),_arraySpeciesConstructor=function(t){var e;return _isArray(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!_isArray(e.prototype)||(e=void 0),_isObject(e)&&null===(e=e[SPECIES])&&(e=void 0)),void 0===e?Array:e},_arraySpeciesCreate=function(t,e){return new(_arraySpeciesConstructor(t))(e)},_arrayMethods=function(t,e){var r=1==t,n=2==t,i=3==t,o=4==t,a=6==t,s=5==t||a,c=e||_arraySpeciesCreate;return function(e,u,l){for(var f,h,d=_toObject(e),p=_iobject(d),_=_ctx(u,l,3),y=_toLength(p.length),v=0,g=r?c(e,y):n?c(e,0):void 0;y>v;v++)if((s||v in p)&&(h=_(f=p[v],v,d),t))if(r)g[v]=h;else if(h)switch(t){case 3:return!0;case 5:return f;case 6:return v;case 2:g.push(f)}else if(o)return!1;return a?-1:i||o?o:g}},SPECIES$1=_wks("species"),_speciesConstructor=function(t,e){var r,n=_anObject(t).constructor;return void 0===n||null==(r=_anObject(n)[SPECIES$1])?e:_aFunction(r)},UNSCOPABLES=_wks("unscopables"),ArrayProto$1=Array.prototype;null==ArrayProto$1[UNSCOPABLES]&&_hide(ArrayProto$1,UNSCOPABLES,{});var _addToUnscopables=function(t){ArrayProto$1[UNSCOPABLES][t]=!0},_iterStep=function(t,e){return{value:e,done:!!t}},IteratorPrototype={};_hide(IteratorPrototype,_wks("iterator"),function(){return this});var _iterCreate=function(t,e,r){t.prototype=_objectCreate(IteratorPrototype,{next:_propertyDesc(1,r)}),_setToStringTag(t,e+" Iterator")},ITERATOR$2=_wks("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values",returnThis=function(){return this},_iterDefine=function(t,e,r,n,i,o,a){_iterCreate(r,e,n);var s,c,u,l=function(t){if(!BUGGY&&t in p)return p[t];switch(t){case KEYS:case VALUES:return function(){return new r(this,t)}}return function(){return new r(this,t)}},f=e+" Iterator",h=i==VALUES,d=!1,p=t.prototype,_=p[ITERATOR$2]||p[FF_ITERATOR]||i&&p[i],y=_||l(i),v=i?h?l("entries"):y:void 0,g="Array"==e&&p.entries||_;if(g&&(u=_objectGpo(g.call(new t)))!==Object.prototype&&u.next&&(_setToStringTag(u,f,!0),"function"!=typeof u[ITERATOR$2]&&_hide(u,ITERATOR$2,returnThis)),h&&_&&_.name!==VALUES&&(d=!0,y=function(){return _.call(this)}),(BUGGY||d||!p[ITERATOR$2])&&_hide(p,ITERATOR$2,y),_iterators[e]=y,_iterators[f]=returnThis,i)if(s={values:h?y:l(VALUES),keys:o?y:l(KEYS),entries:v},a)for(c in s)c in p||_redefine(p,c,s[c]);else _export(_export.P+_export.F*(BUGGY||d),e,s);return s},es6_array_iterator=_iterDefine(Array,"Array",function(t,e){this._t=_toIobject(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,_iterStep(1)):_iterStep(0,"keys"==e?r:"values"==e?t[r]:[r,t[r]])},"values");_iterators.Arguments=_iterators.Array,_addToUnscopables("keys"),_addToUnscopables("values"),_addToUnscopables("entries");var ITERATOR$3=_wks("iterator"),SAFE_CLOSING=!1;try{var riter=[7][ITERATOR$3]();riter.return=function(){SAFE_CLOSING=!0}}catch(t){}var _iterDetect=function(t,e){if(!e&&!SAFE_CLOSING)return!1;var r=!1;try{var n=[7],i=n[ITERATOR$3]();i.next=function(){return{done:r=!0}},n[ITERATOR$3]=function(){return i},t(n)}catch(t){}return r},SPECIES$2=_wks("species"),_setSpecies=function(t){var e=_global[t];_descriptors&&e&&!e[SPECIES$2]&&_objectDp.f(e,SPECIES$2,{configurable:!0,get:function(){return this}})},_arrayCopyWithin=[].copyWithin||function(t,e){var r=_toObject(this),n=_toLength(r.length),i=_toAbsoluteIndex(t,n),o=_toAbsoluteIndex(e,n),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?n:_toAbsoluteIndex(a,n))-o,n-i),c=1;for(o<i&&i<o+s&&(c=-1,o+=s-1,i+=s-1);s-- >0;)o in r?r[i]=r[o]:delete r[i],i+=c,o+=c;return r},f$2={}.propertyIsEnumerable,_objectPie={f:f$2},gOPD=Object.getOwnPropertyDescriptor,f$3=_descriptors?gOPD:function(t,e){if(t=_toIobject(t),e=_toPrimitive(e,!0),_ie8DomDefine)try{return gOPD(t,e)}catch(t){}if(_has(t,e))return _propertyDesc(!_objectPie.f.call(t,e),t[e])},_objectGopd={f:f$3},_typedArray=createCommonjsModule(function(t){if(_descriptors){var e=_global,r=_fails,n=_export,i=_typed,o=_typedBuffer,a=_ctx,s=_anInstance,c=_propertyDesc,u=_hide,l=_redefineAll,f=_toInteger,h=_toLength,d=_toIndex,p=_toAbsoluteIndex,_=_toPrimitive,y=_has,v=_classof,g=_isObject,m=_toObject,b=_isArrayIter,x=_objectCreate,O=_objectGpo,E=_objectGopn.f,A=core_getIteratorMethod,S=_uid,w=_wks,T=_arrayMethods,P=_arrayIncludes,k=_speciesConstructor,C=es6_array_iterator,R=_iterators,V=_iterDetect,j=_setSpecies,I=_arrayFill,$=_arrayCopyWithin,L=_objectDp,N=_objectGopd,D=L.f,M=N.f,G=e.RangeError,F=e.TypeError,B=e.Uint8Array,U=Array.prototype,Y=o.ArrayBuffer,W=o.DataView,H=T(0),z=T(2),X=T(3),K=T(4),Z=T(5),q=T(6),J=P(!0),Q=P(!1),tt=C.values,et=C.keys,rt=C.entries,nt=U.lastIndexOf,it=U.reduce,ot=U.reduceRight,at=U.join,st=U.sort,ct=U.slice,ut=U.toString,lt=U.toLocaleString,ft=w("iterator"),ht=w("toStringTag"),dt=S("typed_constructor"),pt=S("def_constructor"),_t=i.CONSTR,yt=i.TYPED,vt=i.VIEW,gt=T(1,function(t,e){return Et(k(t,t[pt]),e)}),mt=r(function(){return 1===new B(new Uint16Array([1]).buffer)[0]}),bt=!!B&&!!B.prototype.set&&r(function(){new B(1).set({})}),xt=function(t,e){var r=f(t);if(r<0||r%e)throw G("Wrong offset!");return r},Ot=function(t){if(g(t)&&yt in t)return t;throw F(t+" is not a typed array!")},Et=function(t,e){if(!(g(t)&&dt in t))throw F("It is not a typed array constructor!");return new t(e)},At=function(t,e){return St(k(t,t[pt]),e)},St=function(t,e){for(var r=0,n=e.length,i=Et(t,n);n>r;)i[r]=e[r++];return i},wt=function(t,e,r){D(t,e,{get:function(){return this._d[r]}})},Tt=function(t){var e,r,n,i,o,s,c=m(t),u=arguments.length,l=u>1?arguments[1]:void 0,f=void 0!==l,d=A(c);if(null!=d&&!b(d)){for(s=d.call(c),n=[],e=0;!(o=s.next()).done;e++)n.push(o.value);c=n}for(f&&u>2&&(l=a(l,arguments[2],2)),e=0,r=h(c.length),i=Et(this,r);r>e;e++)i[e]=f?l(c[e],e):c[e];return i},Pt=function(){for(var t=0,e=arguments.length,r=Et(this,e);e>t;)r[t]=arguments[t++];return r},kt=!!B&&r(function(){lt.call(new B(1))}),Ct=function(){return lt.apply(kt?ct.call(Ot(this)):Ot(this),arguments)},Rt={copyWithin:function(t,e){return $.call(Ot(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return K(Ot(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return I.apply(Ot(this),arguments)},filter:function(t){return At(this,z(Ot(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return Z(Ot(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return q(Ot(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){H(Ot(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return Q(Ot(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return J(Ot(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return at.apply(Ot(this),arguments)},lastIndexOf:function(t){return nt.apply(Ot(this),arguments)},map:function(t){return gt(Ot(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return it.apply(Ot(this),arguments)},reduceRight:function(t){return ot.apply(Ot(this),arguments)},reverse:function(){for(var t,e=Ot(this).length,r=Math.floor(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this},some:function(t){return X(Ot(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return st.call(Ot(this),t)},subarray:function(t,e){var r=Ot(this),n=r.length,i=p(t,n);return new(k(r,r[pt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,h((void 0===e?n:p(e,n))-i))}},Vt=function(t,e){return At(this,ct.call(Ot(this),t,e))},jt=function(t){Ot(this);var e=xt(arguments[1],1),r=this.length,n=m(t),i=h(n.length),o=0;if(i+e>r)throw G("Wrong length!");for(;o<i;)this[e+o]=n[o++]},It={entries:function(){return rt.call(Ot(this))},keys:function(){return et.call(Ot(this))},values:function(){return tt.call(Ot(this))}},$t=function(t,e){return g(t)&&t[yt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Lt=function(t,e){return $t(t,e=_(e,!0))?c(2,t[e]):M(t,e)},Nt=function(t,e,r){return!($t(t,e=_(e,!0))&&g(r)&&y(r,"value"))||y(r,"get")||y(r,"set")||r.configurable||y(r,"writable")&&!r.writable||y(r,"enumerable")&&!r.enumerable?D(t,e,r):(t[e]=r.value,t)};_t||(N.f=Lt,L.f=Nt),n(n.S+n.F*!_t,"Object",{getOwnPropertyDescriptor:Lt,defineProperty:Nt}),r(function(){ut.call({})})&&(ut=lt=function(){return at.call(this)});var Dt=l({},Rt);l(Dt,It),u(Dt,ft,It.values),l(Dt,{slice:Vt,set:jt,constructor:function(){},toString:ut,toLocaleString:Ct}),wt(Dt,"buffer","b"),wt(Dt,"byteOffset","o"),wt(Dt,"byteLength","l"),wt(Dt,"length","e"),D(Dt,ht,{get:function(){return this[yt]}}),t.exports=function(t,o,a,c){var l=t+((c=!!c)?"Clamped":"")+"Array",f="get"+t,p="set"+t,_=e[l],y=_||{},m=_&&O(_),b=!_||!i.ABV,A={},S=_&&_.prototype,w=function(t,e){D(t,e,{get:function(){return function(t,e){var r=t._d;return r.v[f](e*o+r.o,mt)}(this,e)},set:function(t){return function(t,e,r){var n=t._d;c&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),n.v[p](e*o+n.o,r,mt)}(this,e,t)},enumerable:!0})};b?(_=a(function(t,e,r,n){s(t,_,l,"_d");var i,a,c,f,p=0,y=0;if(g(e)){if(!(e instanceof Y||"ArrayBuffer"==(f=v(e))||"SharedArrayBuffer"==f))return yt in e?St(_,e):Tt.call(_,e);i=e,y=xt(r,o);var m=e.byteLength;if(void 0===n){if(m%o)throw G("Wrong length!");if((a=m-y)<0)throw G("Wrong length!")}else if((a=h(n)*o)+y>m)throw G("Wrong length!");c=a/o}else c=d(e),i=new Y(a=c*o);for(u(t,"_d",{b:i,o:y,l:a,e:c,v:new W(i)});p<c;)w(t,p++)}),S=_.prototype=x(Dt),u(S,"constructor",_)):r(function(){_(1)})&&r(function(){new _(-1)})&&V(function(t){new _,new _(null),new _(1.5),new _(t)},!0)||(_=a(function(t,e,r,n){var i;return s(t,_,l),g(e)?e instanceof Y||"ArrayBuffer"==(i=v(e))||"SharedArrayBuffer"==i?void 0!==n?new y(e,xt(r,o),n):void 0!==r?new y(e,xt(r,o)):new y(e):yt in e?St(_,e):Tt.call(_,e):new y(d(e))}),H(m!==Function.prototype?E(y).concat(E(m)):E(y),function(t){t in _||u(_,t,y[t])}),_.prototype=S,S.constructor=_);var T=S[ft],P=!!T&&("values"==T.name||null==T.name),k=It.values;u(_,dt,!0),u(S,yt,l),u(S,vt,!0),u(S,pt,_),(c?new _(1)[ht]==l:ht in S)||D(S,ht,{get:function(){return l}}),A[l]=_,n(n.G+n.W+n.F*(_!=y),A),n(n.S,l,{BYTES_PER_ELEMENT:o}),n(n.S+n.F*r(function(){y.of.call(_,1)}),l,{from:Tt,of:Pt}),"BYTES_PER_ELEMENT"in S||u(S,"BYTES_PER_ELEMENT",o),n(n.P,l,Rt),j(l),n(n.P+n.F*bt,l,{set:jt}),n(n.P+n.F*!P,l,It),S.toString!=ut&&(S.toString=ut),n(n.P+n.F*r(function(){new _(1).slice()}),l,{slice:Vt}),n(n.P+n.F*(r(function(){return[1,2].toLocaleString()!=new _([1,2]).toLocaleString()})||!r(function(){S.toLocaleString.call([1,2])})),l,{toLocaleString:Ct}),R[l]=P?T:k,P||u(S,ft,k)}}else t.exports=function(){}});_typedArray("Uint16",2,function(t){return function(e,r,n){return t(this,e,r,n)}});var defer,channel,port,ElementIndexArray=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"static";_classCallCheck(this,t),this.objectCount=e,this.itemCount=r,this.length=e*r,this.array=new Uint16Array(this.length),this.ref=new DataRef("ElementIndexArray",this,{usage:n,target:"ELEMENT_ARRAY_BUFFER",typedArray:this.array})}return _createClass(t,null,[{key:"Generate",value:function(e,r,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"static",a=new t(e,r.length,o),s=0;s<e;++s)for(var c=0;c<r.length;++c)a.array[s*a.itemCount+c]=r[c]+(s+i)*n;return a}}]),t}(),IndexedPrimitive=function(){function t(e,r){_classCallCheck(this,t),this.primitiveType=e,this.elementIndexArray=r}return _createClass(t,null,[{key:"createQuads",value:function(e){return new t("TRIANGLES",ElementIndexArray.Generate(e,[0,1,2,0,2,3],4))}}]),t}(),DEG2RAD=Math.PI/180,Mat4=function(){function t(){_classCallCheck(this,t),this.mat4=mat4.create()}return _createClass(t,[{key:"identity",value:function(){mat4.identity(this.mat4)}},{key:"ortho",value:function(t,e){var r=t>>1,n=e>>1,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Math.pow(2,16))>>1;mat4.ortho(this.mat4,-r,r,-n,n,-i,i)}},{key:"perspective",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=t/e,i=e/2,o=2*Math.atan(i/r);mat4.perspective(this.mat4,o,n,0,2e3),mat4.translate(this.mat4,this.mat4,[0,0,-r])}},{key:"translate",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;mat4.translate(this.mat4,this.mat4,[t,e,r])}},{key:"scale",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;mat4.scale(this.mat4,this.mat4,[t,e,r])}},{key:"rotateX",value:function(t){mat4.rotateX(this.mat4,this.mat4,t*DEG2RAD)}},{key:"rotateY",value:function(t){mat4.rotateY(this.mat4,this.mat4,t*DEG2RAD)}},{key:"rotateZ",value:function(t){mat4.rotateZ(this.mat4,this.mat4,t*DEG2RAD)}},{key:"multiply",value:function(t,e){mat4.multiply(this.mat4,t.mat4,e.mat4)}},{key:"copy",value:function(t){mat4.copy(this.mat4,t.mat4)}},{key:"clone",value:function(){var e=new t;return e.copy(this),e}},{key:"x",get:function(){return this.mat4[12]},set:function(t){this.mat4[12]=t}},{key:"y",get:function(){return this.mat4[13]},set:function(t){this.mat4[13]=t}},{key:"z",get:function(){return this.mat4[14]},set:function(t){this.mat4[14]=t}},{key:"sx",get:function(){return this.mat4[0]},set:function(t){this.mat4[0]=t}},{key:"sy",get:function(){return this.mat4[5]},set:function(t){this.mat4[5]=t}},{key:"sz",get:function(){return this.mat4[10]},set:function(t){this.mat4[10]=t}}]),t}(),_iterCall=function(t,e,r,n){try{return n?e(_anObject(r)[0],r[1]):e(r)}catch(e){var i=t.return;throw void 0!==i&&_anObject(i.call(t)),e}},_forOf=createCommonjsModule(function(t){var e={},r={},n=t.exports=function(t,n,i,o,a){var s,c,u,l,f=a?function(){return t}:core_getIteratorMethod(t),h=_ctx(i,o,n?2:1),d=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(_isArrayIter(f)){for(s=_toLength(t.length);s>d;d++)if((l=n?h(_anObject(c=t[d])[0],c[1]):h(t[d]))===e||l===r)return l}else for(u=f.call(t);!(c=u.next()).done;)if((l=_iterCall(u,h,c.value,n))===e||l===r)return l};n.BREAK=e,n.RETURN=r}),_invoke=function(t,e,r){var n=void 0===r;switch(e.length){case 0:return n?t():t.call(r);case 1:return n?t(e[0]):t.call(r,e[0]);case 2:return n?t(e[0],e[1]):t.call(r,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(r,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(r,e[0],e[1],e[2],e[3])}return t.apply(r,e)},process=_global.process,setTask=_global.setImmediate,clearTask=_global.clearImmediate,MessageChannel=_global.MessageChannel,Dispatch=_global.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",run=function(){var t=+this;if(queue.hasOwnProperty(t)){var e=queue[t];delete queue[t],e()}},listener=function(t){run.call(t.data)};setTask&&clearTask||(setTask=function(t){for(var e=[],r=1;arguments.length>r;)e.push(arguments[r++]);return queue[++counter]=function(){_invoke("function"==typeof t?t:Function(t),e)},defer(counter),counter},clearTask=function(t){delete queue[t]},"process"==_cof(process)?defer=function(t){process.nextTick(_ctx(run,t,1))}:Dispatch&&Dispatch.now?defer=function(t){Dispatch.now(_ctx(run,t,1))}:MessageChannel?(port=(channel=new MessageChannel).port2,channel.port1.onmessage=listener,defer=_ctx(port.postMessage,port,1)):_global.addEventListener&&"function"==typeof postMessage&&!_global.importScripts?(defer=function(t){_global.postMessage(t+"","*")},_global.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in _domCreate("script")?function(t){_html.appendChild(_domCreate("script"))[ONREADYSTATECHANGE]=function(){_html.removeChild(this),run.call(t)}}:function(t){setTimeout(_ctx(run,t,1),0)});var _task={set:setTask,clear:clearTask},macrotask=_task.set,Observer=_global.MutationObserver||_global.WebKitMutationObserver,process$1=_global.process,Promise$1=_global.Promise,isNode="process"==_cof(process$1),_microtask=function(){var t,e,r,n=function(){var n,i;for(isNode&&(n=process$1.domain)&&n.exit();t;){i=t.fn,t=t.next;try{i()}catch(n){throw t?r():e=void 0,n}}e=void 0,n&&n.enter()};if(isNode)r=function(){process$1.nextTick(n)};else if(!Observer||_global.navigator&&_global.navigator.standalone)if(Promise$1&&Promise$1.resolve){var i=Promise$1.resolve(void 0);r=function(){i.then(n)}}else r=function(){macrotask.call(_global,n)};else{var o=!0,a=document.createTextNode("");new Observer(n).observe(a,{characterData:!0}),r=function(){a.data=o=!o}}return function(n){var i={fn:n,next:void 0};e&&(e.next=i),t||(t=i,r()),e=i}};function PromiseCapability(t){var e,r;this.promise=new t(function(t,n){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=n}),this.resolve=_aFunction(e),this.reject=_aFunction(r)}var Internal,newGenericPromiseCapability,OwnPromiseCapability,Wrapper,f$4=function(t){return new PromiseCapability(t)},_newPromiseCapability={f:f$4},_perform=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},navigator=_global.navigator,_userAgent=navigator&&navigator.userAgent||"",_promiseResolve=function(t,e){if(_anObject(t),_isObject(e)&&e.constructor===t)return e;var r=_newPromiseCapability.f(t);return(0,r.resolve)(e),r.promise},task=_task.set,microtask=_microtask(),PROMISE="Promise",TypeError$1=_global.TypeError,process$2=_global.process,versions=process$2&&process$2.versions,v8=versions&&versions.v8||"",$Promise=_global[PROMISE],isNode$1="process"==_classof(process$2),empty=function(){},newPromiseCapability=newGenericPromiseCapability=_newPromiseCapability.f,USE_NATIVE=!!function(){try{var t=$Promise.resolve(1),e=(t.constructor={})[_wks("species")]=function(t){t(empty,empty)};return(isNode$1||"function"==typeof PromiseRejectionEvent)&&t.then(empty)instanceof e&&0!==v8.indexOf("6.6")&&-1===_userAgent.indexOf("Chrome/66")}catch(t){}}(),isThenable=function(t){var e;return!(!_isObject(t)||"function"!=typeof(e=t.then))&&e},notify=function(t,e){if(!t._n){t._n=!0;var r=t._c;microtask(function(){for(var n=t._v,i=1==t._s,o=0,a=function(e){var r,o,a,s=i?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(i||(2==t._h&&onHandleUnhandled(t),t._h=1),!0===s?r=n:(l&&l.enter(),r=s(n),l&&(l.exit(),a=!0)),r===e.promise?u(TypeError$1("Promise-chain cycle")):(o=isThenable(r))?o.call(r,c,u):c(r)):u(n)}catch(t){l&&!a&&l.exit(),u(t)}};r.length>o;)a(r[o++]);t._c=[],t._n=!1,e&&!t._h&&onUnhandled(t)})}},onUnhandled=function(t){task.call(_global,function(){var e,r,n,i=t._v,o=isUnhandled(t);if(o&&(e=_perform(function(){isNode$1?process$2.emit("unhandledRejection",i,t):(r=_global.onunhandledrejection)?r({promise:t,reason:i}):(n=_global.console)&&n.error&&n.error("Unhandled promise rejection",i)}),t._h=isNode$1||isUnhandled(t)?2:1),t._a=void 0,o&&e.e)throw e.v})},isUnhandled=function(t){return 1!==t._h&&0===(t._a||t._c).length},onHandleUnhandled=function(t){task.call(_global,function(){var e;isNode$1?process$2.emit("rejectionHandled",t):(e=_global.onrejectionhandled)&&e({promise:t,reason:t._v})})},$reject=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),notify(e,!0))},$resolve=function(t){var e,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw TypeError$1("Promise can't be resolved itself");(e=isThenable(t))?microtask(function(){var n={_w:r,_d:!1};try{e.call(t,_ctx($resolve,n,1),_ctx($reject,n,1))}catch(t){$reject.call(n,t)}}):(r._v=t,r._s=1,notify(r,!1))}catch(t){$reject.call({_w:r,_d:!1},t)}}};function convertToPowerOf2(t){var e=findNextPowerOf2(t.width),r=findNextPowerOf2(t.height),n=document.createElement("canvas");return n.width=e,n.height=r,n.getContext("2d").drawImage(t,0,0),n}function setPowerOf2ImgEl(t,e){t.imgEl=isPowerOf2(e.width)&&isPowerOf2(e.height)?e:convertToPowerOf2(e),t.origWidth=e.width,t.origHeight=e.height}USE_NATIVE||($Promise=function(t){_anInstance(this,$Promise,PROMISE,"_h"),_aFunction(t),Internal.call(this);try{t(_ctx($resolve,this,1),_ctx($reject,this,1))}catch(t){$reject.call(this,t)}},(Internal=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=_redefineAll($Promise.prototype,{then:function(t,e){var r=newPromiseCapability(_speciesConstructor(this,$Promise));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=isNode$1?process$2.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&notify(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),OwnPromiseCapability=function(){var t=new Internal;this.promise=t,this.resolve=_ctx($resolve,t,1),this.reject=_ctx($reject,t,1)},_newPromiseCapability.f=newPromiseCapability=function(t){return t===$Promise||t===Wrapper?new OwnPromiseCapability(t):newGenericPromiseCapability(t)}),_export(_export.G+_export.W+_export.F*!USE_NATIVE,{Promise:$Promise}),_setToStringTag($Promise,PROMISE),_setSpecies(PROMISE),Wrapper=_core[PROMISE],_export(_export.S+_export.F*!USE_NATIVE,PROMISE,{reject:function(t){var e=newPromiseCapability(this);return(0,e.reject)(t),e.promise}}),_export(_export.S+_export.F*!USE_NATIVE,PROMISE,{resolve:function(t){return _promiseResolve(this,t)}}),_export(_export.S+_export.F*!(USE_NATIVE&&_iterDetect(function(t){$Promise.all(t).catch(empty)})),PROMISE,{all:function(t){var e=this,r=newPromiseCapability(e),n=r.resolve,i=r.reject,o=_perform(function(){var r=[],o=0,a=1;_forOf(t,!1,function(t){var s=o++,c=!1;r.push(void 0),a++,e.resolve(t).then(function(t){c||(c=!0,r[s]=t,--a||n(r))},i)}),--a||n(r)});return o.e&&i(o.v),r.promise},race:function(t){var e=this,r=newPromiseCapability(e),n=r.reject,i=_perform(function(){_forOf(t,!1,function(t){e.resolve(t).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}});var PowerOf2Image=function(){function t(e){var r,n=this;_classCallCheck(this,t),"string"==typeof e?(r=new window.Image).src=e:r=e,!1===r.onLoaded||0===r.width&&0===r.height?(this.imgEl=null,this.onLoaded=new Promise(function(t){var e=r.onload;r.onload=function(){e&&e.call(r),setPowerOf2ImgEl(n,r),t(n)}})):(setPowerOf2ImgEl(this,r),this.onLoaded=Promise.resolve(this))}return _createClass(t,[{key:"isComplete",get:function(){return null!=this.imgEl}},{key:"width",get:function(){return this.imgEl&&this.imgEl.width||0}},{key:"height",get:function(){return this.imgEl&&this.imgEl.height||0}}]),t}(),COVER="cover",CONTAIN="contain",FILL="fill",Projection=function(){function t(e){var r=e.devicePixelRatio,n=e.fit,i=e.height,o=e.perspective,a=e.pixelRatio,s=e.width;_classCallCheck(this,t),this.desiredWidth=s||0,this.desiredHeight=i||0,this.desiredPixelRatio=a,this.customDevicePixelRatio=r,this.fit=n,this.perspective=o,this.lastPerspective=void 0,this.width=0,this.height=0,this.pixelRatio=0,this.rawWidth=0,this.rawHeight=0,this.mat4=new Mat4}return _createClass(t,[{key:"updateOrtho",value:function(t,e){var r=this.perspective;return(t!==this.width||e!==this.height||r!==this.lastPerspective)&&(this.width=t,this.height=e,this.lastPerspective=r,r>0?this.mat4.perspective(t,e,r):this.mat4.ortho(t,e),this.pixelRatio=this.rawHeight/e,!0)}},{key:"update",value:function(t,e){this.rawWidth=t,this.rawHeight=e;var r=this.desiredPixelRatio;if("number"==typeof r&&r>0){var n=this.devicePixelRatio*r,i=t/n,o=e/n;return this.updateOrtho(i,o)}if(this.fit===FILL&&this.desiredWidth>0&&this.desiredHeight>0)return this.updateOrtho(this.desiredWidth,this.desiredHeight);if((this.fit===COVER||this.fit===CONTAIN)&&this.desiredWidth>=0&&this.desiredHeight>=0){var a=e/t,s=this.desiredHeight/this.desiredWidth,c=this.fit===COVER,u=this.desiredWidth,l=this.desiredHeight;if(0===this.desiredWidth&&this.desiredHeight||a<s||1===a&&s>1){if(u=this.desiredHeight/e*t,c){var f=this.desiredWidth/u;u*=f,l*=f}}else if((this.desiredWidth&&0===this.desiredHeight||a>s||1===a&&s<1)&&(l=this.desiredWidth/t*e,c)){var h=this.desiredHeight/l;u*=h,l*=h}return this.updateOrtho(u,l)}return!1}},{key:"devicePixelRatio",get:function(){return this.customDevicePixelRatio||window.devicePixelRatio||1}},{key:"perspective",set:function(t){this._perspective="number"==typeof t?Math.abs(t):0},get:function(){return this._perspective}}]),t}(),f$5=Object.getOwnPropertySymbols,_objectGops={f:f$5},$assign=Object.assign,_objectAssign=!$assign||_fails(function(){var t={},e={},r=Symbol(),n="abcdefghijklmnopqrst";return t[r]=7,n.split("").forEach(function(t){e[t]=t}),7!=$assign({},t)[r]||Object.keys($assign({},e)).join("")!=n})?function(t,e){for(var r=_toObject(t),n=arguments.length,i=1,o=_objectGops.f,a=_objectPie.f;n>i;)for(var s,c=_iobject(arguments[i++]),u=o?_objectKeys(c).concat(o(c)):_objectKeys(c),l=u.length,f=0;l>f;)a.call(c,s=u[f++])&&(r[s]=c[s]);return r}:$assign;_export(_export.S+_export.F,"Object",{assign:_objectAssign});var ShaderVariable=function(t){function e(t,r,n,i){var o;return _classCallCheck(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,r,n,Object.assign({serial:0},i)))).name=t,o}return _inherits(e,DataRef),e}();ShaderVariable.UNIFORM="uniform",ShaderVariable.ATTRIB="attrib",ShaderVariable.TEXTURE_2D="tex2d";for(var ShaderUniformVariable=function(t){function e(t,r,n){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,ShaderVariable.UNIFORM,r,n))}return _inherits(e,ShaderVariable),e}(),PROJECTION_UNIFORM_NAME="projection",ProjectionUniform=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:PROJECTION_UNIFORM_NAME;return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,r,t.mat4,{projection:t}))}return _inherits(e,ShaderUniformVariable),_createClass(e,[{key:"update",value:function(t,e){this.projection.update(t,e)&&this.touch()}},{key:"projection",get:function(){return this.hint("projection")}}]),e}(),ITERATOR$4=_wks("iterator"),TO_STRING_TAG=_wks("toStringTag"),ArrayValues=_iterators.Array,DOMIterables={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},collections=_objectKeys(DOMIterables),i$1=0;i$1<collections.length;i$1++){var key,NAME=collections[i$1],explicit=DOMIterables[NAME],Collection=_global[NAME],proto=Collection&&Collection.prototype;if(proto&&(proto[ITERATOR$4]||_hide(proto,ITERATOR$4,ArrayValues),proto[TO_STRING_TAG]||_hide(proto,TO_STRING_TAG,NAME),_iterators[NAME]=ArrayValues,explicit))for(key in es6_array_iterator)proto[key]||_redefine(proto,key,es6_array_iterator[key],!0)}var _stringAt=function(t){return function(e,r){var n,i,o=String(_defined(e)),a=_toInteger(r),s=o.length;return a<0||a>=s?t?"":void 0:(n=o.charCodeAt(a))<55296||n>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?t?o.charAt(a):n:t?o.slice(a,a+2):i-56320+(n-55296<<10)+65536}},$at=_stringAt(!0);_iterDefine(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,r=this._i;return r>=e.length?{value:void 0,done:!0}:(t=$at(e,r),this._i+=t.length,{value:t,done:!1})});var _meta=createCommonjsModule(function(t){var e=_uid("meta"),r=_objectDp.f,n=0,i=Object.isExtensible||function(){return!0},o=!_fails(function(){return i(Object.preventExtensions({}))}),a=function(t){r(t,e,{value:{i:"O"+ ++n,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,r){if(!_isObject(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!_has(t,e)){if(!i(t))return"F";if(!r)return"E";a(t)}return t[e].i},getWeak:function(t,r){if(!_has(t,e)){if(!i(t))return!0;if(!r)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&i(t)&&!_has(t,e)&&a(t),t}}}),_meta_1=_meta.KEY,_meta_2=_meta.NEED,_meta_3=_meta.fastKey,_meta_4=_meta.getWeak,_meta_5=_meta.onFreeze,_validateCollection=function(t,e){if(!_isObject(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t},dP$1=_objectDp.f,fastKey=_meta.fastKey,SIZE=_descriptors?"_s":"size",getEntry=function(t,e){var r,n=fastKey(e);if("F"!==n)return t._i[n];for(r=t._f;r;r=r.n)if(r.k==e)return r},_collectionStrong={getConstructor:function(t,e,r,n){var i=t(function(t,o){_anInstance(t,i,e,"_i"),t._t=e,t._i=_objectCreate(null),t._f=void 0,t._l=void 0,t[SIZE]=0,null!=o&&_forOf(o,r,t[n],t)});return _redefineAll(i.prototype,{clear:function(){for(var t=_validateCollection(this,e),r=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];t._f=t._l=void 0,t[SIZE]=0},delete:function(t){var r=_validateCollection(this,e),n=getEntry(r,t);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[SIZE]--}return!!n},forEach:function(t){_validateCollection(this,e);for(var r,n=_ctx(t,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(t){return!!getEntry(_validateCollection(this,e),t)}}),_descriptors&&dP$1(i.prototype,"size",{get:function(){return _validateCollection(this,e)[SIZE]}}),i},def:function(t,e,r){var n,i,o=getEntry(t,e);return o?o.v=r:(t._l=o={i:i=fastKey(e,!0),k:e,v:r,p:n=t._l,n:void 0,r:!1},t._f||(t._f=o),n&&(n.n=o),t[SIZE]++,"F"!==i&&(t._i[i]=o)),t},getEntry:getEntry,setStrong:function(t,e,r){_iterDefine(t,e,function(t,r){this._t=_validateCollection(t,e),this._k=r,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?_iterStep(0,"keys"==t?e.k:"values"==t?e.v:[e.k,e.v]):(this._t=void 0,_iterStep(1))},r?"entries":"values",!r,!0),_setSpecies(e)}},check=function(t,e){if(_anObject(t),!_isObject(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},_setProto={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{(r=_ctx(Function.call,_objectGopd.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return check(t,n),e?t.__proto__=n:r(t,n),t}}({},!1):void 0),check:check},setPrototypeOf=_setProto.set,_inheritIfRequired=function(t,e,r){var n,i=e.constructor;return i!==r&&"function"==typeof i&&(n=i.prototype)!==r.prototype&&_isObject(n)&&setPrototypeOf&&setPrototypeOf(t,n),t},_collection=function(t,e,r,n,i,o){var a=_global[t],s=a,c=i?"set":"add",u=s&&s.prototype,l={},f=function(t){var e=u[t];_redefine(u,t,"delete"==t?function(t){return!(o&&!_isObject(t))&&e.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!_isObject(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!_isObject(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,r){return e.call(this,0===t?0:t,r),this})};if("function"==typeof s&&(o||u.forEach&&!_fails(function(){(new s).entries().next()}))){var h=new s,d=h[c](o?{}:-0,1)!=h,p=_fails(function(){h.has(1)}),_=_iterDetect(function(t){new s(t)}),y=!o&&_fails(function(){for(var t=new s,e=5;e--;)t[c](e,e);return!t.has(-0)});_||((s=e(function(e,r){_anInstance(e,s,t);var n=_inheritIfRequired(new a,e,s);return null!=r&&_forOf(r,i,n[c],n),n})).prototype=u,u.constructor=s),(p||y)&&(f("delete"),f("has"),i&&f("get")),(y||d)&&f(c),o&&u.clear&&delete u.clear}else s=n.getConstructor(e,t,i,c),_redefineAll(s.prototype,r),_meta.NEED=!0;return _setToStringTag(s,t),l[t]=s,_export(_export.G+_export.W+_export.F*(s!=a),l),o||n.setStrong(s,t,i),s},MAP="Map",es6_map=_collection(MAP,function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=_collectionStrong.getEntry(_validateCollection(this,MAP),t);return e&&e.v},set:function(t,e){return _collectionStrong.def(_validateCollection(this,MAP),0===t?0:t,e)}},_collectionStrong,!0),dP$2=_objectDp.f,FProto=Function.prototype,nameRE=/^\s*function ([^ (]*)/,NAME$1="name";NAME$1 in FProto||_descriptors&&dP$2(FProto,NAME$1,{configurable:!0,get:function(){try{return(""+this).match(nameRE)[1]}catch(t){return""}}});var _objectSap=function(t,e){var r=(_core.Object||{})[t]||Object[t],n={};n[t]=e(r),_export(_export.S+_export.F*_fails(function(){r(1)}),"Object",n)};_objectSap("keys",function(){return function(t){return _objectKeys(_toObject(t))}});var _strictMethod=function(t,e){return!!t&&_fails(function(){e?t.call(null,function(){},1):t.call(null)})},$forEach=_arrayMethods(0),STRICT=_strictMethod([].forEach,!0);_export(_export.P+_export.F*!STRICT,"Array",{forEach:function(t){return $forEach(this,t,arguments[1])}}),_export(_export.S,"Object",{create:_objectCreate}),_export(_export.G+_export.W+_export.F*!_typed.ABV,{DataView:_typedBuffer.DataView}),_typedArray("Uint8",1,function(t){return function(e,r,n){return t(this,e,r,n)}}),_typedArray("Uint32",4,function(t){return function(e,r,n){return t(this,e,r,n)}}),_typedArray("Int8",1,function(t){return function(e,r,n){return t(this,e,r,n)}}),_typedArray("Int32",4,function(t){return function(e,r,n){return t(this,e,r,n)}}),_typedArray("Int16",2,function(t){return function(e,r,n){return t(this,e,r,n)}}),_typedArray("Float32",4,function(t){return function(e,r,n){return t(this,e,r,n)}});var TYPED_ARRAY={float32:Float32Array,int16:Int16Array,int32:Int32Array,int8:Int8Array,uint16:Uint16Array,uint32:Uint32Array,uint8:Uint8Array},createBufferView=function(t,e,r){var n=t*e;if(r instanceof ArrayBuffer){if(n>r.byteLength)throw new TypeError("VOArray: [data] buffer is too small! needs ".concat(n," bytes (capacity=").concat(t," bytesPerVO=").concat(e,") but has ").concat(r.byteLength," bytes!"));return new DataView(r,0,n)}if(ArrayBuffer.isView(r)){var i=r.byteOffset,o=r.byteLength;if(n>o)throw new TypeError("VOArray: [data] buffer is too small! needs ".concat(n," bytes (capacity=").concat(t," bytesPerVO=").concat(e,") but has ").concat(o," (byteOffset=").concat(i,") bytes!"));return new DataView(r.buffer,i,n)}throw new TypeError("VOArray: [data] must be instanceof ArrayBuffer, DataView or TypedArray!")},typedArrayProp=function(t){return"".concat(t,"Array")},createLinkedTypedArrays=function(t,e,r,n){var i={};return n.forEach(function(n){var o=TYPED_ARRAY[n],a=new o(t,e,r/o.BYTES_PER_ELEMENT);i[typedArrayProp(n)]=a}),i},VOArray=function(){function t(e,r,n,i,o){if(_classCallCheck(this,t),r%4!=0)throw new TypeError("new VOArray: bytesPerVO must be divisible by 4 (but is not!) bytesPerVO=".concat(r));if(this.capacity=e,this.bytesPerVO=r,this.arrayTypes=n.slice(0),i){var a=createBufferView(e,r,i);this.buffer=a.buffer,this.bufferByteOffset=a.byteOffset,this.bufferByteLength=a.byteLength}else this.buffer=new ArrayBuffer(e*r),this.bufferByteOffset=0,this.bufferByteLength=this.buffer.byteLength;Object.assign(this,createLinkedTypedArrays(this.buffer,this.bufferByteOffset,this.bufferByteLength,n)),this.ref=new DataRef("VOArray",this,Object.assign({typedArray:this.toUint32Array(),serial:1},o))}return _createClass(t,[{key:"copy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.bytesPerVO/Uint32Array.BYTES_PER_ELEMENT,n=0;e>0&&(n=e*r),this.toUint32Array().set(t.toUint32Array(),n)}},{key:"toUint32Array",value:function(){var t=this.uint32Array;if(!t){var e=this.bytesPerVO/Uint32Array.BYTES_PER_ELEMENT;return this.uint32Array=new Uint32Array(this.buffer,this.bufferByteOffset,this.capacity*e),this.uint32Array}return t}},{key:"subarray",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.bytesPerVO,i=this.bufferByteOffset+e*n,o=r*n;return new t(r,n,this.arrayTypes,new DataView(this.buffer,i,o))}}]),t}(),$map=_arrayMethods(1);_export(_export.P+_export.F*!_strictMethod([].map,!0),"Array",{map:function(t){return $map(this,t,arguments[1])}}),_export(_export.S,"Array",{isArray:_isArray});var BYTES_PER_ELEMENT={float32:4,int16:2,int32:4,int8:1,uint16:2,uint32:4,uint8:1},TYPED_ARRAY_GETTER={float32:function(t){return t.float32Array},int32:function(t){return t.int32Array},int16:function(t){return t.int16Array},int8:function(t){return t.int8Array},uint32:function(t){return t.uint32Array},uint16:function(t){return t.uint16Array},uint8:function(t){return t.uint8Array}},camelize=function(t){return t[0].toUpperCase()+t.substr(1)},attrPostfix=function(t,e,r){if(t.scalars){var n=t.scalars[r];if(void 0!==n)return n}return"".concat(e,"_").concat(r)},getVNu=function(t,e){return function(r){return t(this.voArray)[e+r]}},setVNu=function(t,e,r,n,i){return function(){for(var o=t(this.voArray),a=0;a<r;++a)for(var s=0;s<e;++s)o[a*n+i+s]=arguments[s]}},getV1u=function(t,e){return function(){return t(this.voArray)[e]}},setVNv=function(t,e,r,n,i){return function(){for(var o=t(this.voArray),a=0;a<r;++a)for(var s=0;s<e;++s)o[a*n+i+s]=arguments[a*e+s]}},setV1u=function(t,e,r,n){return function(i){for(var o=t(this.voArray),a=0;a<e;++a)o[a*r+n]=i}},VOAttrDescriptor=function(){function t(e,r,n,i,o,a,s){_classCallCheck(this,t),this.name=e,this.type=r,this.size=n,this.uniform=a,this.scalars=s,this.bytesPerElement=BYTES_PER_ELEMENT[this.type],this.bytesPerVertex=this.bytesPerElement*n,this.byteOffset="number"!=typeof o?i*this.bytesPerElement:o,this.offset="number"!=typeof i?o/this.bytesPerElement:i}return _createClass(t,[{key:"vertexAttrCount",value:function(t){return t.bytesPerVertex/this.bytesPerElement}}],[{key:"defineProperties",value:function(t,e,r){var n=t.name,i=TYPED_ARRAY_GETTER[t.type],o=r.vertexCount,a=t.vertexAttrCount(r),s=t.byteOffset/t.bytesPerElement;if(1===t.size)if(t.uniform){var c=getV1u(i,s),u=setV1u(i,o,a,s);t.getValue=function(t){return c.call(t)},t.setValue=function(t,e){return u.call(t,e)},e[n]={get:c,set:u,enumerable:!0}}else{var l=setVNv(i,1,o,a,s);t.setValue=function(t,e){return l.apply(t,e)},e["set".concat(camelize(n))]={value:l,enumerable:!0};for(var f=[],h=0;h<r.vertexCount;++h){var d=getV1u(i,s+h*a);f.push(d),e[n+h]={get:d,set:setVNv(i,1,1,0,s+h*a),enumerable:!0}}t.getValue=function(t,e){return f[e].call(t)}}else if(t.size>=2)if(t.uniform){var p=getVNu(i,s),_=setVNu(i,t.size,o,a,s);t.getValue=function(t,e,r){return p.call(t,r)},t.setValue=function(t,e){return _.apply(t,e)},e["get".concat(camelize(n))]={value:p,enumerable:!0},e["set".concat(camelize(n))]={value:_,enumerable:!0};for(var y=0;y<t.size;++y){e[attrPostfix(t,n,y)]={get:getV1u(i,s+y),set:setV1u(i,o,a,s+y),enumerable:!0}}}else{var v=setVNv(i,t.size,o,a,s);t.setValue=function(t,e){return v.apply(t,e)},e["set".concat(camelize(n))]={value:v,enumerable:!0};for(var g=[],m=0;m<r.vertexCount;++m){for(var b=[],x=0;x<t.size;++x){var O=attrPostfix(t,n,x)+m,E=getV1u(i,s+m*a+x);b.push(E),e[O]={get:E,set:setVNv(i,1,1,0,s+m*a+x),enumerable:!0}}g.push(b)}t.getValue=function(t,e,r){return g[e][r].call(t)}}}}]),t}(),DEFAULT_ATTR_TYPE="float32",createAttributes=function(t,e){var r;if(Array.isArray(e)?r=e:"object"===_typeof(e)&&(r=Object.keys(e).map(function(t){var r=e[t];return Object.assign({name:t},Array.isArray(r)?{scalars:r}:r)})),!r)throw new Error("VODescriptor:createAttributes: attributes should be an array or an object!");t.attr={},t.scalars=[];for(var n=0,i=0,o=0;o<r.length;++o){var a=r[o],s=a.size;void 0===s&&(s=Array.isArray(a.scalars)?a.scalars.length:1);var c=a.type||DEFAULT_ATTR_TYPE;void 0!==a.name&&(t.scalars.push(a.name),t.attr[a.name]=new VOAttrDescriptor(a.name,c,s,n,i,!!a.uniform,a.scalars)),n+=s,i+=BYTES_PER_ELEMENT[c]*s}t.rightPadBytesPerVertex=i%4>0?4-i%4:0,t.bytesPerVertex=i+t.rightPadBytesPerVertex,t.bytesPerVO=t.bytesPerVertex*t.vertexCount,t.vertexAttrCount=n,t.attrList=t.scalars.map(function(e){return t.attr[e]})},createAliases=function(t,e){"object"===_typeof(e)&&Object.keys(e).forEach(function(r){var n=e[r];"string"==typeof n?void 0!==(n=t.attr[n])&&(t.attr[r]=n):t.attr[r]=new VOAttrDescriptor(r,n.type,n.size,n.offset,n.byteOffset,!!n.uniform,n.scalars)})},toArray=function(t){return function(e){for(var r=[],n=Array.isArray(e)?e.map(function(e){return t.attr[e]}):t.attrList,i=n.length,o=0;o<t.vertexCount;++o)for(var a=0;a<i;++a)for(var s=n[a],c=0;c<s.size;++c)r.push(s.getValue(this,o,c));return r}},createVOPrototype=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={toArray:{value:toArray(t)}};Object.keys(t.attr).forEach(function(e){var n=t.attr[e];VOAttrDescriptor.defineProperties(n,r,t)}),t.voPrototype=Object.create(e,r)},$filter=_arrayMethods(2);_export(_export.P+_export.F*!_strictMethod([].filter,!0),"Array",{filter:function(t){return $filter(this,t,arguments[1])}});var $sort=[].sort,test=[1,2,3];_export(_export.P+_export.F*(_fails(function(){test.sort(void 0)})||!_fails(function(){test.sort(null)})||!_strictMethod($sort)),"Array",{sort:function(t){return void 0===t?$sort.call(_toObject(this)):$sort.call(_toObject(this),_aFunction(t))}});var createTypedArrays=function(t){t.typedArrays={float32:!1,int16:!1,int32:!1,int8:!1,uint16:!1,uint32:!1,uint8:!1},Object.keys(t.attr).forEach(function(e){t.typedArrays[t.attr[e].type]=!0}),t.typeList=Object.keys(t.typedArrays).filter(function(e){return t.typedArrays[e]}).sort()},_createVO=function(t,e,r){if(t.descriptor=e,!t.descriptor)throw new Error("VODescriptor:createVO: could not read descriptor!");if(t.voArray=r||t.descriptor.createVOArray(),t.descriptor.bytesPerVO!==t.voArray.bytesPerVO&&t.descriptor.typeList.join()!==t.voArray.arrayTypes.join())throw new TypeError("VODescriptor:createVO: descriptor and voArray are not compatible with each other!");return t},VODescriptor=function(){function t(e){var r=e.vertexCount,n=e.instanceOf,i=e.attributes,o=e.aliases,a=e.proto;_classCallCheck(this,t),this.vertexCount=parseInt(r,10)||1,this.isInstanced=null!=n,this.base=n,createAttributes(this,i),createAliases(this,o),createVOPrototype(this,a),createTypedArrays(this)}return _createClass(t,[{key:"createVOArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new VOArray(t,this.bytesPerVO,this.typeList,null,Object.assign({descriptor:this,usage:"dynamic",doubleBuffer:!0},e))}},{key:"createVO",value:function(t,e){var r=this,n=_createVO(Object.create(this.voPrototype),this,t);switch(_typeof(e)){case"function":e(n);break;case"object":Object.keys(e).forEach(function(t){var i=r.attr[t];i?i.setValue(n,e[t]):"function"==typeof n[t]?n[t](e[t]):n[t]=e[t]})}return n}},{key:"hasAttribute",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=this.attr[t];return r&&r.size===e}},{key:"maxIndexedVOPoolSize",get:function(){return Math.floor(65536/this.vertexCount)}}]),t}(),ShaderSource=function(){function t(e,r,n,i){if(_classCallCheck(this,t),this.id=n||uuid(),this.type=e,this.ctx=Object.assign({},i),r instanceof HTMLElement)this.strings=[r.textContent],this.values=[];else if(Array.isArray(r)){var o=_slicedToArray(r,2);this.strings=o[0],this.values=o[1]}else this.strings=[String(r)],this.values=[]}return _createClass(t,[{key:"compile",value:function(e){var r=this,n=[this.strings[0]],i=Object.assign({},this.ctx,e);return this.values.forEach(function(e,o){var a=e;if("function"==typeof e)a=e(i);else if(e instanceof t){if(e.type!==t.PARTIAL)throw new Error("ShaderSource.compile() panic! Only PARTIAL's are allowed to embed into shader sources! (but type=".concat(e.type,")"));a=e.compile(i)}n.push(a,r.strings[o+1])}),n.join("")}}]),t}();ShaderSource.VERTEX_SHADER="VERTEX_SHADER",ShaderSource.FRAGMENT_SHADER="FRAGMENT_SHADER",ShaderSource.PARTIAL="PARTIAL",ShaderSource.vertexShader=function(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return new ShaderSource(ShaderSource.VERTEX_SHADER,[e,n],t&&t.id,t)}},ShaderSource.fragmentShader=function(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return new ShaderSource(ShaderSource.FRAGMENT_SHADER,[e,n],t&&t.id,t)}},ShaderSource.partial=function(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return new ShaderSource(ShaderSource.PARTIAL,[e,n],t&&t.id,t)}},ShaderSource.fromElement=function(t){var e=t.getAttribute("type");if("x-shader/vertex"===e)e=ShaderSource.VERTEX_SHADER;else{if("x-shader/fragment"!==e)throw new Error('ShaderSource.fromElement() panic! Invalid type="'.concat(e,'" attribute value (should be "x-shader/vertex" or "x-shader/fragment")'));e=ShaderSource.FRAGMENT_SHADER}return new ShaderSource(e,t,t.getAttribute("id"))};var ResourceLibrary=function(){function t(){_classCallCheck(this,t),this.descriptors=new Map,this.vertexShaders=new Map,this.fragmentShaders=new Map}return _createClass(t,[{key:"createDescriptor",value:function(t,e){var r=e instanceof VODescriptor?e:new VODescriptor(e);return this.descriptors.set(t,r),t}},{key:"addVertexShader",value:function(t,e){if(e.type!==ShaderSource.VERTEX_SHADER)throw new Error("addVertexShader: shaderSource has wrong type=".concat(e.type," (expected type=").concat(ShaderSource.VERTEX_SHADER,")"));return this.vertexShaders.set(t,e),t}},{key:"addFragmentShader",value:function(t,e){if(e.type!==ShaderSource.FRAGMENT_SHADER)throw new Error("addFragmentShader: shaderSource has wrong type=".concat(e.type," (expected type=").concat(ShaderSource.FRAGMENT_SHADER,")"));return this.fragmentShaders.set(t,e),t}},{key:"createVertexShader",value:function(t){var e=new ShaderSource(ShaderSource.VERTEX_SHADER,t);return this.vertexShaders.set(e.id,e),e.id}},{key:"createFragmentShader",value:function(t){var e=new ShaderSource(ShaderSource.FRAGMENT_SHADER,t);return this.fragmentShaders.set(e.id,e),e.id}},{key:"getDescriptor",value:function(t){return this.descriptors.get(t)}},{key:"getVertexShader",value:function(t){return this.vertexShaders.get(t)}},{key:"getFragmentShader",value:function(t){return this.fragmentShaders.get(t)}}]),t}(),ShaderAttribVariable=function(t){function e(t,r){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,ShaderVariable.ATTRIB,r))}return _inherits(e,ShaderVariable),e}(),arraySlice=[].slice,factories={},construct=function(t,e,r){if(!(e in factories)){for(var n=[],i=0;i<e;i++)n[i]="a["+i+"]";factories[e]=Function("F,a","return new F("+n.join(",")+")")}return factories[e](t,r)},_bind=Function.bind||function(t){var e=_aFunction(this),r=arraySlice.call(arguments,1),n=function(){var i=r.concat(arraySlice.call(arguments));return this instanceof n?construct(e,i.length,i):_invoke(e,i,t)};return _isObject(e.prototype)&&(n.prototype=e.prototype),n};_export(_export.P,"Function",{bind:_bind});var ShaderVariableGroup=function(){function t(e){_classCallCheck(this,t),this.shaderVars=e}return _createClass(t,[{key:"pushVar",value:function(t){this.shaderVars.forEach(t.pushVar.bind(t))}},{key:"popVar",value:function(t){this.shaderVars.forEach(t.popVar.bind(t))}}]),t}();function shaderVarMap(t,e){switch(e){case ShaderVariable.UNIFORM:return t.uniform;case ShaderVariable.ATTRIB:return t.attrib;case ShaderVariable.TEXTURE_2D:return t.tex2d;default:return null}}function shaderVarLane(t,e,r){var n=shaderVarMap(t,e),i=n.get(r);return i||(i=[],n.set(r,i)),i}var ShaderContext=function(){function t(){_classCallCheck(this,t),this.uniform=new Map,this.attrib=new Map,this.tex2d=new Map}return _createClass(t,[{key:"clear",value:function(){this.uniform.clear(),this.attrib.clear(),this.tex2d.clear()}},{key:"pushVar",value:function(t){t instanceof ShaderVariableGroup?t.pushVar(this):shaderVarLane(this,t.type,t.name).push(t)}},{key:"popVar",value:function(t){if(t instanceof ShaderVariableGroup)t.popVar(this);else for(var e=shaderVarLane(this,t.type,t.name),r=e.length,n=0;n<r;++n)if(e[n]===t)return void(e.length=n)}},{key:"curVar",value:function(t){var e=shaderVarMap(this,t.type).get(t.name);return e&&e.length?e[e.length-1]:null}},{key:"curUniform",value:function(t){var e=this.uniform.get(t);return e&&e.length?e[e.length-1]:null}},{key:"curAttrib",value:function(t){var e=this.attrib.get(t);return e&&e.length?e[e.length-1]:null}},{key:"curTex2d",value:function(t){var e=this.tex2d.get(t);return e&&e.length?e[e.length-1]:null}}]),t}(),ShaderProgram=function t(e,r,n){_classCallCheck(this,t),this.id=n||uuid(),this.vertexShader=e,this.fragmentShader=r};_export(_export.S+_export.F*!_descriptors,"Object",{defineProperty:_objectDp.f});var ShaderUniformGroup=function(t){function e(t){var r;return _classCallCheck(this,e),r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,[])),Object.keys(t).forEach(function(e){r.addUniform(e,t[e])}),r}return _inherits(e,ShaderVariableGroup),_createClass(e,[{key:"addUniform",value:function(t,e,r){var n=e instanceof Projection,i=n?new ProjectionUniform(e,t):new ShaderUniformVariable(t,e,r);this.shaderVars.push(i),Object.defineProperty(this,"".concat(t,"Uniform"),{value:i,enumerable:!0}),n?Object.defineProperty(this,t,{enumerable:!0,get:function(){return i.projection}}):Object.defineProperty(this,t,{enumerable:!0,get:function(){return i.data},set:function(t){i.data=t}})}}]),e}(),ShaderAttribValue=function(){function t(e,r,n){_classCallCheck(this,t),this.name=e,this.descriptor=r,this.bufferSource=n}return _createClass(t,[{key:"bufferSource",set:function(t){this.bufferSource_=t,this.ref=t instanceof VOArray?t.ref:t.voArray.ref},get:function(){return this.bufferSource_}},{key:"attrDescriptor",get:function(){return this.descriptor.attr[this.name]}}]),t}(),ShaderVariableAlias=function(){function t(e,r){_classCallCheck(this,t),this.name=e,this.shaderVar=r}return _createClass(t,[{key:"type",get:function(){return this.shaderVar.type}},{key:"data",get:function(){return this.shaderVar.data}},{key:"serial",get:function(){return this.shaderVar.serial}}]),t}(),ShaderVariableBufferGroup=function(t){function e(t,r){var n;_classCallCheck(this,e),n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,[]));var i,o=r||t.descriptor;return Object.keys(o.attr).forEach(function(e){i?n.shaderVars.push(new ShaderVariableAlias(e,i)):(i=new ShaderAttribVariable(e,new ShaderAttribValue(e,o,t)),n.shaderVars.push(i))}),n}return _inherits(e,ShaderVariableGroup),_createClass(e,[{key:"touch",value:function(){return this.shaderVars[0].touch()}},{key:"bufferSource",get:function(){return this.shaderVars[0].data.bufferSource}},{key:"serial",get:function(){return this.shaderVars[0].serial}}]),e}(),$indexOf=_arrayIncludes(!1),$native=[].indexOf,NEGATIVE_ZERO=!!$native&&1/[1].indexOf(1,-0)<0;_export(_export.P+_export.F*(NEGATIVE_ZERO||!_strictMethod($native)),"Array",{indexOf:function(t){return NEGATIVE_ZERO?$native.apply(this,arguments)||0:$indexOf(this,t,arguments[1])}});var createVOs=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.capacity-t.usedCount-t.allocatedCount,n=e>0&&e<r?e:r,i=t.allocatedCount+n,o=t.allocatedCount;o<i;o++){var a=t.voArray.subarray(o),s=t.descriptor.createVO(a);s.free=t.free.bind(t,s),t.availableVOs.push(s)}return n},VOPool=function(){function t(e,r){var n=this;_classCallCheck(this,t),this.id=uuid(),this.descriptor=e,this.capacity=readOption(r,"capacity",this.descriptor.maxIndexedVOPoolSize),this.maxAllocVOSize=readOption(r,"maxAllocVOSize",0),this.voZero=readOption(r,"voZero",function(){return e.createVO()}),this.voNew=readOption(r,"voNew",function(){return e.createVO()}),this.usage=readOption(r,"usage","dynamic"),this.voArray=readOption(r,"voArray",function(){return e.createVOArray(n.capacity,{usage:n.usage,autotouch:readOption(r,"autotouch","dynamic"===n.usage),doubleBuffer:readOption(r,"doubleBuffer","dynamic"===n.usage)})}),this.availableVOs=[],this.usedVOs=[],createVOs(this,this.maxAllocVOSize)}return _createClass(t,[{key:"alloc",value:function(){var t=this.availableVOs.shift();if(void 0===t){if(!(this.capacity-this.allocatedCount>0))return;createVOs(this,this.maxAllocVOSize),t=this.availableVOs.shift()}return this.usedVOs.push(t),t.voArray.copy(this.voNew.voArray),t}},{key:"multiAlloc",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.allocatedCount-this.usedCount<t&&createVOs(this,maxOf(this.maxAllocVOSize,t-this.allocatedCount-this.usedCount));for(var r=0;r<t;++r){var n=this.availableVOs.shift();if(void 0===n)break;this.usedVOs.push(n),n.voArray.copy(this.voNew.voArray),e.push(n)}return e}},{key:"free",value:function(t){if(Array.isArray(t))t.forEach(this.free.bind(this));else{var e=this.usedVOs.indexOf(t);if(-1!==e){var r=this.usedVOs.length-1;if(e!==r){var n=this.usedVOs[r];t.voArray.copy(n.voArray);var i=n.voArray;n.voArray=t.voArray,t.voArray=i,this.usedVOs.splice(e,1,n)}this.usedVOs.pop(),this.availableVOs.unshift(t),t.voArray.copy(this.voZero.voArray)}}}},{key:"usedCount",get:function(){return this.usedVOs.length}},{key:"availableCount",get:function(){return this.capacity-this.usedVOs.length}},{key:"allocatedCount",get:function(){return this.availableVOs.length+this.usedVOs.length}}]),t}(),pickVOPoolOpts=pick(["autotouch","capacity","doubleBuffer","maxAllocVOSize","usage","voArray"]),createSpriteSizeHook=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"size";switch(_typeof(t)){case"string":return function(e,r,n,i){return i.attr[t].setValue(e,[r,n])};case"function":return t;case"object":case"boolean":if(!t)return null;default:throw new Error("SpriteGroup: invalid sprite size setter! (is ".concat(_typeof(t)," but should be a function, string, null or false)"))}},SpriteGroup=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t),this.descriptor=e,r.base instanceof t?this.base=r.base:"object"===_typeof(r.base)&&(this.base=new t(e.base,r.base));var n=r.voNew,i=r.voZero;n&&(n=e.createVO(null,n)),i&&(i=e.createVO(null,i)),this.spriteHook={setSize:createSpriteSizeHook(r.setSize)},this.voPool=new VOPool(e,Object.assign({maxAllocVOSize:1e3},pickVOPoolOpts(r),{voNew:n,voZero:i})),this.voPoolShaderAttribs=new ShaderVariableBufferGroup(this.voPool);var o=r.primitive;this.primitive="function"==typeof o?o(this.capacity):o,this.shaderProgram=r.shaderProgram,!this.shaderProgram&&r.vertexShader&&r.fragmentShader&&(this.shaderProgram=new ShaderProgram(r.vertexShader,r.fragmentShader))}return _createClass(t,[{key:"createSprite",value:function(t,e){var r=this.voPool.alloc(),n=this.spriteHook.setSize;return!n||void 0===t&&void 0===e||n(r,t,void 0!==e?e:t,this.descriptor),r}},{key:"createSprites",value:function(t,e,r){var n=this,i=this.voPool.multiAlloc(t),o=this.spriteHook.setSize;if(o&&(void 0!==e||void 0!==r)){var a=void 0!==r?r:e;i.forEach(function(t){return o(t,e,a,n.descriptor)})}return i}},{key:"touchVertexBuffers",value:function(){this.voPool.voArray.ref.touch()}},{key:"capacity",get:function(){return this.voPool.capacity}},{key:"usedCount",get:function(){return this.voPool.usedCount}},{key:"availableCount",get:function(){return this.voPool.availableCount}}]),t}(),StackedContext=function(){function t(){_classCallCheck(this,t),this.context=new Map}return _createClass(t,[{key:"push",value:function(t,e){var r=this.context.get(t);return r?(r.push(e),r.length-1):(this.context.set(t,[e]),0)}},{key:"pop",value:function(t,e){var r=this.context.get(t);if(r)return void 0===e?r.pop():r.splice(e,r.length-e)}},{key:"get",value:function(t){var e=this.context.get(t);if(e){var r=e.length;if(r>0)return e[r-1]}}},{key:"clear",value:function(){this.context.forEach(function(t){t.length=0})}}]),t}(),runtime=createCommonjsModule(function(t){!function(e){var r,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",u=e.regeneratorRuntime;if(u)t.exports=u;else{(u=e.regeneratorRuntime=t.exports).wrap=m;var l="suspendedStart",f="suspendedYield",h="executing",d="completed",p={},_={};_[a]=function(){return this};var y=Object.getPrototypeOf,v=y&&y(y(C([])));v&&v!==n&&i.call(v,a)&&(_=v);var g=E.prototype=x.prototype=Object.create(_);O.prototype=g.constructor=E,E.constructor=O,E[c]=O.displayName="GeneratorFunction",u.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===O||"GeneratorFunction"===(e.displayName||e.name))},u.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,c in t||(t[c]="GeneratorFunction")),t.prototype=Object.create(g),t},u.awrap=function(t){return{__await:t}},A(S.prototype),S.prototype[s]=function(){return this},u.AsyncIterator=S,u.async=function(t,e,r,n){var i=new S(m(t,e,r,n));return u.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},A(g),g[c]="Generator",g[a]=function(){return this},g.toString=function(){return"[object Generator]"},u.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},u.values=C,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,i){return s.type="throw",s.arg=t,e.next=n,i&&(e.method="next",e.arg=r),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),p}}}function m(t,e,r,n){var i=e&&e.prototype instanceof x?e:x,o=Object.create(i.prototype),a=new k(n||[]);return o._invoke=function(t,e,r){var n=l;return function(i,o){if(n===h)throw new Error("Generator is already running");if(n===d){if("throw"===i)throw o;return R()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=b(t,e,r);if("normal"===c.type){if(n=r.done?d:f,c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=d,r.method="throw",r.arg=c.arg)}}}(t,r,a),o}function b(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function x(){}function O(){}function E(){}function A(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(t){var e;this._invoke=function(r,n){function o(){return new Promise(function(e,o){!function e(r,n,o,a){var s=b(t[r],t,n);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,o,a)},function(t){e("throw",t,o,a)}):Promise.resolve(u).then(function(t){c.value=t,o(c)},a)}a(s.arg)}(r,n,e,o)})}return e=e?e.then(o,o):o()}}function w(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,w(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=b(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function C(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())}),Texture=function(){function t(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;_classCallCheck(this,t);var s=r,c=n;if(e instanceof t)this.parent=e,this.image=null;else{if(!("object"===_typeof(e)&&"width"in e&&"height"in e))throw new Error("new Texture() panic: unexpected source argument!");this.image=e,this.parent=null,this._ref=new DataRef("Texture",this,{flipY:readOption(a,"flipY",!1),repeatable:readOption(a,"repeatable",!1),premultiplyAlpha:readOption(a,"premultiplyAlpha",!0),nearest:readOption(a,"nearest",!0)}),"origWidth"in e&&"origHeight"in e&&(s=e.origWidth,c=e.origHeight)}this._width=s,this._height=c,this.x=i,this.y=o}var e;return _createClass(t,[{key:"root",get:function(){return this.parent&&this.parent.root||this}},{key:"imgEl",get:function(){var t=this.root;return t.image.imgEl||t.image}},{key:"ref",get:function(){return this._ref||this.root.ref}},{key:"width",get:function(){return"number"==typeof this._width?this._width:this.image?this.image.width:this.parent?this.root.width:0},set:function(t){this._width=t}},{key:"height",get:function(){return"number"==typeof this._height?this._height:this.image?this.image.height:this.parent?this.root.height:0},set:function(t){this._height=t}},{key:"minS",get:function(){for(var t=this.x,e=this;null!=(e=e.parent);)t+=e.x;return t/this.root.image.width}},{key:"minT",get:function(){for(var t=this.y,e=this;null!=(e=e.parent);)t+=e.y;return t/this.root.image.height}},{key:"maxS",get:function(){for(var t=this.x+this.width,e=this;null!=(e=e.parent);)t+=e.x;return t/this.root.image.width}},{key:"maxT",get:function(){for(var t=this.y+this.height,e=this;null!=(e=e.parent);)t+=e.y;return t/this.root.image.height}}],[{key:"load",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new URL(r,window.location.href).href,e.next=3,new PowerOf2Image(i).onLoaded;case 3:return o=e.sent,e.abrupt("return",new t(o,void 0,void 0,0,0,n));case 5:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})}]),t}(),MATCH=_wks("match"),_isRegexp=function(t){var e;return _isObject(t)&&(void 0!==(e=t[MATCH])?!!e:"RegExp"==_cof(t))},dP$3=_objectDp.f,gOPN=_objectGopn.f,$RegExp=_global.RegExp,Base=$RegExp,proto$1=$RegExp.prototype,re1=/a/g,re2=/a/g,CORRECT_NEW=new $RegExp(re1)!==re1;if(_descriptors&&(!CORRECT_NEW||_fails(function(){return re2[_wks("match")]=!1,$RegExp(re1)!=re1||$RegExp(re2)==re2||"/a/i"!=$RegExp(re1,"i")}))){$RegExp=function(t,e){var r=this instanceof $RegExp,n=_isRegexp(t),i=void 0===e;return!r&&n&&t.constructor===$RegExp&&i?t:_inheritIfRequired(CORRECT_NEW?new Base(n&&!i?t.source:t,e):Base((n=t instanceof $RegExp)?t.source:t,n&&i?_flags.call(t):e),r?this:proto$1,$RegExp)};for(var proxy=function(t){t in $RegExp||dP$3($RegExp,t,{configurable:!0,get:function(){return Base[t]},set:function(e){Base[t]=e}})},keys=gOPN(Base),i$2=0;keys.length>i$2;)proxy(keys[i$2++]);proto$1.constructor=$RegExp,$RegExp.prototype=proto$1,_redefine(_global,"RegExp",$RegExp)}_setSpecies("RegExp");var _createProperty=function(t,e,r){e in t?_objectDp.f(t,e,_propertyDesc(0,r)):t[e]=r};_export(_export.S+_export.F*!_iterDetect(function(t){}),"Array",{from:function(t){var e,r,n,i,o=_toObject(t),a="function"==typeof this?this:Array,s=arguments.length,c=s>1?arguments[1]:void 0,u=void 0!==c,l=0,f=core_getIteratorMethod(o);if(u&&(c=_ctx(c,s>2?arguments[2]:void 0,2)),null==f||a==Array&&_isArrayIter(f))for(r=new a(e=_toLength(o.length));e>l;l++)_createProperty(r,l,u?c(o[l],l):o[l]);else for(i=f.call(o),r=new a;!(n=i.next()).done;l++)_createProperty(r,l,u?_iterCall(i,c,[n.value,l],!0):n.value);return r.length=l,r}});var TextureAtlasJsonDef=function(){function t(e){_classCallCheck(this,t),this.frameNames=Object.keys(e.frames),this.frames=e.frames,this.meta=e.meta,this.imageUrl=e.meta.image}var e;return _createClass(t,null,[{key:"load",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,n){var i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(r,n);case 2:return i=e.sent,e.next=5,i.json();case 5:return o=e.sent,e.abrupt("return",new t(o));case 7:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})}]),t}(),TextureAtlas=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,t),this.rootTexture=e,this.jsonDef=r,this.frames=new Map}var e;return _createClass(t,[{key:"addFrame",value:function(t,e,r,n,i){this.frames.set(t,new Texture(this.rootTexture,e,r,n,i))}},{key:"addFrameAlias",value:function(t,e){this.frames.has(e)&&this.frames.set(t,this.frames.get(e))}},{key:"frame",value:function(t){return this.frames.get(t)}},{key:"randomFrame",value:function(){return sample(Array.from(this.frames.values()))}},{key:"randomFrameName",value:function(){return sample(this.frameNames())}},{key:"frameNames",value:function(t){var e=Array.from(this.frames.keys());if(t){var r=new RegExp(t);return e.filter(function(t){return r.test(t)})}return e}}],[{key:"load",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,n){var i,o,a,s,c,u,l,f,h,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new URL(r,window.location.href).href,e.next=3,TextureAtlasJsonDef.load(i,readOption(n,"fetchOptions"));case 3:return o=e.sent,e.next=6,new PowerOf2Image(readOption(n,"image",function(){return new URL(o.imageUrl,i).href},o)).onLoaded;case 6:for(a=e.sent,s=new Texture(a,void 0,void 0,0,0,readOption(n,"textureHints")),c=new t(s,o),u=o.frameNames,l=u.length,f=0;f<l;f++)h=u[f],d=o.frames[h].frame,c.addFrame(h,d.w,d.h,d.x,d.y);return e.abrupt("return",c);case 13:case"end":return e.stop()}},e,this)})),function(t,r){return e.apply(this,arguments)})}]),t}(),TextureHandle=function t(e){var r=this;_classCallCheck(this,t),this.texture=null,this.atlas=null,this.onReady=Promise.resolve(e).then(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e instanceof TextureAtlas?(r.atlas=e,r.texture=e.rootTexture):r.texture=e,t.abrupt("return",e);case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}())},ShaderTexture2dVariable=function(t){function e(t,r){var n;return _classCallCheck(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,ShaderVariable.TEXTURE_2D,r))).texture=null,n}return _inherits(e,ShaderVariable),e}(),TextureLibrary=function(){function t(){_classCallCheck(this,t),this.handles=new Map,this.shaderVars=new Map}return _createClass(t,[{key:"loadTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=new TextureHandle(Texture.load(e,r));return this.handles.set(t,n),n.onReady}},{key:"loadTextureAtlas",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=new TextureHandle(TextureAtlas.load(e,r));return this.handles.set(t,n),n.onReady}},{key:"getTexture",value:function(t){var e=this.handles.get(t);return e&&e.texture}},{key:"getTextureAtlas",value:function(t){var e=this.handles.get(t);return e&&e.atlas}},{key:"whenLoaded",value:function(t,e,r){var n=this.getTexture(t);if(n){var i=this.shaderVars.get(e);i||(i=new ShaderTexture2dVariable(e),this.shaderVars.set(e,i)),i.texture=n,r(i)}}}]),t}(),ShaderTextureGroup=function(){function t(e,r){_classCallCheck(this,t),this.textureLibrary=e,this.waitFor=Object.keys(r).map(function(t){return{shaderVarKey:t,textureId:r[t],isLoaded:!1}}),this.shaderVarGroup=new ShaderVariableGroup([]),this.shaderVarStore=new Map}return _createClass(t,[{key:"whenLoaded",value:function(t){var e=this;this.isLoaded?t(this.shaderVarGroup):(this.waitFor.forEach(function(t){if(!t.isLoaded){var r=e.textureLibrary.getTexture(t.textureId);if(!r)return;var n=new ShaderTexture2dVariable(t.shaderVarKey);n.texture=r,e.shaderVarGroup.shaderVars.push(n),t.isLoaded=!0}}),this.waitFor=this.waitFor.filter(function(t){return!1===t.isLoaded}),this.isLoaded&&t(this.shaderVarGroup))}},{key:"isLoaded",get:function(){return 0===this.waitFor.length&&this.shaderVarGroup.shaderVars.length>0}}]),t}(),TexturedSpriteGroup=function(t){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,n))).textureLibrary=readOption(n,"textureLibrary",function(){return new TextureLibrary});var i=n.setTexCoordsByTexture;return r.spriteHook.setTexCoordsByTexture=null===i||!1===i?null:i||function(t,e){return t.setTexCoordsByTexture(e)},r.textures=Object.assign({},n.textures),r.shaderTextureGroup=null,r}return _inherits(e,SpriteGroup),_createClass(e,[{key:"setTexture",value:function(t,e){this.textures[t]!==e&&(this.textures[t]=e,this.shaderTextureGroup=null)}},{key:"loadTextureAtlas",value:function(t,e,r){return this.setTexture(t,e),this.textureLibrary.loadTextureAtlas(e,e,r)}},{key:"getTexture",value:function(t){return this.textureLibrary.getTexture(this.textures[t])}},{key:"getTextureAtlas",value:function(t){return this.textureLibrary.getTextureAtlas(this.textures[t])}},{key:"whenTexturesLoaded",value:function(t){this.shaderTextureGroup||(this.shaderTextureGroup=new ShaderTextureGroup(this.textureLibrary,this.textures)),this.shaderTextureGroup.whenLoaded(t)}},{key:"createSprite",value:function(t,r,n){var i,o;t&&void 0===r?(i=t.width,o=t.height):(i=r,o=n);var a=_get(_getPrototypeOf(e.prototype),"createSprite",this).call(this,i,o),s=this.spriteHook.setTexCoordsByTexture;return s&&t&&s(a,t),a}}]),e}(),Viewport=function(t){function e(t,r,n,i){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,t+n,r,r+i))}return _inherits(e,AABB2),_createClass(e,[{key:"x",get:function(){return this.minX},set:function(t){var e=this.width;this.minX=t,this.maxX=t+e}},{key:"y",get:function(){return this.minY},set:function(t){var e=this.height;this.minY=t,this.maxY=t+e}}]),e}();export{ShaderTool,AABB2,DataRef,ElementIndexArray,IndexedPrimitive,Mat4,PowerOf2Image,Projection,ProjectionUniform,ResourceLibrary,ShaderAttribVariable,ShaderContext,ShaderProgram,ShaderSource,ShaderUniformGroup,ShaderUniformVariable,ShaderVariableBufferGroup,SpriteGroup,StackedContext,Texture,TextureAtlas,TextureLibrary,TexturedSpriteGroup,VOArray,VODescriptor,VOPool,Viewport,uuid as generateUuid};
//# sourceMappingURL=picimo-core.js.map
