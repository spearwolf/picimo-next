!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@picimo/core"),require("@spearwolf/eventize")):"function"==typeof define&&define.amd?define(["exports","@picimo/core","@spearwolf/eventize"],n):n(t.PicimoECS={},t.PicimoCore,t.eventize)}(this,function(t,n,e){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,n){return(a=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function f(t,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function s(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(t,n){return t(n={exports:{}},n.exports),n.exports}e=e&&e.hasOwnProperty("default")?e.default:e;var p=l(function(t){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)}),y=l(function(t){var n=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)}),h=(y.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),v=function(t){if(!h(t))throw TypeError(t+" is not an object!");return t},d=function(t){try{return!!t()}catch(t){return!0}},m=!d(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),g=p.document,_=h(g)&&h(g.createElement),b=function(t){return _?g.createElement(t):{}},w=!m&&!d(function(){return 7!=Object.defineProperty(b("div"),"a",{get:function(){return 7}}).a}),E=function(t,n){if(!h(t))return t;var e,r;if(n&&"function"==typeof(e=t.toString)&&!h(r=e.call(t)))return r;if("function"==typeof(e=t.valueOf)&&!h(r=e.call(t)))return r;if(!n&&"function"==typeof(e=t.toString)&&!h(r=e.call(t)))return r;throw TypeError("Can't convert object to primitive value")},S=Object.defineProperty,O={f:m?Object.defineProperty:function(t,n,e){if(v(t),n=E(n,!0),v(e),w)try{return S(t,n,e)}catch(t){}if("get"in e||"set"in e)throw TypeError("Accessors not supported!");return"value"in e&&(t[n]=e.value),t}},k=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}},C=m?function(t,n,e){return O.f(t,n,k(1,e))}:function(t,n,e){return t[n]=e,t},j={}.hasOwnProperty,A=function(t,n){return j.call(t,n)},P=0,T=Math.random(),F=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++P+T).toString(36))},L=l(function(t){var n=F("src"),e=Function.toString,r=(""+e).split("toString");y.inspectSource=function(t){return e.call(t)},(t.exports=function(t,e,o,i){var u="function"==typeof o;u&&(A(o,"name")||C(o,"name",e)),t[e]!==o&&(u&&(A(o,n)||C(o,n,t[e]?""+t[e]:r.join(String(e)))),t===p?t[e]=o:i?t[e]?t[e]=o:C(t,e,o):(delete t[e],C(t,e,o)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[n]||e.call(this)})}),M=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},x=function(t,n,e){if(M(t),void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 2:return function(e,r){return t.call(n,e,r)};case 3:return function(e,r,o){return t.call(n,e,r,o)}}return function(){return t.apply(n,arguments)}},N=function(t,n,e){var r,o,i,u,c=t&N.F,a=t&N.G,f=t&N.S,s=t&N.P,l=t&N.B,h=a?p:f?p[n]||(p[n]={}):(p[n]||{}).prototype,v=a?y:y[n]||(y[n]={}),d=v.prototype||(v.prototype={});for(r in a&&(e=n),e)i=((o=!c&&h&&void 0!==h[r])?h:e)[r],u=l&&o?x(i,p):s&&"function"==typeof i?x(Function.call,i):i,h&&L(h,r,i,t&N.U),v[r]!=i&&C(v,r,u),s&&d[r]!=i&&(d[r]=i)};p.core=y,N.F=1,N.G=2,N.S=4,N.P=8,N.B=16,N.W=32,N.U=64,N.R=128;var R,I,D,z,G,V,K,U,W,q,B,H=N,Y={}.toString,J=function(t){return Y.call(t).slice(8,-1)},Q=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==J(t)?t.split(""):Object(t)},X=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},Z=function(t){return Object(X(t))},$=Math.ceil,tt=Math.floor,nt=function(t){return isNaN(t=+t)?0:(t>0?tt:$)(t)},et=Math.min,rt=function(t){return t>0?et(nt(t),9007199254740991):0},ot=Array.isArray||function(t){return"Array"==J(t)},it=l(function(t){var n=p["__core-js_shared__"]||(p["__core-js_shared__"]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:y.version,mode:"global",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})}),ut=l(function(t){var n=it("wks"),e=p.Symbol,r="function"==typeof e;(t.exports=function(t){return n[t]||(n[t]=r&&e[t]||(r?e:F)("Symbol."+t))}).store=n}),ct=ut("species"),at=(D=1==(R=0),z=2==R,G=3==R,V=4==R,K=6==R,U=5==R||K,W=I||function(t,n){return new(function(t){var n;return ot(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!ot(n.prototype)||(n=void 0),h(n)&&null===(n=n[ct])&&(n=void 0)),void 0===n?Array:n}(t))(n)},function(t,n,e){for(var r,o,i=Z(t),u=Q(i),c=x(n,e,3),a=rt(u.length),f=0,s=D?W(t,a):z?W(t,0):void 0;a>f;f++)if((U||f in u)&&(o=c(r=u[f],f,i),R))if(D)s[f]=o;else if(o)switch(R){case 3:return!0;case 5:return r;case 6:return f;case 2:s.push(r)}else if(V)return!1;return K?-1:G||V?V:s}),ft=(B=!0,!!(q=[].forEach)&&d(function(){B?q.call(null,function(){},1):q.call(null)}));H(H.P+H.F*!ft,"Array",{forEach:function(t){return at(this,t,arguments[1])}}),H(H.S,"Array",{isArray:ot});var st=ut("unscopables"),lt=Array.prototype;null==lt[st]&&C(lt,st,{});var pt,yt=function(t){lt[st][t]=!0},ht=function(t,n){return{value:n,done:!!t}},vt={},dt=function(t){return Q(X(t))},mt=Math.max,gt=Math.min,_t=it("keys"),bt=function(t){return _t[t]||(_t[t]=F(t))},wt=(pt=!1,function(t,n,e){var r,o=dt(t),i=rt(o.length),u=function(t,n){return(t=nt(t))<0?mt(t+n,0):gt(t,n)}(e,i);if(pt&&n!=n){for(;i>u;)if((r=o[u++])!=r)return!0}else for(;i>u;u++)if((pt||u in o)&&o[u]===n)return pt||u||0;return!pt&&-1}),Et=bt("IE_PROTO"),St="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Ot=Object.keys||function(t){return function(t,n){var e,r=dt(t),o=0,i=[];for(e in r)e!=Et&&A(r,e)&&i.push(e);for(;n.length>o;)A(r,e=n[o++])&&(~wt(i,e)||i.push(e));return i}(t,St)},kt=m?Object.defineProperties:function(t,n){v(t);for(var e,r=Ot(n),o=r.length,i=0;o>i;)O.f(t,e=r[i++],n[e]);return t},Ct=p.document,jt=Ct&&Ct.documentElement,At=bt("IE_PROTO"),Pt=function(){},Tt=function(){var t,n=b("iframe"),e=St.length;for(n.style.display="none",jt.appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Tt=t.F;e--;)delete Tt.prototype[St[e]];return Tt()},Ft=Object.create||function(t,n){var e;return null!==t?(Pt.prototype=v(t),e=new Pt,Pt.prototype=null,e[At]=t):e=Tt(),void 0===n?e:kt(e,n)},Lt=O.f,Mt=ut("toStringTag"),xt=function(t,n,e){t&&!A(t=e?t:t.prototype,Mt)&&Lt(t,Mt,{configurable:!0,value:n})},Nt={};C(Nt,ut("iterator"),function(){return this});var Rt=function(t,n,e){t.prototype=Ft(Nt,{next:k(1,e)}),xt(t,n+" Iterator")},It=bt("IE_PROTO"),Dt=Object.prototype,zt=Object.getPrototypeOf||function(t){return t=Z(t),A(t,It)?t[It]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Dt:null},Gt=ut("iterator"),Vt=!([].keys&&"next"in[].keys()),Kt=function(){return this},Ut=function(t,n,e,r,o,i,u){Rt(e,n,r);var c,a,f,s=function(t){if(!Vt&&t in h)return h[t];switch(t){case"keys":case"values":return function(){return new e(this,t)}}return function(){return new e(this,t)}},l=n+" Iterator",p="values"==o,y=!1,h=t.prototype,v=h[Gt]||h["@@iterator"]||o&&h[o],d=v||s(o),m=o?p?s("entries"):d:void 0,g="Array"==n&&h.entries||v;if(g&&(f=zt(g.call(new t)))!==Object.prototype&&f.next&&(xt(f,l,!0),"function"!=typeof f[Gt]&&C(f,Gt,Kt)),p&&v&&"values"!==v.name&&(y=!0,d=function(){return v.call(this)}),(Vt||y||!h[Gt])&&C(h,Gt,d),vt[n]=d,vt[l]=Kt,o)if(c={values:p?d:s("values"),keys:i?d:s("keys"),entries:m},u)for(a in c)a in h||L(h,a,c[a]);else H(H.P+H.F*(Vt||y),n,c);return c},Wt=Ut(Array,"Array",function(t,n){this._t=dt(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,e=this._i++;return!t||e>=t.length?(this._t=void 0,ht(1)):ht(0,"keys"==n?e:"values"==n?t[e]:[e,t[e]])},"values");vt.Arguments=vt.Array,yt("keys"),yt("values"),yt("entries");for(var qt=ut("iterator"),Bt=ut("toStringTag"),Ht=vt.Array,Yt={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Jt=Ot(Yt),Qt=0;Qt<Jt.length;Qt++){var Xt,Zt=Jt[Qt],$t=Yt[Zt],tn=p[Zt],nn=tn&&tn.prototype;if(nn&&(nn[qt]||C(nn,qt,Ht),nn[Bt]||C(nn,Bt,Zt),vt[Zt]=Ht,$t))for(Xt in Wt)nn[Xt]||L(nn,Xt,Wt[Xt],!0)}var en,rn=(en=!0,function(t,n){var e,r,o=String(X(t)),i=nt(n),u=o.length;return i<0||i>=u?en?"":void 0:(e=o.charCodeAt(i))<55296||e>56319||i+1===u||(r=o.charCodeAt(i+1))<56320||r>57343?en?o.charAt(i):e:en?o.slice(i,i+2):r-56320+(e-55296<<10)+65536});Ut(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,e=this._i;return e>=n.length?{value:void 0,done:!0}:(t=rn(n,e),this._i+=t.length,{value:t,done:!1})});var on=function(t,n,e){for(var r in n)L(t,r,n[r],e);return t},un=function(t,n,e,r){if(!(t instanceof n)||void 0!==r&&r in t)throw TypeError(e+": incorrect invocation!");return t},cn=function(t,n,e,r){try{return r?n(v(e)[0],e[1]):n(e)}catch(n){var o=t.return;throw void 0!==o&&v(o.call(t)),n}},an=ut("iterator"),fn=Array.prototype,sn=ut("toStringTag"),ln="Arguments"==J(function(){return arguments}()),pn=ut("iterator"),yn=y.getIteratorMethod=function(t){if(null!=t)return t[pn]||t["@@iterator"]||vt[function(t){var n,e,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,n){try{return t[n]}catch(t){}}(n=Object(t),sn))?e:ln?J(n):"Object"==(r=J(n))&&"function"==typeof n.callee?"Arguments":r}(t)]},hn=l(function(t){var n={},e={},r=t.exports=function(t,r,o,i,u){var c,a,f,s,l,p=u?function(){return t}:yn(t),y=x(o,i,r?2:1),h=0;if("function"!=typeof p)throw TypeError(t+" is not iterable!");if(void 0===(l=p)||vt.Array!==l&&fn[an]!==l){for(f=p.call(t);!(a=f.next()).done;)if((s=cn(f,y,a.value,r))===n||s===e)return s}else for(c=rt(t.length);c>h;h++)if((s=r?y(v(a=t[h])[0],a[1]):y(t[h]))===n||s===e)return s};r.BREAK=n,r.RETURN=e}),vn=ut("species"),dn=l(function(t){var n=F("meta"),e=O.f,r=0,o=Object.isExtensible||function(){return!0},i=!d(function(){return o(Object.preventExtensions({}))}),u=function(t){e(t,n,{value:{i:"O"+ ++r,w:{}}})},c=t.exports={KEY:n,NEED:!1,fastKey:function(t,e){if(!h(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!A(t,n)){if(!o(t))return"F";if(!e)return"E";u(t)}return t[n].i},getWeak:function(t,e){if(!A(t,n)){if(!o(t))return!0;if(!e)return!1;u(t)}return t[n].w},onFreeze:function(t){return i&&c.NEED&&o(t)&&!A(t,n)&&u(t),t}}}),mn=(dn.KEY,dn.NEED,dn.fastKey,dn.getWeak,dn.onFreeze,function(t,n){if(!h(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}),gn=O.f,_n=dn.fastKey,bn=m?"_s":"size",wn=function(t,n){var e,r=_n(n);if("F"!==r)return t._i[r];for(e=t._f;e;e=e.n)if(e.k==n)return e},En={getConstructor:function(t,n,e,r){var o=t(function(t,i){un(t,o,n,"_i"),t._t=n,t._i=Ft(null),t._f=void 0,t._l=void 0,t[bn]=0,null!=i&&hn(i,e,t[r],t)});return on(o.prototype,{clear:function(){for(var t=mn(this,n),e=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete e[r.i];t._f=t._l=void 0,t[bn]=0},delete:function(t){var e=mn(this,n),r=wn(e,t);if(r){var o=r.n,i=r.p;delete e._i[r.i],r.r=!0,i&&(i.n=o),o&&(o.p=i),e._f==r&&(e._f=o),e._l==r&&(e._l=i),e[bn]--}return!!r},forEach:function(t){mn(this,n);for(var e,r=x(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.n:this._f;)for(r(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!wn(mn(this,n),t)}}),m&&gn(o.prototype,"size",{get:function(){return mn(this,n)[bn]}}),o},def:function(t,n,e){var r,o,i=wn(t,n);return i?i.v=e:(t._l=i={i:o=_n(n,!0),k:n,v:e,p:r=t._l,n:void 0,r:!1},t._f||(t._f=i),r&&(r.n=i),t[bn]++,"F"!==o&&(t._i[o]=i)),t},getEntry:wn,setStrong:function(t,n,e){Ut(t,n,function(t,e){this._t=mn(t,n),this._k=e,this._l=void 0},function(){for(var t=this._k,n=this._l;n&&n.r;)n=n.p;return this._t&&(this._l=n=n?n.n:this._t._f)?ht(0,"keys"==t?n.k:"values"==t?n.v:[n.k,n.v]):(this._t=void 0,ht(1))},e?"entries":"values",!e,!0),function(t){var n=p[t];m&&n&&!n[vn]&&O.f(n,vn,{configurable:!0,get:function(){return this}})}(n)}},Sn=ut("iterator"),On=!1;try{[7][Sn]().return=function(){On=!0}}catch(t){}var kn={f:{}.propertyIsEnumerable},Cn=Object.getOwnPropertyDescriptor,jn={f:m?Cn:function(t,n){if(t=dt(t),n=E(n,!0),w)try{return Cn(t,n)}catch(t){}if(A(t,n))return k(!kn.f.call(t,n),t[n])}},An=function(t,n){if(v(t),!h(n)&&null!==n)throw TypeError(n+": can't set as prototype!")},Pn={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{(e=x(Function.call,jn.f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return An(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:An}.set,Tn=function(t,n,e,r,o,i){var u=p[t],c=u,a=o?"set":"add",f=c&&c.prototype,s={},l=function(t){var n=f[t];L(f,t,"delete"==t?function(t){return!(i&&!h(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(i&&!h(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return i&&!h(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,e){return n.call(this,0===t?0:t,e),this})};if("function"==typeof c&&(i||f.forEach&&!d(function(){(new c).entries().next()}))){var y=new c,v=y[a](i?{}:-0,1)!=y,m=d(function(){y.has(1)}),g=function(t,n){if(!n&&!On)return!1;var e=!1;try{var r=[7],o=r[Sn]();o.next=function(){return{done:e=!0}},r[Sn]=function(){return o},t(r)}catch(t){}return e}(function(t){new c(t)}),_=!i&&d(function(){for(var t=new c,n=5;n--;)t[a](n,n);return!t.has(-0)});g||((c=n(function(n,e){un(n,c,t);var r=function(t,n,e){var r,o=n.constructor;return o!==e&&"function"==typeof o&&(r=o.prototype)!==e.prototype&&h(r)&&Pn&&Pn(t,r),t}(new u,n,c);return null!=e&&hn(e,o,r[a],r),r})).prototype=f,f.constructor=c),(m||_)&&(l("delete"),l("has"),o&&l("get")),(_||v)&&l(a),i&&f.clear&&delete f.clear}else c=r.getConstructor(n,t,o,a),on(c.prototype,e),dn.NEED=!0;return xt(c,t),s[t]=c,H(H.G+H.W+H.F*(c!=u),s),i||r.setStrong(c,t,o),c},Fn=(Tn("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=En.getEntry(mn(this,"Map"),t);return n&&n.v},set:function(t,n){return En.def(mn(this,"Map"),0===t?0:t,n)}},En,!0),O.f),Ln=Function.prototype,Mn=/^\s*function ([^ (]*)/;"name"in Ln||m&&Fn(Ln,"name",{configurable:!0,get:function(){try{return(""+this).match(Mn)[1]}catch(t){return""}}});var xn=[].slice,Nn={},Rn=Function.bind||function(t){var n=M(this),e=xn.call(arguments,1),r=function(){var o=e.concat(xn.call(arguments));return this instanceof r?function(t,n,e){if(!(n in Nn)){for(var r=[],o=0;o<n;o++)r[o]="a["+o+"]";Nn[n]=Function("F,a","return new F("+r.join(",")+")")}return Nn[n](t,e)}(n,o.length,o):function(t,n,e){var r=void 0===e;switch(n.length){case 0:return r?t():t.call(e);case 1:return r?t(n[0]):t.call(e,n[0]);case 2:return r?t(n[0],n[1]):t.call(e,n[0],n[1]);case 3:return r?t(n[0],n[1],n[2]):t.call(e,n[0],n[1],n[2]);case 4:return r?t(n[0],n[1],n[2],n[3]):t.call(e,n[0],n[1],n[2],n[3])}return t.apply(e,n)}(n,o,t)};return h(n.prototype)&&(r.prototype=n.prototype),r};H(H.P,"Function",{bind:Rn});Tn("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return En.def(mn(this,"Set"),t=0===t?0:t,t)}},En);H(H.S+H.F*!m,"Object",{defineProperties:kt});var In=function(t){switch(r(t)){case"string":return t;case"function":switch(r(t.componentName)){case"function":return t.componentName();case"string":return t.componentName;default:return}default:return}},Dn=function(t){return function(n){return t.components.has(In(n))}},zn=function(){function t(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.generateUuid();o(this,t),this.id=i,Object.defineProperties(this,{ecs:{value:r},components:{value:new Set}}),e(this)}return u(t,[{key:"destroy",value:function(){this.destroyed||(this.destroyed=!0,this.components.forEach(this.deleteComponent.bind(this)),this.ecs.destroyEntity(this.id))}},{key:"setComponent",value:function(t,n){if(this.components.has(t)){if(this[t]!==n)throw new Error("Entity.setComponent(): component already exists; name='".concat(t,"'"))}else this.components.add(t),this[t]=n,n.connectedEntity&&n.connectedEntity(this),this.emit("componentConnected:".concat(t),n,this)}},{key:"hasComponent",value:function(t){return Array.isArray(t)?t.every(Dn(this)):Dn(this)(t)}},{key:"deleteComponent",value:function(t){if(this.components.has(t)){var n=this[t];this.ecs.destroyComponent(t,n),this.components.delete(t),this.emit("destroyComponent:".concat(t),n,this),n.disconnectedEntity&&n.disconnectedEntity(this),delete this[n]}}}]),t}(),Gn=function(){function t(){o(this,t),this.factories=new Map}return u(t,[{key:"registerComponent",value:function(t,n){this.factories.set(t,n)}},{key:"getComponentFactory",value:function(t){var n=In(t),e=this.factories.get(n);if(!e)throw new Error("ComponentRegistry: unknown factory '".concat(n,"'"));return e}},{key:"createComponent",value:function(t,n,e){var r=In(n),o=this.getComponentFactory(r).create(t,e);t.setComponent(r,o)}},{key:"updateComponent",value:function(t,n,e){var r=In(n),o=this.getComponentFactory(r),i=t[r];o.update(i,e)}},{key:"createOrUpdateComponent",value:function(t,n,e){var r=In(n);this[t.hasComponent(r)?"updateComponent":"createComponent"](t,r,e)}},{key:"destroyComponent",value:function(t,n){var e=this.factories.get(In(t));e&&e.destroy&&e.destroy(n)}}]),t}(),Vn=function(t){function n(){var t;return o(this,n),(t=f(this,c(n).call(this))).entities=new Map,t}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&a(t,n)}(n,Gn),u(n,[{key:"createEntity",value:function(t,n){var e=this,r=new zn(this,n);if(this.entities.has(r.id))throw new Error("ECS: duplicate entity.id='".concat(r.id,"' are not allowed"));return this.entities.set(r.id,r),Array.isArray(t)&&t.forEach(function(t){Array.isArray(t)?e.createComponent.apply(e,[r].concat(s(t))):e.createComponent(r,t)}),r}},{key:"getEntity",value:function(t){return this.entities.get(t)}},{key:"destroyEntity",value:function(t){var n=this.entities.get(t);n&&(this.entities.delete(t),n.destroyed||n.destroy())}},{key:"destroyAllEntities",value:function(){this.entities.forEach(function(t){return t.destroy()})}}]),n}(),Kn=function(){function t(n){o(this,t),this.componentClass=n}return u(t,null,[{key:"registerComponent",value:function(n){for(var e=arguments.length,r=new Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];r.forEach(function(e){n.registerComponent(e.componentName(),new t(e))})}}]),u(t,[{key:"create",value:function(t,n){return new this.componentClass(t,n)}},{key:"update",value:function(t,n){t.update&&t.update(n)}},{key:"destroy",value:function(t){t.destroy&&t.destroy()}}]),t}();t.ECS=Vn,t.ComponentFactory=Kn,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=picimo-ecs.js.map
