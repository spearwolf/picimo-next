/*!
@file @picimo/toolkit - part of the hottest webgl library on earth ::( picture-in-motion ):: make sprites & shaders fun again ;-)
@author Wolfger Schramm <wolfger@spearwolf.de>
@version 0.0.1

Copyright 2016-2018 Wolfger Schramm

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

*/
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("loglevel"),require("@picimo/utils"),require("@picimo/core")):"function"==typeof define&&define.amd?define(["exports","loglevel","@picimo/utils","@picimo/core"],r):r(t.PicimoToolkit={},t.log,t.PicimoUtils,t.PicimoCore)}(this,function(t,r,n,e){"use strict";var o=function(t){return"object"==typeof t?null!==t:"function"==typeof t},i=function(t){if(!o(t))throw TypeError(t+" is not an object!");return t},u=function(t){try{return!!t()}catch(t){return!0}},a=!u(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(t,r){return t(r={exports:{}},r.exports),r.exports}var s=f(function(t){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)}),l=s.document,p=o(l)&&o(l.createElement),v=function(t){return p?l.createElement(t):{}},h=!a&&!u(function(){return 7!=Object.defineProperty(v("div"),"a",{get:function(){return 7}}).a}),y=Object.defineProperty,d={f:a?Object.defineProperty:function(t,r,n){if(i(t),r=function(t,r){if(!o(t))return t;var n,e;if(r&&"function"==typeof(n=t.toString)&&!o(e=n.call(t)))return e;if("function"==typeof(n=t.valueOf)&&!o(e=n.call(t)))return e;if(!r&&"function"==typeof(n=t.toString)&&!o(e=n.call(t)))return e;throw TypeError("Can't convert object to primitive value")}(r,!0),i(n),h)try{return y(t,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[r]=n.value),t}},g=d.f,b=Function.prototype,m=/^\s*function ([^ (]*)/;"name"in b||a&&g(b,"name",{configurable:!0,get:function(){try{return(""+this).match(m)[1]}catch(t){return""}}});var A=f(function(t){var r=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=r)}),_=(A.version,f(function(t){var r=s["__core-js_shared__"]||(s["__core-js_shared__"]={});(t.exports=function(t,n){return r[t]||(r[t]=void 0!==n?n:{})})("versions",[]).push({version:A.version,mode:"global",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})})),O=0,j=Math.random(),C=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++O+j).toString(36))},w=f(function(t){var r=_("wks"),n=s.Symbol,e="function"==typeof n;(t.exports=function(t){return r[t]||(r[t]=e&&n[t]||(e?n:C)("Symbol."+t))}).store=r}),S=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},x=a?function(t,r,n){return d.f(t,r,S(1,n))}:function(t,r,n){return t[r]=n,t},P=w("unscopables"),E=Array.prototype;null==E[P]&&x(E,P,{});var T=function(t){E[P][t]=!0},k=function(t,r){return{value:r,done:!!t}},F={},L={}.toString,z=function(t){return L.call(t).slice(8,-1)},M=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==z(t)?t.split(""):Object(t)},D=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},R=function(t){return M(D(t))},I={}.hasOwnProperty,B=function(t,r){return I.call(t,r)},G=f(function(t){var r=C("src"),n=Function.toString,e=(""+n).split("toString");A.inspectSource=function(t){return n.call(t)},(t.exports=function(t,n,o,i){var u="function"==typeof o;u&&(B(o,"name")||x(o,"name",n)),t[n]!==o&&(u&&(B(o,r)||x(o,r,t[n]?""+t[n]:e.join(String(n)))),t===s?t[n]=o:i?t[n]?t[n]=o:x(t,n,o):(delete t[n],x(t,n,o)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[r]||n.call(this)})}),V=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},N=function(t,r,n){if(V(t),void 0===r)return t;switch(n){case 1:return function(n){return t.call(r,n)};case 2:return function(n,e){return t.call(r,n,e)};case 3:return function(n,e,o){return t.call(r,n,e,o)}}return function(){return t.apply(r,arguments)}},$=function(t,r,n){var e,o,i,u,a=t&$.F,c=t&$.G,f=t&$.S,l=t&$.P,p=t&$.B,v=c?s:f?s[r]||(s[r]={}):(s[r]||{}).prototype,h=c?A:A[r]||(A[r]={}),y=h.prototype||(h.prototype={});for(e in c&&(n=r),n)i=((o=!a&&v&&void 0!==v[e])?v:n)[e],u=p&&o?N(i,s):l&&"function"==typeof i?N(Function.call,i):i,v&&G(v,e,i,t&$.U),h[e]!=i&&x(h,e,u),l&&y[e]!=i&&(y[e]=i)};s.core=A,$.F=1,$.G=2,$.S=4,$.P=8,$.B=16,$.W=32,$.U=64,$.R=128;var q,U=$,H=Math.ceil,W=Math.floor,Y=function(t){return isNaN(t=+t)?0:(t>0?W:H)(t)},J=Math.min,K=function(t){return t>0?J(Y(t),9007199254740991):0},Q=Math.max,X=Math.min,Z=_("keys"),tt=function(t){return Z[t]||(Z[t]=C(t))},rt=(q=!1,function(t,r,n){var e,o=R(t),i=K(o.length),u=function(t,r){return(t=Y(t))<0?Q(t+r,0):X(t,r)}(n,i);if(q&&r!=r){for(;i>u;)if((e=o[u++])!=e)return!0}else for(;i>u;u++)if((q||u in o)&&o[u]===r)return q||u||0;return!q&&-1}),nt=tt("IE_PROTO"),et="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),ot=Object.keys||function(t){return function(t,r){var n,e=R(t),o=0,i=[];for(n in e)n!=nt&&B(e,n)&&i.push(n);for(;r.length>o;)B(e,n=r[o++])&&(~rt(i,n)||i.push(n));return i}(t,et)},it=a?Object.defineProperties:function(t,r){i(t);for(var n,e=ot(r),o=e.length,u=0;o>u;)d.f(t,n=e[u++],r[n]);return t},ut=s.document,at=ut&&ut.documentElement,ct=tt("IE_PROTO"),ft=function(){},st=function(){var t,r=v("iframe"),n=et.length;for(r.style.display="none",at.appendChild(r),r.src="javascript:",(t=r.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),st=t.F;n--;)delete st.prototype[et[n]];return st()},lt=Object.create||function(t,r){var n;return null!==t?(ft.prototype=i(t),n=new ft,ft.prototype=null,n[ct]=t):n=st(),void 0===r?n:it(n,r)},pt=d.f,vt=w("toStringTag"),ht=function(t,r,n){t&&!B(t=n?t:t.prototype,vt)&&pt(t,vt,{configurable:!0,value:r})},yt={};x(yt,w("iterator"),function(){return this});var dt=function(t,r,n){t.prototype=lt(yt,{next:S(1,n)}),ht(t,r+" Iterator")},gt=function(t){return Object(D(t))},bt=tt("IE_PROTO"),mt=Object.prototype,At=Object.getPrototypeOf||function(t){return t=gt(t),B(t,bt)?t[bt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?mt:null},_t=w("iterator"),Ot=!([].keys&&"next"in[].keys()),jt=function(){return this},Ct=function(t,r,n,e,o,i,u){dt(n,r,e);var a,c,f,s=function(t){if(!Ot&&t in h)return h[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},l=r+" Iterator",p="values"==o,v=!1,h=t.prototype,y=h[_t]||h["@@iterator"]||o&&h[o],d=y||s(o),g=o?p?s("entries"):d:void 0,b="Array"==r&&h.entries||y;if(b&&(f=At(b.call(new t)))!==Object.prototype&&f.next&&(ht(f,l,!0),"function"!=typeof f[_t]&&x(f,_t,jt)),p&&y&&"values"!==y.name&&(v=!0,d=function(){return y.call(this)}),(Ot||v||!h[_t])&&x(h,_t,d),F[r]=d,F[l]=jt,o)if(a={values:p?d:s("values"),keys:i?d:s("keys"),entries:g},u)for(c in a)c in h||G(h,c,a[c]);else U(U.P+U.F*(Ot||v),r,a);return a}(Array,"Array",function(t,r){this._t=R(t),this._i=0,this._k=r},function(){var t=this._t,r=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,k(1)):k(0,"keys"==r?n:"values"==r?t[n]:[n,t[n]])},"values");F.Arguments=F.Array,T("keys"),T("values"),T("entries");for(var wt=w("iterator"),St=w("toStringTag"),xt=F.Array,Pt={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Et=ot(Pt),Tt=0;Tt<Et.length;Tt++){var kt,Ft=Et[Tt],Lt=Pt[Ft],zt=s[Ft],Mt=zt&&zt.prototype;if(Mt&&(Mt[wt]||x(Mt,wt,xt),Mt[St]||x(Mt,St,Ft),F[Ft]=xt,Lt))for(kt in Ct)Mt[kt]||G(Mt,kt,Ct[kt],!0)}var Dt=Array.isArray||function(t){return"Array"==z(t)},Rt=w("species"),It=function(t,r){return new(function(t){var r;return Dt(t)&&("function"!=typeof(r=t.constructor)||r!==Array&&!Dt(r.prototype)||(r=void 0),o(r)&&null===(r=r[Rt])&&(r=void 0)),void 0===r?Array:r}(t))(r)},Bt=function(t,r){var n=1==t,e=2==t,o=3==t,i=4==t,u=6==t,a=5==t||u,c=r||It;return function(r,f,s){for(var l,p,v=gt(r),h=M(v),y=N(f,s,3),d=K(h.length),g=0,b=n?c(r,d):e?c(r,0):void 0;d>g;g++)if((a||g in h)&&(p=y(l=h[g],g,v),t))if(n)b[g]=p;else if(p)switch(t){case 3:return!0;case 5:return l;case 6:return g;case 2:b.push(l)}else if(i)return!1;return u?-1:o||i?i:b}},Gt=function(t,r){return!!t&&u(function(){r?t.call(null,function(){},1):t.call(null)})},Vt=Bt(0),Nt=Gt([].forEach,!0);U(U.P+U.F*!Nt,"Array",{forEach:function(t){return Vt(this,t,arguments[1])}});var $t={f:Object.getOwnPropertySymbols},qt={f:{}.propertyIsEnumerable},Ut=Object.assign,Ht=!Ut||u(function(){var t={},r={},n=Symbol(),e="abcdefghijklmnopqrst";return t[n]=7,e.split("").forEach(function(t){r[t]=t}),7!=Ut({},t)[n]||Object.keys(Ut({},r)).join("")!=e})?function(t,r){for(var n=gt(t),e=arguments.length,o=1,i=$t.f,u=qt.f;e>o;)for(var a,c=M(arguments[o++]),f=i?ot(c).concat(i(c)):ot(c),s=f.length,l=0;s>l;)u.call(c,a=f[l++])&&(n[a]=c[a]);return n}:Ut;function Wt(t){return(Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yt(t,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Jt(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}U(U.S+U.F,"Object",{assign:Ht});var Kt=Object.prototype.hasOwnProperty;var Qt=function(t,r){return null!=t&&Kt.call(t,r)},Xt=Array.isArray,Zt="object"==typeof c&&c&&c.Object===Object&&c,tr="object"==typeof self&&self&&self.Object===Object&&self,rr=Zt||tr||Function("return this")(),nr=rr.Symbol,er=Object.prototype,or=er.hasOwnProperty,ir=er.toString,ur=nr?nr.toStringTag:void 0;var ar=function(t){var r=or.call(t,ur),n=t[ur];try{t[ur]=void 0}catch(t){}var e=ir.call(t);return r?t[ur]=n:delete t[ur],e},cr=Object.prototype.toString;var fr=function(t){return cr.call(t)},sr="[object Null]",lr="[object Undefined]",pr=nr?nr.toStringTag:void 0;var vr=function(t){return null==t?void 0===t?lr:sr:pr&&pr in Object(t)?ar(t):fr(t)};var hr=function(t){return null!=t&&"object"==typeof t},yr="[object Symbol]";var dr=function(t){return"symbol"==typeof t||hr(t)&&vr(t)==yr},gr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,br=/^\w*$/;var mr=function(t,r){if(Xt(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!dr(t))||br.test(t)||!gr.test(t)||null!=r&&t in Object(r)};var Ar=function(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)},_r="[object AsyncFunction]",Or="[object Function]",jr="[object GeneratorFunction]",Cr="[object Proxy]";var wr,Sr=function(t){if(!Ar(t))return!1;var r=vr(t);return r==Or||r==jr||r==_r||r==Cr},xr=rr["__core-js_shared__"],Pr=(wr=/[^.]+$/.exec(xr&&xr.keys&&xr.keys.IE_PROTO||""))?"Symbol(src)_1."+wr:"";var Er=function(t){return!!Pr&&Pr in t},Tr=Function.prototype.toString;var kr=function(t){if(null!=t){try{return Tr.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Fr=/^\[object .+?Constructor\]$/,Lr=Function.prototype,zr=Object.prototype,Mr=Lr.toString,Dr=zr.hasOwnProperty,Rr=RegExp("^"+Mr.call(Dr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Ir=function(t){return!(!Ar(t)||Er(t))&&(Sr(t)?Rr:Fr).test(kr(t))};var Br=function(t,r){return null==t?void 0:t[r]};var Gr=function(t,r){var n=Br(t,r);return Ir(n)?n:void 0},Vr=Gr(Object,"create");var Nr=function(){this.__data__=Vr?Vr(null):{},this.size=0};var $r=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},qr="__lodash_hash_undefined__",Ur=Object.prototype.hasOwnProperty;var Hr=function(t){var r=this.__data__;if(Vr){var n=r[t];return n===qr?void 0:n}return Ur.call(r,t)?r[t]:void 0},Wr=Object.prototype.hasOwnProperty;var Yr=function(t){var r=this.__data__;return Vr?void 0!==r[t]:Wr.call(r,t)},Jr="__lodash_hash_undefined__";var Kr=function(t,r){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Vr&&void 0===r?Jr:r,this};function Qr(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var e=t[r];this.set(e[0],e[1])}}Qr.prototype.clear=Nr,Qr.prototype.delete=$r,Qr.prototype.get=Hr,Qr.prototype.has=Yr,Qr.prototype.set=Kr;var Xr=Qr;var Zr=function(){this.__data__=[],this.size=0};var tn=function(t,r){return t===r||t!=t&&r!=r};var rn=function(t,r){for(var n=t.length;n--;)if(tn(t[n][0],r))return n;return-1},nn=Array.prototype.splice;var en=function(t){var r=this.__data__,n=rn(r,t);return!(n<0||(n==r.length-1?r.pop():nn.call(r,n,1),--this.size,0))};var on=function(t){var r=this.__data__,n=rn(r,t);return n<0?void 0:r[n][1]};var un=function(t){return rn(this.__data__,t)>-1};var an=function(t,r){var n=this.__data__,e=rn(n,t);return e<0?(++this.size,n.push([t,r])):n[e][1]=r,this};function cn(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var e=t[r];this.set(e[0],e[1])}}cn.prototype.clear=Zr,cn.prototype.delete=en,cn.prototype.get=on,cn.prototype.has=un,cn.prototype.set=an;var fn=cn,sn=Gr(rr,"Map");var ln=function(){this.size=0,this.__data__={hash:new Xr,map:new(sn||fn),string:new Xr}};var pn=function(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t};var vn=function(t,r){var n=t.__data__;return pn(r)?n["string"==typeof r?"string":"hash"]:n.map};var hn=function(t){var r=vn(this,t).delete(t);return this.size-=r?1:0,r};var yn=function(t){return vn(this,t).get(t)};var dn=function(t){return vn(this,t).has(t)};var gn=function(t,r){var n=vn(this,t),e=n.size;return n.set(t,r),this.size+=n.size==e?0:1,this};function bn(t){var r=-1,n=null==t?0:t.length;for(this.clear();++r<n;){var e=t[r];this.set(e[0],e[1])}}bn.prototype.clear=ln,bn.prototype.delete=hn,bn.prototype.get=yn,bn.prototype.has=dn,bn.prototype.set=gn;var mn=bn,An="Expected a function";function _n(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError(An);var n=function(){var e=arguments,o=r?r.apply(this,e):e[0],i=n.cache;if(i.has(o))return i.get(o);var u=t.apply(this,e);return n.cache=i.set(o,u)||i,u};return n.cache=new(_n.Cache||mn),n}_n.Cache=mn;var On=_n,jn=500;var Cn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wn=/\\(\\)?/g,Sn=function(t){var r=On(t,function(t){return n.size===jn&&n.clear(),t}),n=r.cache;return r}(function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(Cn,function(t,n,e,o){r.push(e?o.replace(wn,"$1"):n||t)}),r});var xn=function(t,r){for(var n=-1,e=null==t?0:t.length,o=Array(e);++n<e;)o[n]=r(t[n],n,t);return o},Pn=1/0,En=nr?nr.prototype:void 0,Tn=En?En.toString:void 0;var kn=function t(r){if("string"==typeof r)return r;if(Xt(r))return xn(r,t)+"";if(dr(r))return Tn?Tn.call(r):"";var n=r+"";return"0"==n&&1/r==-Pn?"-0":n};var Fn=function(t){return null==t?"":kn(t)};var Ln=function(t,r){return Xt(t)?t:mr(t,r)?[t]:Sn(Fn(t))},zn="[object Arguments]";var Mn=function(t){return hr(t)&&vr(t)==zn},Dn=Object.prototype,Rn=Dn.hasOwnProperty,In=Dn.propertyIsEnumerable,Bn=Mn(function(){return arguments}())?Mn:function(t){return hr(t)&&Rn.call(t,"callee")&&!In.call(t,"callee")},Gn=9007199254740991,Vn=/^(?:0|[1-9]\d*)$/;var Nn=function(t,r){var n=typeof t;return!!(r=null==r?Gn:r)&&("number"==n||"symbol"!=n&&Vn.test(t))&&t>-1&&t%1==0&&t<r},$n=9007199254740991;var qn=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=$n},Un=1/0;var Hn=function(t){if("string"==typeof t||dr(t))return t;var r=t+"";return"0"==r&&1/t==-Un?"-0":r};var Wn=function(t,r,n){for(var e=-1,o=(r=Ln(r,t)).length,i=!1;++e<o;){var u=Hn(r[e]);if(!(i=null!=t&&n(t,u)))break;t=t[u]}return i||++e!=o?i:!!(o=null==t?0:t.length)&&qn(o)&&Nn(u,o)&&(Xt(t)||Bn(t))};var Yn=function(t,r){return null!=t&&Wn(t,r,Qt)},Jn=function(){try{var t=Gr(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Kn=function(t,r,n){"__proto__"==r&&Jn?Jn(t,r,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[r]=n},Qn=Object.prototype.hasOwnProperty;var Xn=function(t,r,n){var e=t[r];Qn.call(t,r)&&tn(e,n)&&(void 0!==n||r in t)||Kn(t,r,n)};var Zn=function(t,r,n,e){if(!Ar(t))return t;for(var o=-1,i=(r=Ln(r,t)).length,u=i-1,a=t;null!=a&&++o<i;){var c=Hn(r[o]),f=n;if(o!=u){var s=a[c];void 0===(f=e?e(s,c,a):void 0)&&(f=Ar(s)?s:Nn(r[o+1])?[]:{})}Xn(a,c,f),a=a[c]}return t};var te=function(t,r,n){return null==t?t:Zn(t,r,n)};U(U.S,"Array",{isArray:Dt});var re=Bt(2);U(U.P+U.F*!Gt([].filter,!0),"Array",{filter:function(t){return re(this,t,arguments[1])}});U(U.P+U.F*!Gt([].reduce,!0),"Array",{reduce:function(t){return function(t,r,n,e,o){V(r);var i=gt(t),u=M(i),a=K(i.length),c=o?a-1:0,f=o?-1:1;if(n<2)for(;;){if(c in u){e=u[c],c+=f;break}if(c+=f,o?c<0:a<=c)throw TypeError("Reduce of empty array with no initial value")}for(;o?c>=0:a>c;c+=f)c in u&&(e=r(e,u[c],c,i));return e}(this,t,arguments.length,arguments[1],!1)}});var ne=[].slice,ee={},oe=Function.bind||function(t){var r=V(this),n=ne.call(arguments,1),e=function(){var o=n.concat(ne.call(arguments));return this instanceof e?function(t,r,n){if(!(r in ee)){for(var e=[],o=0;o<r;o++)e[o]="a["+o+"]";ee[r]=Function("F,a","return new F("+e.join(",")+")")}return ee[r](t,n)}(r,o.length,o):function(t,r,n){var e=void 0===n;switch(r.length){case 0:return e?t():t.call(n);case 1:return e?t(r[0]):t.call(n,r[0]);case 2:return e?t(r[0],r[1]):t.call(n,r[0],r[1]);case 3:return e?t(r[0],r[1],r[2]):t.call(n,r[0],r[1],r[2]);case 4:return e?t(r[0],r[1],r[2],r[3]):t.call(n,r[0],r[1],r[2],r[3])}return t.apply(n,r)}(r,o,t)};return o(r.prototype)&&(e.prototype=r.prototype),e};U(U.P,"Function",{bind:oe});var ie=[].sort,ue=[1,2,3];U(U.P+U.F*(u(function(){ue.sort(void 0)})||!u(function(){ue.sort(null)})||!Gt(ie)),"Array",{sort:function(t){return void 0===t?ie.call(gt(this)):ie.call(gt(this),V(t))}});!function(t,r,n){var e=w(t),o=n(D,e,""[t]),i=o[0],a=o[1];u(function(){var r={};return r[e]=function(){return 7},7!=""[t](r)})&&(G(String.prototype,t,i),x(RegExp.prototype,e,2==r?function(t,r){return a.call(t,this,r)}:function(t){return a.call(t,this)}))}("replace",2,function(t,r,n){return[function(e,o){var i=t(this),u=null==e?void 0:e[r];return void 0!==u?u.call(e,i,o):n.call(String(i),e,o)},n]});var ae=function(){var t=i(this),r="";return t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.unicode&&(r+="u"),t.sticky&&(r+="y"),r};a&&"g"!=/./g.flags&&d.f(RegExp.prototype,"flags",{configurable:!0,get:ae});var ce=/./.toString,fe=function(t){G(RegExp.prototype,"toString",t,!0)};u(function(){return"/a/b"!=ce.call({source:"a",flags:"b"})})?fe(function(){var t=i(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?ae.call(t):void 0)}):"toString"!=ce.name&&fe(function(){return ce.call(this)});var se=Date.prototype,le=se.toString,pe=se.getTime;function ve(t,r,n,e){this.message=t,this.expected=r,this.found=n,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,ve)}new Date(NaN)+""!="Invalid Date"&&G(se,"toString",function(){var t=pe.call(this);return t==t?le.call(this):"Invalid Date"}),function(t,r){function n(){this.constructor=t}n.prototype=r.prototype,t.prototype=new n}(ve,Error),ve.buildMessage=function(t,r){var n={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var r,n="";for(r=0;r<t.parts.length;r++)n+=t.parts[r]instanceof Array?i(t.parts[r][0])+"-"+i(t.parts[r][1]):i(t.parts[r]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+e(t)})}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+e(t)})}return"Expected "+function(t){var r,e,o,i=new Array(t.length);for(r=0;r<t.length;r++)i[r]=(o=t[r],n[o.type](o));if(i.sort(),i.length>0){for(r=1,e=1;r<i.length;r++)i[r-1]!==i[r]&&(i[e]=i[r],e++);i.length=e}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(r)+" found."};var he=function(t,r){r=void 0!==r?r:{};var n,e={},o={start:xn},i=xn,u=jn("picimo-lang"),a=function(t){return re(t)},c=jn("top-level statement"),f=function(t){return t},s=jn("statement"),l=function(t,r,n,e){return{verb:n,subject:e}},p=function(t,r,n,e){return e.type="declaration",e.name=r,e.declarationType=t,n&&(e.verb=n.verb,e.subject=n.subject),e},v="vertexobject",h=_n("VertexObject",!0),y="primitive",d=_n("Primitive",!0),g="spritegroup",b=_n("SpriteGroup",!0),m=function(t){return t.toLowerCase()},A="instantiates",_=_n("instantiates",!0),O=function(t){return t.toLowerCase()},j=function(t,r,n){return n.name=t,r&&(n.args=r),n},C=function(t,r){return r},w=function(t,r,n){var e={type:"dataBlock",data:re(n)};return t&&(e.dataType=t),r.length&&r.forEach(ne.bind(null,e)),e},S="{",x=_n("{",!1),P="}",E=_n("}",!1),T=jn("constant statement"),k="=",F=_n("=",!1),L=function(t,r){!function(t,r){te.hasOption(t)||te.writeOption(t,r)}(t,r)},z=jn("property-call statement"),M="@",D=_n("@",!1),R=function(t,r){var n={type:"propertyCall",name:t};return r&&(n.args=r),n},I=jn("property call arguments list"),B="(",G=_n("(",!1),V=",",N=_n(",",!1),$=function(t,r){return r},q=")",U=_n(")",!1),H=function(t,r){return[t].concat(r)},W=jn("property call argument"),Y=function(t){return t},J=jn("named arguments list"),K=jn("named argument"),Q=":",X=_n(":",!1),Z=function(t,r){return{name:t,value:r}},tt=jn("data statement"),rt=function(t,r,n,e){return e},nt=function(t,r,n,e,o,i){return i},et=function(t,r,n,e,o,i){var u={type:"data",name:t};return r&&(u.args=r),null!=o&&(u.value=o),n&&(u.valueType=n),e.length&&e.forEach(ne.bind(null,u)),i.length&&i.forEach(ne.bind(null,u)),u},ot=jn("data value type"),it="float32",ut=_n("float32",!1),at="int32",ct=_n("int32",!1),ft="int16",st=_n("int16",!1),lt="int8",pt=_n("int8",!1),vt="uint32",ht=_n("uint32",!1),yt="uint16",dt=_n("uint16",!1),gt="uint8",bt=_n("uint8",!1),mt=function(t){return t},At=function(t){return t},_t="false",Ot=_n("false",!1),jt=function(){return!1},Ct="no",wt=_n("no",!1),St="off",xt=_n("off",!1),Pt="true",Et=_n("true",!1),Tt=function(){return!0},kt="on",Ft=_n("on",!1),Lt="yes",zt=_n("yes",!1),Mt="null",Dt=_n("null",!1),Rt=function(){return null},It=function(t){return t},Bt=jn("value array"),Gt=function(t,r){return r},Vt=function(t,r){return[t].concat(r)},Nt=function(t){return t||[]},$t="[",qt=_n("[",!1),Ut="]",Ht=_n("]",!1),Wt="+",Yt=_n("+",!1),Jt="-",Kt=_n("-",!1),Qt=function(t,r){return r.reduce(function(t,r){return"+"===r[1]?t+r[3]:"-"===r[1]?t-r[3]:void 0},t)},Xt="*",Zt=_n("*",!1),tr="/",rr=_n("/",!1),nr=function(t,r){return r.reduce(function(t,r){return"*"===r[1]?t*r[3]:"/"===r[1]?t/r[3]:void 0},t)},er=function(t){return t},or=function(t,r){var n=function(t){return te.hasOption(t)?te.readOption(t):t}(r);return t?-n:n},ir=jn("number"),ur=function(){return parseFloat(An())},ar=".",cr=_n(".",!1),fr=/^[1-9]/,sr=On([["1","9"]],!1,!1),lr=/^[eE]/,pr=On(["e","E"],!1,!1),vr="0",hr=_n("0",!1),yr=jn("string"),dr=function(t){return t.join("")},gr='"',br=_n('"',!1),mr="\\",Ar=_n("\\",!1),_r="b",Or=_n("b",!1),jr=function(){return"\b"},Cr="f",wr=_n("f",!1),Sr=function(){return"\f"},xr="n",Pr=_n("n",!1),Er=function(){return"\n"},Tr="r",kr=_n("r",!1),Fr=function(){return"\r"},Lr="t",zr=_n("t",!1),Mr=function(){return"\t"},Dr="u",Rr=_n("u",!1),Ir=function(t){return String.fromCharCode(parseInt(t,16))},Br=function(t){return t},Gr=/^[^\0-\x1F"\\]/,Vr=On([["\0",""],'"',"\\"],!0,!1),Nr=/^[a-z]/i,$r=On([["a","z"]],!1,!0),qr=function(t){return An()},Ur=function(t,r){return t+(r&&function t(r){return re(r).reduce(function(r,n){return r+(Array.isArray(n)?t(n):n)},"")}(r)||"")},Hr=/^[_a-z0-9\-]/i,Wr=On(["_",["a","z"],["0","9"],"-"],!1,!0),Yr=jn("whitespaces with optional line breaks"),Jr=/^[ \t\n\r]/,Kr=On([" ","\t","\n","\r"],!1,!1),Qr=jn("whitespaces"),Xr=/^[ \t]/,Zr=On([" ","\t"],!1,!1),tn=jn("new line"),rn="\n",nn=_n("\n",!1),en="\r\n",on=_n("\r\n",!1),un="\r",an=_n("\r",!1),cn="\f",fn=_n("\f",!1),sn=/^[0-9]/,ln=On([["0","9"]],!1,!1),pn=/^[0-9a-f]/i,vn=On([["0","9"],["a","f"]],!1,!0),hn=0,yn=0,dn=[{line:1,column:1}],gn=0,bn=[],mn=0;if("startRule"in r){if(!(r.startRule in o))throw new Error("Can't start parsing from rule \""+r.startRule+'".');i=o[r.startRule]}function An(){return t.substring(yn,hn)}function _n(t,r){return{type:"literal",text:t,ignoreCase:r}}function On(t,r,n){return{type:"class",parts:t,inverted:r,ignoreCase:n}}function jn(t){return{type:"other",description:t}}function Cn(r){var n,e=dn[r];if(e)return e;for(n=r-1;!dn[n];)n--;for(e={line:(e=dn[n]).line,column:e.column};n<r;)10===t.charCodeAt(n)?(e.line++,e.column=1):e.column++,n++;return dn[r]=e,e}function wn(t,r){var n=Cn(t),e=Cn(r);return{start:{offset:t,line:n.line,column:n.column},end:{offset:r,line:e.line,column:e.column}}}function Sn(t){hn<gn||(hn>gn&&(gn=hn,bn=[]),bn.push(t))}function xn(){var t,r,n;if(mn++,t=hn,Hn()!==e){for(r=[],n=Pn();n!==e;)r.push(n),n=Pn();r!==e&&(n=Hn())!==e?(yn=t,t=a(r)):(hn=t,t=e)}else hn=t,t=e;return mn--,t===e&&0===mn&&Sn(u),t}function Pn(){var r,n;return mn++,r=hn,(n=function(){var r,n,o,i;return mn++,r=hn,(n=qn())!==e&&Wn()!==e?(61===t.charCodeAt(hn)?(o=k,hn++):(o=e,0===mn&&Sn(F)),o!==e&&Wn()!==e&&(i=Dn())!==e?(yn=r,n=L(n,i),r=n):(hn=r,r=e)):(hn=r,r=e),mn--,r===e&&(n=e,0===mn&&Sn(T)),r}())===e&&(n=function(){var r,n,o,i,u,a,c;return r=hn,(n=function(){var r,n;return r=hn,t.substr(hn,12).toLowerCase()===v?(n=t.substr(hn,12),hn+=12):(n=e,0===mn&&Sn(h)),n===e&&(t.substr(hn,9).toLowerCase()===y?(n=t.substr(hn,9),hn+=9):(n=e,0===mn&&Sn(d)),n===e&&(t.substr(hn,11).toLowerCase()===g?(n=t.substr(hn,11),hn+=11):(n=e,0===mn&&Sn(b)))),n!==e&&(yn=r,n=m(n)),r=n}())!==e&&Wn()!==e&&(o=qn())!==e&&Wn()!==e?(i=hn,(u=function(){var r,n;return r=hn,t.substr(hn,12).toLowerCase()===A?(n=t.substr(hn,12),hn+=12):(n=e,0===mn&&Sn(_)),n!==e&&(yn=r,n=O(n)),r=n}())!==e&&(a=Wn())!==e&&(c=qn())!==e?(yn=i,u=l(n,o,u,c),i=u):(hn=i,i=e),i===e&&(i=null),i!==e&&(u=Wn())!==e&&(a=Tn())!==e?(yn=r,n=p(n,o,i,a),r=n):(hn=r,r=e)):(hn=r,r=e),r}()),n!==e&&Yn()!==e&&Hn()!==e?(yn=r,r=n=f(n)):(hn=r,r=e),mn--,r===e&&(n=e,0===mn&&Sn(c)),r}function En(){var t,r;return mn++,t=hn,(r=function(){var t,r,n,o;return t=hn,(r=qn())!==e&&Wn()!==e?((n=Ln())===e&&(n=null),n!==e&&Wn()!==e&&(o=Tn())!==e?(yn=t,r=j(r,n,o),t=r):(hn=t,t=e)):(hn=t,t=e),t}())===e&&(r=function(){var t,r,n,o,i,u,a,c,f,s,l;if(mn++,t=hn,(r=qn())!==e)if(Wn()!==e)if((n=Ln())===e&&(n=null),n!==e)if(Wn()!==e)if((o=Mn())===e&&(o=null),o!==e){for(i=[],u=hn,(a=Wn())!==e&&(c=kn())!==e?(yn=u,a=rt(r,n,o,c),u=a):(hn=u,u=e);u!==e;)i.push(u),u=hn,(a=Wn())!==e&&(c=kn())!==e?(yn=u,a=rt(r,n,o,c),u=a):(hn=u,u=e);if(i!==e)if((u=Wn())!==e)if((a=Dn())===e&&(a=null),a!==e){for(c=[],f=hn,(s=Wn())!==e&&(l=kn())!==e?(yn=f,s=nt(r,n,o,i,a,l),f=s):(hn=f,f=e);f!==e;)c.push(f),f=hn,(s=Wn())!==e&&(l=kn())!==e?(yn=f,s=nt(r,n,o,i,a,l),f=s):(hn=f,f=e);c!==e?(yn=t,r=et(r,n,o,i,a,c),t=r):(hn=t,t=e)}else hn=t,t=e;else hn=t,t=e;else hn=t,t=e}else hn=t,t=e;else hn=t,t=e;else hn=t,t=e;else hn=t,t=e;else hn=t,t=e;return mn--,t===e&&(r=e,0===mn&&Sn(tt)),t}())===e&&(r=kn()),r!==e&&Yn()!==e&&Hn()!==e?(yn=t,t=r=f(r)):(hn=t,t=e),mn--,t===e&&(r=e,0===mn&&Sn(s)),t}function Tn(){var r,n,o,i,u,a;if(r=hn,(n=Mn())===e&&(n=null),n!==e){for(o=[],i=hn,(u=Wn())!==e&&(a=kn())!==e?(yn=i,i=u=C(n,a)):(hn=i,i=e);i!==e;)o.push(i),i=hn,(u=Wn())!==e&&(a=kn())!==e?(yn=i,i=u=C(n,a)):(hn=i,i=e);if(o!==e)if((i=function(){var r,n,o,i;return r=hn,(n=Wn())!==e?(123===t.charCodeAt(hn)?(o=S,hn++):(o=e,0===mn&&Sn(x)),o!==e&&(i=Hn())!==e?r=n=[n,o,i]:(hn=r,r=e)):(hn=r,r=e),r}())!==e){for(u=[],a=En();a!==e;)u.push(a),a=En();u!==e&&(a=function(){var r,n,o,i;return r=hn,(n=Hn())!==e?(125===t.charCodeAt(hn)?(o=P,hn++):(o=e,0===mn&&Sn(E)),o!==e&&(i=Wn())!==e?r=n=[n,o,i]:(hn=r,r=e)):(hn=r,r=e),r}())!==e?(yn=r,r=n=w(n,o,u)):(hn=r,r=e)}else hn=r,r=e;else hn=r,r=e}else hn=r,r=e;return r}function kn(){var r,n,o,i;return mn++,r=hn,64===t.charCodeAt(hn)?(n=M,hn++):(n=e,0===mn&&Sn(D)),n!==e&&(o=qn())!==e&&Wn()!==e?((i=function(){var r,n,o,i,u,a,c;if(mn++,r=hn,40===t.charCodeAt(hn)?(n=B,hn++):(n=e,0===mn&&Sn(G)),n!==e)if((o=Fn())!==e){for(i=[],u=hn,44===t.charCodeAt(hn)?(a=V,hn++):(a=e,0===mn&&Sn(N)),a!==e&&Wn()!==e&&(c=Fn())!==e?(yn=u,a=$(o,c),u=a):(hn=u,u=e);u!==e;)i.push(u),u=hn,44===t.charCodeAt(hn)?(a=V,hn++):(a=e,0===mn&&Sn(N)),a!==e&&Wn()!==e&&(c=Fn())!==e?(yn=u,a=$(o,c),u=a):(hn=u,u=e);i!==e?(41===t.charCodeAt(hn)?(u=q,hn++):(u=e,0===mn&&Sn(U)),u!==e?(yn=r,n=H(o,i),r=n):(hn=r,r=e)):(hn=r,r=e)}else hn=r,r=e;else hn=r,r=e;return mn--,r===e&&(n=e,0===mn&&Sn(I)),r}())===e&&(i=null),i!==e?(yn=r,r=n=R(o,i)):(hn=r,r=e)):(hn=r,r=e),mn--,r===e&&(n=e,0===mn&&Sn(z)),r}function Fn(){var t,r;return mn++,t=hn,Wn()!==e?((r=Dn())===e&&(r=qn()),r!==e&&Wn()!==e?(yn=t,t=Y(r)):(hn=t,t=e)):(hn=t,t=e),mn--,t===e&&0===mn&&Sn(W),t}function Ln(){var r,n,o,i,u,a,c;if(mn++,r=hn,40===t.charCodeAt(hn)?(n=B,hn++):(n=e,0===mn&&Sn(G)),n!==e)if((o=zn())!==e){for(i=[],u=hn,44===t.charCodeAt(hn)?(a=V,hn++):(a=e,0===mn&&Sn(N)),a!==e&&Wn()!==e&&(c=zn())!==e?(yn=u,u=a=$(o,c)):(hn=u,u=e);u!==e;)i.push(u),u=hn,44===t.charCodeAt(hn)?(a=V,hn++):(a=e,0===mn&&Sn(N)),a!==e&&Wn()!==e&&(c=zn())!==e?(yn=u,u=a=$(o,c)):(hn=u,u=e);i!==e?(41===t.charCodeAt(hn)?(u=q,hn++):(u=e,0===mn&&Sn(U)),u!==e?(yn=r,r=n=H(o,i)):(hn=r,r=e)):(hn=r,r=e)}else hn=r,r=e;else hn=r,r=e;return mn--,r===e&&(n=e,0===mn&&Sn(J)),r}function zn(){var r,n,o,i;return mn++,r=hn,Wn()!==e&&(n=qn())!==e&&Wn()!==e?(58===t.charCodeAt(hn)?(o=Q,hn++):(o=e,0===mn&&Sn(X)),o!==e&&Wn()!==e&&(i=Dn())!==e&&Wn()!==e?(yn=r,r=Z(n,i)):(hn=r,r=e)):(hn=r,r=e),mn--,r===e&&0===mn&&Sn(K),r}function Mn(){var r,n,o;return mn++,r=hn,58===t.charCodeAt(hn)?(n=Q,hn++):(n=e,0===mn&&Sn(X)),n!==e&&Wn()!==e?(t.substr(hn,7)===it?(o=it,hn+=7):(o=e,0===mn&&Sn(ut)),o===e&&(t.substr(hn,5)===at?(o=at,hn+=5):(o=e,0===mn&&Sn(ct)),o===e&&(t.substr(hn,5)===ft?(o=ft,hn+=5):(o=e,0===mn&&Sn(st)),o===e&&(t.substr(hn,4)===lt?(o=lt,hn+=4):(o=e,0===mn&&Sn(pt)),o===e&&(t.substr(hn,6)===vt?(o=vt,hn+=6):(o=e,0===mn&&Sn(ht)),o===e&&(t.substr(hn,6)===yt?(o=yt,hn+=6):(o=e,0===mn&&Sn(dt)),o===e&&(t.substr(hn,5)===gt?(o=gt,hn+=5):(o=e,0===mn&&Sn(bt)))))))),o!==e?(yn=r,r=n=mt(o)):(hn=r,r=e)):(hn=r,r=e),mn--,r===e&&(n=e,0===mn&&Sn(ot)),r}function Dn(){var r,n;return r=hn,Wn()!==e?((n=function(){var r,n;return r=hn,t.substr(hn,4)===Mt?(n=Mt,hn+=4):(n=e,0===mn&&Sn(Dt)),n!==e&&(yn=r,n=Rt()),r=n}())===e&&(n=function(){var r,n;return r=hn,t.substr(hn,5)===_t?(n=_t,hn+=5):(n=e,0===mn&&Sn(Ot)),n!==e&&(yn=r,n=jt()),(r=n)===e&&(r=hn,t.substr(hn,2)===Ct?(n=Ct,hn+=2):(n=e,0===mn&&Sn(wt)),n!==e&&(yn=r,n=jt()),(r=n)===e&&(r=hn,t.substr(hn,3)===St?(n=St,hn+=3):(n=e,0===mn&&Sn(xt)),n!==e&&(yn=r,n=jt()),r=n)),r}())===e&&(n=function(){var r,n;return r=hn,t.substr(hn,4)===Pt?(n=Pt,hn+=4):(n=e,0===mn&&Sn(Et)),n!==e&&(yn=r,n=Tt()),(r=n)===e&&(r=hn,t.substr(hn,2)===kt?(n=kt,hn+=2):(n=e,0===mn&&Sn(Ft)),n!==e&&(yn=r,n=Tt()),(r=n)===e&&(r=hn,t.substr(hn,3)===Lt?(n=Lt,hn+=3):(n=e,0===mn&&Sn(zt)),n!==e&&(yn=r,n=Tt()),r=n)),r}())===e&&(n=function(){var r,n,o,i,u,a,c,f;if(mn++,r=hn,(n=function(){var r,n,o,i;return r=hn,(n=Wn())!==e?(91===t.charCodeAt(hn)?(o=$t,hn++):(o=e,0===mn&&Sn(qt)),o!==e&&(i=Hn())!==e?r=n=[n,o,i]:(hn=r,r=e)):(hn=r,r=e),r}())!==e){if(o=hn,(i=Dn())!==e){for(u=[],a=hn,(c=In())!==e&&(f=Dn())!==e?(yn=a,c=Gt(i,f),a=c):(hn=a,a=e);a!==e;)u.push(a),a=hn,(c=In())!==e&&(f=Dn())!==e?(yn=a,c=Gt(i,f),a=c):(hn=a,a=e);u!==e?(yn=o,i=Vt(i,u),o=i):(hn=o,o=e)}else hn=o,o=e;o===e&&(o=null),o!==e&&(i=function(){var r,n,o,i,u,a;return r=hn,(n=Hn())!==e?(44===t.charCodeAt(hn)?(o=V,hn++):(o=e,0===mn&&Sn(N)),o===e&&(o=null),o!==e&&(i=Hn())!==e?(93===t.charCodeAt(hn)?(u=Ut,hn++):(u=e,0===mn&&Sn(Ht)),u!==e&&(a=Wn())!==e?r=n=[n,o,i,u,a]:(hn=r,r=e)):(hn=r,r=e)):(hn=r,r=e),r}())!==e?(yn=r,n=Nt(o),r=n):(hn=r,r=e)}else hn=r,r=e;return mn--,r===e&&(n=e,0===mn&&Sn(Bt)),r}())===e&&(n=Rn())===e&&(n=function(){var t,r,n,o;if(mn++,t=hn,(r=$n())!==e){for(n=[],o=Nn();o!==e;)n.push(o),o=Nn();n!==e&&(o=$n())!==e?(yn=t,r=dr(n),t=r):(hn=t,t=e)}else hn=t,t=e;return mn--,t===e&&(r=e,0===mn&&Sn(yr)),t}()),n!==e&&Wn()!==e?(yn=r,r=At(n)):(hn=r,r=e)):(hn=r,r=e),r}function Rn(){var r,n;return r=hn,(n=function(){var r,n,o,i,u,a,c,f;if(r=hn,(n=Bn())!==e){for(o=[],i=hn,(u=Wn())!==e?(43===t.charCodeAt(hn)?(a=Wt,hn++):(a=e,0===mn&&Sn(Yt)),a===e&&(45===t.charCodeAt(hn)?(a=Jt,hn++):(a=e,0===mn&&Sn(Kt))),a!==e&&(c=Wn())!==e&&(f=Bn())!==e?i=u=[u,a,c,f]:(hn=i,i=e)):(hn=i,i=e);i!==e;)o.push(i),i=hn,(u=Wn())!==e?(43===t.charCodeAt(hn)?(a=Wt,hn++):(a=e,0===mn&&Sn(Yt)),a===e&&(45===t.charCodeAt(hn)?(a=Jt,hn++):(a=e,0===mn&&Sn(Kt))),a!==e&&(c=Wn())!==e&&(f=Bn())!==e?i=u=[u,a,c,f]:(hn=i,i=e)):(hn=i,i=e);o!==e?(yn=r,n=Qt(n,o),r=n):(hn=r,r=e)}else hn=r,r=e;return r}())!==e&&(yn=r,n=It(n)),r=n}function In(){var r,n,o,i;return r=hn,(n=Hn())!==e?(44===t.charCodeAt(hn)?(o=V,hn++):(o=e,0===mn&&Sn(N)),o!==e&&(i=Hn())!==e?r=n=[n,o,i]:(hn=r,r=e)):(hn=r,r=e),r}function Bn(){var r,n,o,i,u,a,c,f;if(r=hn,(n=Gn())!==e){for(o=[],i=hn,(u=Wn())!==e?(42===t.charCodeAt(hn)?(a=Xt,hn++):(a=e,0===mn&&Sn(Zt)),a===e&&(47===t.charCodeAt(hn)?(a=tr,hn++):(a=e,0===mn&&Sn(rr))),a!==e&&(c=Wn())!==e&&(f=Gn())!==e?i=u=[u,a,c,f]:(hn=i,i=e)):(hn=i,i=e);i!==e;)o.push(i),i=hn,(u=Wn())!==e?(42===t.charCodeAt(hn)?(a=Xt,hn++):(a=e,0===mn&&Sn(Zt)),a===e&&(47===t.charCodeAt(hn)?(a=tr,hn++):(a=e,0===mn&&Sn(rr))),a!==e&&(c=Wn())!==e&&(f=Gn())!==e?i=u=[u,a,c,f]:(hn=i,i=e)):(hn=i,i=e);o!==e?(yn=r,r=n=nr(n,o)):(hn=r,r=e)}else hn=r,r=e;return r}function Gn(){var r,n,o,i,u;return r=hn,40===t.charCodeAt(hn)?(n=B,hn++):(n=e,0===mn&&Sn(G)),n!==e&&(o=Wn())!==e&&(i=Rn())!==e&&Wn()!==e?(41===t.charCodeAt(hn)?(u=q,hn++):(u=e,0===mn&&Sn(U)),u!==e?(yn=r,r=n=er(i)):(hn=r,r=e)):(hn=r,r=e),r===e&&(r=function(){var r,n,o,i;return mn++,r=hn,(n=Vn())===e&&(n=null),n!==e&&function(){var r,n,o,i;if((r=function(){var r;return 48===t.charCodeAt(hn)?(r=vr,hn++):(r=e,0===mn&&Sn(hr)),r}())===e)if(r=hn,(n=function(){var r;return fr.test(t.charAt(hn))?(r=t.charAt(hn),hn++):(r=e,0===mn&&Sn(sr)),r}())!==e){for(o=[],i=Jn();i!==e;)o.push(i),i=Jn();o!==e?r=n=[n,o]:(hn=r,r=e)}else hn=r,r=e;return r}()!==e?((o=function(){var r,n,o,i;if(r=hn,(n=function(){var r;return 46===t.charCodeAt(hn)?(r=ar,hn++):(r=e,0===mn&&Sn(cr)),r}())!==e){if(o=[],(i=Jn())!==e)for(;i!==e;)o.push(i),i=Jn();else o=e;o!==e?r=n=[n,o]:(hn=r,r=e)}else hn=r,r=e;return r}())===e&&(o=null),o!==e?((i=function(){var r,n,o,i,u;if(r=hn,(n=function(){var r;return lr.test(t.charAt(hn))?(r=t.charAt(hn),hn++):(r=e,0===mn&&Sn(pr)),r}())!==e)if((o=Vn())===e&&(o=function(){var r;return 43===t.charCodeAt(hn)?(r=Wt,hn++):(r=e,0===mn&&Sn(Yt)),r}()),o===e&&(o=null),o!==e){if(i=[],(u=Jn())!==e)for(;u!==e;)i.push(u),u=Jn();else i=e;i!==e?r=n=[n,o,i]:(hn=r,r=e)}else hn=r,r=e;else hn=r,r=e;return r}())===e&&(i=null),i!==e?(yn=r,n=ur(),r=n):(hn=r,r=e)):(hn=r,r=e)):(hn=r,r=e),mn--,r===e&&(n=e,0===mn&&Sn(ir)),r}())===e&&(r=hn,(n=Vn())===e&&(n=null),n!==e&&(o=qn())!==e?(yn=r,r=n=or(n,o)):(hn=r,r=e)),r}function Vn(){var r;return 45===t.charCodeAt(hn)?(r=Jt,hn++):(r=e,0===mn&&Sn(Kt)),r}function Nn(){var r,n,o,i,u,a,c,f,s;return(r=function(){var r;return Gr.test(t.charAt(hn))?(r=t.charAt(hn),hn++):(r=e,0===mn&&Sn(Vr)),r}())===e&&(r=hn,function(){var r;return 92===t.charCodeAt(hn)?(r=mr,hn++):(r=e,0===mn&&Sn(Ar)),r}()!==e?(34===t.charCodeAt(hn)?(n=gr,hn++):(n=e,0===mn&&Sn(br)),n===e&&(92===t.charCodeAt(hn)?(n=mr,hn++):(n=e,0===mn&&Sn(Ar)),n===e&&(47===t.charCodeAt(hn)?(n=tr,hn++):(n=e,0===mn&&Sn(rr)),n===e&&(n=hn,98===t.charCodeAt(hn)?(o=_r,hn++):(o=e,0===mn&&Sn(Or)),o!==e&&(yn=n,o=jr()),(n=o)===e&&(n=hn,102===t.charCodeAt(hn)?(o=Cr,hn++):(o=e,0===mn&&Sn(wr)),o!==e&&(yn=n,o=Sr()),(n=o)===e&&(n=hn,110===t.charCodeAt(hn)?(o=xr,hn++):(o=e,0===mn&&Sn(Pr)),o!==e&&(yn=n,o=Er()),(n=o)===e&&(n=hn,114===t.charCodeAt(hn)?(o=Tr,hn++):(o=e,0===mn&&Sn(kr)),o!==e&&(yn=n,o=Fr()),(n=o)===e&&(n=hn,116===t.charCodeAt(hn)?(o=Lr,hn++):(o=e,0===mn&&Sn(zr)),o!==e&&(yn=n,o=Mr()),(n=o)===e&&(n=hn,117===t.charCodeAt(hn)?(o=Dr,hn++):(o=e,0===mn&&Sn(Rr)),o!==e?(i=hn,u=hn,(a=Kn())!==e&&(c=Kn())!==e&&(f=Kn())!==e&&(s=Kn())!==e?u=a=[a,c,f,s]:(hn=u,u=e),(i=u!==e?t.substring(i,hn):u)!==e?(yn=n,n=o=Ir(i)):(hn=n,n=e)):(hn=n,n=e))))))))),n!==e?(yn=r,r=Br(n)):(hn=r,r=e)):(hn=r,r=e)),r}function $n(){var r;return 34===t.charCodeAt(hn)?(r=gr,hn++):(r=e,0===mn&&Sn(br)),r}function qn(){var r,n,o,i,u,a,c,f,s,l;if(r=hn,Nr.test(t.charAt(hn))?(n=t.charAt(hn),hn++):(n=e,0===mn&&Sn($r)),n!==e){if(o=[],i=hn,46===t.charCodeAt(hn)?(u=ar,hn++):(u=e,0===mn&&Sn(cr)),u===e&&(u=null),u!==e)if((a=Un())!==e){if(c=hn,46===t.charCodeAt(hn)?(f=ar,hn++):(f=e,0===mn&&Sn(cr)),f!==e){if(s=[],(l=Un())!==e)for(;l!==e;)s.push(l),l=Un();else s=e;s!==e?(yn=c,c=f=qr(n)):(hn=c,c=e)}else hn=c,c=e;c===e&&(c=null),c!==e?i=u=[u,a,c]:(hn=i,i=e)}else hn=i,i=e;else hn=i,i=e;for(;i!==e;)if(o.push(i),i=hn,46===t.charCodeAt(hn)?(u=ar,hn++):(u=e,0===mn&&Sn(cr)),u===e&&(u=null),u!==e)if((a=Un())!==e){if(c=hn,46===t.charCodeAt(hn)?(f=ar,hn++):(f=e,0===mn&&Sn(cr)),f!==e){if(s=[],(l=Un())!==e)for(;l!==e;)s.push(l),l=Un();else s=e;s!==e?(yn=c,c=f=qr(n)):(hn=c,c=e)}else hn=c,c=e;c===e&&(c=null),c!==e?i=u=[u,a,c]:(hn=i,i=e)}else hn=i,i=e;else hn=i,i=e;o!==e?(yn=r,r=n=Ur(n,o)):(hn=r,r=e)}else hn=r,r=e;return r}function Un(){var r;return Hr.test(t.charAt(hn))?(r=t.charAt(hn),hn++):(r=e,0===mn&&Sn(Wr)),r}function Hn(){var r,n;for(mn++,r=[],Jr.test(t.charAt(hn))?(n=t.charAt(hn),hn++):(n=e,0===mn&&Sn(Kr));n!==e;)r.push(n),Jr.test(t.charAt(hn))?(n=t.charAt(hn),hn++):(n=e,0===mn&&Sn(Kr));return mn--,r===e&&(n=e,0===mn&&Sn(Yr)),r}function Wn(){var r,n;for(mn++,r=[],Xr.test(t.charAt(hn))?(n=t.charAt(hn),hn++):(n=e,0===mn&&Sn(Zr));n!==e;)r.push(n),Xr.test(t.charAt(hn))?(n=t.charAt(hn),hn++):(n=e,0===mn&&Sn(Zr));return mn--,r===e&&(n=e,0===mn&&Sn(Qr)),r}function Yn(){var r,n,o;return mn++,r=hn,(n=Wn())!==e?(10===t.charCodeAt(hn)?(o=rn,hn++):(o=e,0===mn&&Sn(nn)),o!==e?r=n=[n,o]:(hn=r,r=e)):(hn=r,r=e),r===e&&(r=hn,(n=Wn())!==e?(t.substr(hn,2)===en?(o=en,hn+=2):(o=e,0===mn&&Sn(on)),o!==e?r=n=[n,o]:(hn=r,r=e)):(hn=r,r=e),r===e&&(r=hn,(n=Wn())!==e?(13===t.charCodeAt(hn)?(o=un,hn++):(o=e,0===mn&&Sn(an)),o!==e?r=n=[n,o]:(hn=r,r=e)):(hn=r,r=e),r===e&&(r=hn,(n=Wn())!==e?(12===t.charCodeAt(hn)?(o=cn,hn++):(o=e,0===mn&&Sn(fn)),o!==e?r=n=[n,o]:(hn=r,r=e)):(hn=r,r=e)))),mn--,r===e&&(n=e,0===mn&&Sn(tn)),r}function Jn(){var r;return sn.test(t.charAt(hn))?(r=t.charAt(hn),hn++):(r=e,0===mn&&Sn(ln)),r}function Kn(){var r;return pn.test(t.charAt(hn))?(r=t.charAt(hn),hn++):(r=e,0===mn&&Sn(vn)),r}var Qn,Xn,Zn,te=r.ctx;function re(t){return t.filter(function(t){return Boolean(t)})}function ne(t,r){t.annotations||(t.annotations=[]),t.annotations.push(r)}if((n=i())!==e&&hn===t.length)return n;throw n!==e&&hn<t.length&&Sn({type:"end"}),Qn=bn,Xn=gn<t.length?t.charAt(gn):null,Zn=gn<t.length?wn(gn,gn+1):wn(gn,gn),new ve(ve.buildMessage(Qn,Xn),Qn,Xn,Zn)};!function(t,r){var n=(A.Object||{})[t]||Object[t],e={};e[t]=r(n),U(U.S+U.F*u(function(){n(1)}),"Object",e)}("keys",function(){return function(t){return ot(gt(t))}});var ye=Bt(1);U(U.P+U.F*!Gt([].map,!0),"Array",{map:function(t){return ye(this,t,arguments[1])}});var de=function(t){for(var r=-1,n=null==t?0:t.length,e=0,o=[];++r<n;){var i=t[r];i&&(o[e++]=i)}return o},ge=Bt(5),be=!0;"find"in[]&&Array(1).find(function(){be=!1}),U(U.P+U.F*be,"Array",{find:function(t){return ge(this,t,arguments.length>1?arguments[1]:void 0)}}),T("find");var me,Ae=function(t,r,n){if(t){var e=t.find(function(t){var n=t.type,e=t.name;return"propertyCall"===n&&e===r});return void 0!==e&&n&&n(e),e}},_e=function(t,r){return Boolean(Ae(t,r))},Oe=function(t,r){return n.get(Ae(t,r),"args[0]")},je=function(t,r,e,o){return Ae(e,o||r,function(e){t[r]=n.get(e,"args[0]")})},Ce=function(t,r){return null==t?r:!t.args||1!==t.args.length||Boolean(t.args[0])},we=function(t,r,n){var e=Ae(r,n);void 0!==e&&(t[n]=Ce(e))},Se=function(t,r,n){return t&&t.find(function(t){var e=t.name,o=t.value,i=e===r;return i&&n&&n(o),i})},xe=function(t,r,n){return Se(t,n,function(t){r[n]=t})},Pe=function(t,r,n){return t&&t.find(function(t){var e=t.name===r;return e&&n&&n(t),e})},Ee=function(t,r,n){return Pe(r,n,function(r){var e=r.value;return Object.assign(t,Jt({},n,e))})},Te=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return r.reduce(function(r,n){if("function"==typeof n){var e=n(t);return void 0!==e?e:r}return n&&t in n?n[t]:r},n)}},ke=function(t,r,n,e){return r.forEach(function(r){var o=n(r);e&&"string"==typeof o&&(o=e(o)),void 0!==o&&(t[r]=o)}),t},Fe=Object.freeze({create:function(t){var r=t.declaration,n=t.ctx,o=t.options,i="instantiates"===r.verb?n.create(r.subject):void 0,u=r.voDescriptor,a=o||u.proto;return new e.VODescriptor(function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},e=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.forEach(function(r){Jt(t,r,n[r])})}return t}({},u,{instanceOf:i,proto:"string"==typeof a?n.readOption(a):a}))},transform:function(t){var r,n={},e={},o=(r=n,function(t,n){void 0!==n&&(Array.isArray(n)?n.forEach(function(n,e){r["".concat(t).concat(e)]=n}):r[t]=n)}),i={voDescriptor:{vertexCount:Oe(t.data,"vertexCount"),attributes:de(t.data.filter(function(t){var r=t.type;return"data"===r||"dataBlock"===r}).map(function(t){var r=Ae(t.annotations,"alias");if(r&&r.args&&"string"==typeof r.args[0])return e[t.name]=r.args[0],null;var n={name:t.name};return"data"===t.type?(n.type=t.valueType||"float32",Se(t.args,"size",function(t){n.size=t})):"dataBlock"===t.type&&(n.type=t.dataType||"float32",n.scalars=t.data.filter(function(t){return"data"===t.type}).map(function(t){var r=t.name,n=t.value;return o(r,n),r}),n.size=n.scalars.length),_e(t.annotations,"uniform")&&(n.uniform=!0),o(t.name,t.value),r?(Se(t.args,"offset",function(t){n.offset=t}),e[t.name]=n,null):n}))}};return Object.keys(e).length&&(i.voDescriptor.aliases=e),Object.keys(n).length&&(i.voNew=n),Ae(t.data,"prototype",function(t){var r=t.args;i.voDescriptor.proto=r[0]}),i}}),Le=Object.freeze({create:function(t){var r=t.declaration,n=t.options;if(r.generate)return new e.IndexedPrimitive(r.primitiveType,e.ElementIndexArray.Generate(n.capacity,r.indices,r.stride,r.offset));console.warn("TODO implementation: Primitive with(out) @generate(no)")},transform:function(t){var r=t.data,n={primitiveType:Oe(r,"type")};return _e(r,"generate")&&(n.generate=!0),["stride","offset","indices"].forEach(Ee.bind(null,n,r)),n}}),ze=function(t){var r={};return Ae(t,"dynamic",function(t){r.usage=Ce(t,!0)?"dynamic":"static"}),we(r,t,"doubleBuffer"),we(r,t,"autotouch"),we(r,t,"textured"),je(r,"setSize",t),je(r,"setTexCoordsByTexture",t),je(r,"prototype",t),Ee(r,t,"capacity"),Ee(r,t,"maxAllocVOSize"),Pe(t,"textures",function(t){if(t&&"dataBlock"===t.type){var n={};r.textureMap=n,t.data.forEach(function(t){var r=t.name,e=t.value,o=t.annotations,i=t.args,u={};n[r]={hints:u,src:e,type:_e(o,"atlas")?"atlas":"texture"},xe(i,u,"flipY"),xe(i,u,"repeatable"),xe(i,u,"premultiplyAlpha"),xe(i,u,"nearest")})}}),r},Me=Object.freeze({create:function(t){var r=t.ctx,n=t.declaration,o=t.options,i=void 0===o?{}:o,u=n.voDescriptor,a=i[u],c=n[u],f=r.readOption.bind(r),s=ke({},["autotouch","capacity","doubleBuffer","maxAllocVOSize","usage"],Te(n,c,i,a));ke(s,["setSize","setTexCoordsByTexture"],Te(n,c,i,a),Te(f,i,a)),s.primitive=function(t,r,n){switch(Wt(r)){case"string":return t.create(r,{capacity:n});default:return r}}(r,n.primitive,s.capacity),ke(s,["vertexShader","fragmentShader","shaderProgram"],Te(n,i),Te(f));var l=ke({},["prototype"],Te(c,a),Te(f,i)).prototype,p=r.create(u,l);return new e.SpriteGroup(p,s)},transform:function(t){var r=t.data,n=Oe(r,"vertexObject"),e={voDescriptor:n,primitive:Oe(r,"primitive")};return je(e,"vertexShader",r),je(e,"fragmentShader",r),je(e,"shaderProgram",r),Object.assign(e,ze(r)),n&&Pe(r,n,function(t){Object.assign(e,Jt({},n,ze(t.data)))}),e}}),De=(Jt(me={},"vertexobject",Fe),Jt(me,"primitive",Le),Jt(me,"spritegroup",Me),me),Re=r.getLogger("picimo.toolkit.Context"),Ie=function(t){var r=De[t];return t||Re.error("Context: unknown declaration type:",t),r},Be=n.pick(["declarationType","verb","subject"]),Ge=function(){function t(r){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.config=Object.assign({},r),this.declaration={}}var r,e,o;return r=t,(e=[{key:"hasOption",value:function(t){return Yn(this.config,t)}},{key:"readOption",value:function(t){return n.get(this.config,t)}},{key:"writeOption",value:function(t,r){te(this.config,t,r)}},{key:"configure",value:function(t){return Object.assign(this.config,t),this}},{key:"compile",value:function(t,r){var n=this;return r&&this.configure(r),he(t,{ctx:this}).forEach(function(t){"declaration"===t.type&&te(n.declaration,t.name,Object.assign(function(t){var r=Ie(t.declarationType);return r?r.transform(t):t}(t),Be(t)))}),this}},{key:"create",value:function(t,r){return function(t,r,e){var o=n.get(t.declaration,r);if(o){var i=Ie(o.declarationType);return i?i.create({ctx:t,name:r,declaration:o,options:e}):null}}(this,t,r)}}])&&Yt(r.prototype,e),o&&Yt(r,o),t}();t.compile=function(t,r){return new Ge(r).compile(t)},t.configure=function(t){return new Ge(t)},t.Context=Ge,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=picimo-toolkit.js.map
