import{getLogger}from"loglevel";import{get,pick}from"@picimo/utils";import{VODescriptor,IndexedPrimitive,ElementIndexArray,SpriteGroup}from"@picimo/core";var _isObject=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_anObject=function(t){if(!_isObject(t))throw TypeError(t+" is not an object!");return t},_fails=function(t){try{return!!t()}catch(t){return!0}},_descriptors=!_fails(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var _global=createCommonjsModule(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),document=_global.document,is=_isObject(document)&&_isObject(document.createElement),_domCreate=function(t){return is?document.createElement(t):{}},_ie8DomDefine=!_descriptors&&!_fails(function(){return 7!=Object.defineProperty(_domCreate("div"),"a",{get:function(){return 7}}).a}),_toPrimitive=function(t,e){if(!_isObject(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!_isObject(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!_isObject(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!_isObject(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")},dP=Object.defineProperty,f=_descriptors?Object.defineProperty:function(t,e,r){if(_anObject(t),e=_toPrimitive(e,!0),_anObject(r),_ie8DomDefine)try{return dP(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t},_objectDp={f:f},dP$1=_objectDp.f,FProto=Function.prototype,nameRE=/^\s*function ([^ (]*)/,NAME="name";NAME in FProto||_descriptors&&dP$1(FProto,NAME,{configurable:!0,get:function(){try{return(""+this).match(nameRE)[1]}catch(t){return""}}});var _core=createCommonjsModule(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),_core_1=_core.version,_library=!1,_shared=createCommonjsModule(function(t){var e=_global["__core-js_shared__"]||(_global["__core-js_shared__"]={});(t.exports=function(t,r){return e[t]||(e[t]=void 0!==r?r:{})})("versions",[]).push({version:_core.version,mode:_library?"pure":"global",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})}),id=0,px=Math.random(),_uid=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++id+px).toString(36))},_wks=createCommonjsModule(function(t){var e=_shared("wks"),r=_global.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:_uid)("Symbol."+t))}).store=e}),_propertyDesc=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},_hide=_descriptors?function(t,e,r){return _objectDp.f(t,e,_propertyDesc(1,r))}:function(t,e,r){return t[e]=r,t},UNSCOPABLES=_wks("unscopables"),ArrayProto=Array.prototype;null==ArrayProto[UNSCOPABLES]&&_hide(ArrayProto,UNSCOPABLES,{});var _addToUnscopables=function(t){ArrayProto[UNSCOPABLES][t]=!0},_iterStep=function(t,e){return{value:e,done:!!t}},_iterators={},toString={}.toString,_cof=function(t){return toString.call(t).slice(8,-1)},_iobject=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==_cof(t)?t.split(""):Object(t)},_defined=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},_toIobject=function(t){return _iobject(_defined(t))},hasOwnProperty={}.hasOwnProperty,_has=function(t,e){return hasOwnProperty.call(t,e)},_redefine=createCommonjsModule(function(t){var e=_uid("src"),r=Function.toString,n=(""+r).split("toString");_core.inspectSource=function(t){return r.call(t)},(t.exports=function(t,r,o,a){var i="function"==typeof o;i&&(_has(o,"name")||_hide(o,"name",r)),t[r]!==o&&(i&&(_has(o,e)||_hide(o,e,t[r]?""+t[r]:n.join(String(r)))),t===_global?t[r]=o:a?t[r]?t[r]=o:_hide(t,r,o):(delete t[r],_hide(t,r,o)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||r.call(this)})}),_aFunction=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t},_ctx=function(t,e,r){if(_aFunction(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}},PROTOTYPE="prototype",$export=function(t,e,r){var n,o,a,i,c=t&$export.F,s=t&$export.G,u=t&$export.S,l=t&$export.P,f=t&$export.B,p=s?_global:u?_global[e]||(_global[e]={}):(_global[e]||{})[PROTOTYPE],_=s?_core:_core[e]||(_core[e]={}),h=_[PROTOTYPE]||(_[PROTOTYPE]={});for(n in s&&(r=e),r)a=((o=!c&&p&&void 0!==p[n])?p:r)[n],i=f&&o?_ctx(a,_global):l&&"function"==typeof a?_ctx(Function.call,a):a,p&&_redefine(p,n,a,t&$export.U),_[n]!=a&&_hide(_,n,i),l&&h[n]!=a&&(h[n]=a)};_global.core=_core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var _export=$export,ceil=Math.ceil,floor=Math.floor,_toInteger=function(t){return isNaN(t=+t)?0:(t>0?floor:ceil)(t)},min=Math.min,_toLength=function(t){return t>0?min(_toInteger(t),9007199254740991):0},max=Math.max,min$1=Math.min,_toAbsoluteIndex=function(t,e){return(t=_toInteger(t))<0?max(t+e,0):min$1(t,e)},_arrayIncludes=function(t){return function(e,r,n){var o,a=_toIobject(e),i=_toLength(a.length),c=_toAbsoluteIndex(n,i);if(t&&r!=r){for(;i>c;)if((o=a[c++])!=o)return!0}else for(;i>c;c++)if((t||c in a)&&a[c]===r)return t||c||0;return!t&&-1}},shared=_shared("keys"),_sharedKey=function(t){return shared[t]||(shared[t]=_uid(t))},arrayIndexOf=_arrayIncludes(!1),IE_PROTO=_sharedKey("IE_PROTO"),_objectKeysInternal=function(t,e){var r,n=_toIobject(t),o=0,a=[];for(r in n)r!=IE_PROTO&&_has(n,r)&&a.push(r);for(;e.length>o;)_has(n,r=e[o++])&&(~arrayIndexOf(a,r)||a.push(r));return a},_enumBugKeys="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),_objectKeys=Object.keys||function(t){return _objectKeysInternal(t,_enumBugKeys)},_objectDps=_descriptors?Object.defineProperties:function(t,e){_anObject(t);for(var r,n=_objectKeys(e),o=n.length,a=0;o>a;)_objectDp.f(t,r=n[a++],e[r]);return t},document$1=_global.document,_html=document$1&&document$1.documentElement,IE_PROTO$1=_sharedKey("IE_PROTO"),Empty=function(){},PROTOTYPE$1="prototype",createDict=function(){var t,e=_domCreate("iframe"),r=_enumBugKeys.length;for(e.style.display="none",_html.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),createDict=t.F;r--;)delete createDict[PROTOTYPE$1][_enumBugKeys[r]];return createDict()},_objectCreate=Object.create||function(t,e){var r;return null!==t?(Empty[PROTOTYPE$1]=_anObject(t),r=new Empty,Empty[PROTOTYPE$1]=null,r[IE_PROTO$1]=t):r=createDict(),void 0===e?r:_objectDps(r,e)},def=_objectDp.f,TAG=_wks("toStringTag"),_setToStringTag=function(t,e,r){t&&!_has(t=r?t:t.prototype,TAG)&&def(t,TAG,{configurable:!0,value:e})},IteratorPrototype={};_hide(IteratorPrototype,_wks("iterator"),function(){return this});var _iterCreate=function(t,e,r){t.prototype=_objectCreate(IteratorPrototype,{next:_propertyDesc(1,r)}),_setToStringTag(t,e+" Iterator")},_toObject=function(t){return Object(_defined(t))},IE_PROTO$2=_sharedKey("IE_PROTO"),ObjectProto=Object.prototype,_objectGpo=Object.getPrototypeOf||function(t){return t=_toObject(t),_has(t,IE_PROTO$2)?t[IE_PROTO$2]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ObjectProto:null},ITERATOR=_wks("iterator"),BUGGY=!([].keys&&"next"in[].keys()),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values",returnThis=function(){return this},_iterDefine=function(t,e,r,n,o,a,i){_iterCreate(r,e,n);var c,s,u,l=function(t){if(!BUGGY&&t in h)return h[t];switch(t){case KEYS:case VALUES:return function(){return new r(this,t)}}return function(){return new r(this,t)}},f=e+" Iterator",p=o==VALUES,_=!1,h=t.prototype,y=h[ITERATOR]||h[FF_ITERATOR]||o&&h[o],d=y||l(o),g=o?p?l("entries"):d:void 0,v="Array"==e&&h.entries||y;if(v&&(u=_objectGpo(v.call(new t)))!==Object.prototype&&u.next&&(_setToStringTag(u,f,!0),"function"!=typeof u[ITERATOR]&&_hide(u,ITERATOR,returnThis)),p&&y&&y.name!==VALUES&&(_=!0,d=function(){return y.call(this)}),(BUGGY||_||!h[ITERATOR])&&_hide(h,ITERATOR,d),_iterators[e]=d,_iterators[f]=returnThis,o)if(c={values:p?d:l(VALUES),keys:a?d:l(KEYS),entries:g},i)for(s in c)s in h||_redefine(h,s,c[s]);else _export(_export.P+_export.F*(BUGGY||_),e,c);return c},es6_array_iterator=_iterDefine(Array,"Array",function(t,e){this._t=_toIobject(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,_iterStep(1)):_iterStep(0,"keys"==e?r:"values"==e?t[r]:[r,t[r]])},"values");_iterators.Arguments=_iterators.Array,_addToUnscopables("keys"),_addToUnscopables("values"),_addToUnscopables("entries");for(var ITERATOR$1=_wks("iterator"),TO_STRING_TAG=_wks("toStringTag"),ArrayValues=_iterators.Array,DOMIterables={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},collections=_objectKeys(DOMIterables),i=0;i<collections.length;i++){var key,NAME$1=collections[i],explicit=DOMIterables[NAME$1],Collection=_global[NAME$1],proto=Collection&&Collection.prototype;if(proto&&(proto[ITERATOR$1]||_hide(proto,ITERATOR$1,ArrayValues),proto[TO_STRING_TAG]||_hide(proto,TO_STRING_TAG,NAME$1),_iterators[NAME$1]=ArrayValues,explicit))for(key in es6_array_iterator)proto[key]||_redefine(proto,key,es6_array_iterator[key],!0)}var _isArray=Array.isArray||function(t){return"Array"==_cof(t)},SPECIES=_wks("species"),_arraySpeciesConstructor=function(t){var e;return _isArray(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!_isArray(e.prototype)||(e=void 0),_isObject(e)&&null===(e=e[SPECIES])&&(e=void 0)),void 0===e?Array:e},_arraySpeciesCreate=function(t,e){return new(_arraySpeciesConstructor(t))(e)},_arrayMethods=function(t,e){var r=1==t,n=2==t,o=3==t,a=4==t,i=6==t,c=5==t||i,s=e||_arraySpeciesCreate;return function(e,u,l){for(var f,p,_=_toObject(e),h=_iobject(_),y=_ctx(u,l,3),d=_toLength(h.length),g=0,v=r?s(e,d):n?s(e,0):void 0;d>g;g++)if((c||g in h)&&(p=y(f=h[g],g,_),t))if(r)v[g]=p;else if(p)switch(t){case 3:return!0;case 5:return f;case 6:return g;case 2:v.push(f)}else if(a)return!1;return i?-1:o||a?a:v}},_strictMethod=function(t,e){return!!t&&_fails(function(){e?t.call(null,function(){},1):t.call(null)})},$forEach=_arrayMethods(0),STRICT=_strictMethod([].forEach,!0);_export(_export.P+_export.F*!STRICT,"Array",{forEach:function(t){return $forEach(this,t,arguments[1])}});var f$1=Object.getOwnPropertySymbols,_objectGops={f:f$1},f$2={}.propertyIsEnumerable,_objectPie={f:f$2},$assign=Object.assign,_objectAssign=!$assign||_fails(function(){var t={},e={},r=Symbol(),n="abcdefghijklmnopqrst";return t[r]=7,n.split("").forEach(function(t){e[t]=t}),7!=$assign({},t)[r]||Object.keys($assign({},e)).join("")!=n})?function(t,e){for(var r=_toObject(t),n=arguments.length,o=1,a=_objectGops.f,i=_objectPie.f;n>o;)for(var c,s=_iobject(arguments[o++]),u=a?_objectKeys(s).concat(a(s)):_objectKeys(s),l=u.length,f=0;l>f;)i.call(s,c=u[f++])&&(r[c]=s[c]);return r}:$assign;function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}_export(_export.S+_export.F,"Object",{assign:_objectAssign});var objectProto=Object.prototype,hasOwnProperty$1=objectProto.hasOwnProperty;function baseHas(t,e){return null!=t&&hasOwnProperty$1.call(t,e)}var _baseHas=baseHas,isArray=Array.isArray,isArray_1=isArray,freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=_freeGlobal||freeSelf||Function("return this")(),_root=root,Symbol$1=_root.Symbol,_Symbol=Symbol$1,objectProto$1=Object.prototype,hasOwnProperty$2=objectProto$1.hasOwnProperty,nativeObjectToString=objectProto$1.toString,symToStringTag=_Symbol?_Symbol.toStringTag:void 0;function getRawTag(t){var e=hasOwnProperty$2.call(t,symToStringTag),r=t[symToStringTag];try{t[symToStringTag]=void 0}catch(t){}var n=nativeObjectToString.call(t);return e?t[symToStringTag]=r:delete t[symToStringTag],n}var _getRawTag=getRawTag,objectProto$2=Object.prototype,nativeObjectToString$1=objectProto$2.toString;function objectToString(t){return nativeObjectToString$1.call(t)}var _objectToString=objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=_Symbol?_Symbol.toStringTag:void 0;function baseGetTag(t){return null==t?void 0===t?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(t)?_getRawTag(t):_objectToString(t)}var _baseGetTag=baseGetTag;function isObjectLike(t){return null!=t&&"object"==typeof t}var isObjectLike_1=isObjectLike,symbolTag="[object Symbol]";function isSymbol(t){return"symbol"==typeof t||isObjectLike_1(t)&&_baseGetTag(t)==symbolTag}var isSymbol_1=isSymbol,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(t,e){if(isArray_1(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!isSymbol_1(t))||(reIsPlainProp.test(t)||!reIsDeepProp.test(t)||null!=e&&t in Object(e))}var _isKey=isKey;function isObject(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var isObject_1=isObject,asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(t){if(!isObject_1(t))return!1;var e=_baseGetTag(t);return e==funcTag||e==genTag||e==asyncTag||e==proxyTag}var isFunction_1=isFunction,coreJsData=_root["__core-js_shared__"],_coreJsData=coreJsData,maskSrcKey=function(){var t=/[^.]+$/.exec(_coreJsData&&_coreJsData.keys&&_coreJsData.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function isMasked(t){return!!maskSrcKey&&maskSrcKey in t}var _isMasked=isMasked,funcProto=Function.prototype,funcToString=funcProto.toString;function toSource(t){if(null!=t){try{return funcToString.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var _toSource=toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$3=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$3=objectProto$3.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$3).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(t){return!(!isObject_1(t)||_isMasked(t))&&(isFunction_1(t)?reIsNative:reIsHostCtor).test(_toSource(t))}var _baseIsNative=baseIsNative;function getValue(t,e){return null==t?void 0:t[e]}var _getValue=getValue;function getNative(t,e){var r=_getValue(t,e);return _baseIsNative(r)?r:void 0}var _getNative=getNative,nativeCreate=_getNative(Object,"create"),_nativeCreate=nativeCreate;function hashClear(){this.__data__=_nativeCreate?_nativeCreate(null):{},this.size=0}var _hashClear=hashClear;function hashDelete(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var _hashDelete=hashDelete,HASH_UNDEFINED="__lodash_hash_undefined__",objectProto$4=Object.prototype,hasOwnProperty$4=objectProto$4.hasOwnProperty;function hashGet(t){var e=this.__data__;if(_nativeCreate){var r=e[t];return r===HASH_UNDEFINED?void 0:r}return hasOwnProperty$4.call(e,t)?e[t]:void 0}var _hashGet=hashGet,objectProto$5=Object.prototype,hasOwnProperty$5=objectProto$5.hasOwnProperty;function hashHas(t){var e=this.__data__;return _nativeCreate?void 0!==e[t]:hasOwnProperty$5.call(e,t)}var _hashHas=hashHas,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=_nativeCreate&&void 0===e?HASH_UNDEFINED$1:e,this}var _hashSet=hashSet;function Hash(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Hash.prototype.clear=_hashClear,Hash.prototype.delete=_hashDelete,Hash.prototype.get=_hashGet,Hash.prototype.has=_hashHas,Hash.prototype.set=_hashSet;var _Hash=Hash;function listCacheClear(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear;function eq(t,e){return t===e||t!=t&&e!=e}var eq_1=eq;function assocIndexOf(t,e){for(var r=t.length;r--;)if(eq_1(t[r][0],e))return r;return-1}var _assocIndexOf=assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(t){var e=this.__data__,r=_assocIndexOf(e,t);return!(r<0)&&(r==e.length-1?e.pop():splice.call(e,r,1),--this.size,!0)}var _listCacheDelete=listCacheDelete;function listCacheGet(t){var e=this.__data__,r=_assocIndexOf(e,t);return r<0?void 0:e[r][1]}var _listCacheGet=listCacheGet;function listCacheHas(t){return _assocIndexOf(this.__data__,t)>-1}var _listCacheHas=listCacheHas;function listCacheSet(t,e){var r=this.__data__,n=_assocIndexOf(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}var _listCacheSet=listCacheSet;function ListCache(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ListCache.prototype.clear=_listCacheClear,ListCache.prototype.delete=_listCacheDelete,ListCache.prototype.get=_listCacheGet,ListCache.prototype.has=_listCacheHas,ListCache.prototype.set=_listCacheSet;var _ListCache=ListCache,Map$1=_getNative(_root,"Map"),_Map=Map$1;function mapCacheClear(){this.size=0,this.__data__={hash:new _Hash,map:new(_Map||_ListCache),string:new _Hash}}var _mapCacheClear=mapCacheClear;function isKeyable(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}var _isKeyable=isKeyable;function getMapData(t,e){var r=t.__data__;return _isKeyable(e)?r["string"==typeof e?"string":"hash"]:r.map}var _getMapData=getMapData;function mapCacheDelete(t){var e=_getMapData(this,t).delete(t);return this.size-=e?1:0,e}var _mapCacheDelete=mapCacheDelete;function mapCacheGet(t){return _getMapData(this,t).get(t)}var _mapCacheGet=mapCacheGet;function mapCacheHas(t){return _getMapData(this,t).has(t)}var _mapCacheHas=mapCacheHas;function mapCacheSet(t,e){var r=_getMapData(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet;function MapCache(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}MapCache.prototype.clear=_mapCacheClear,MapCache.prototype.delete=_mapCacheDelete,MapCache.prototype.get=_mapCacheGet,MapCache.prototype.has=_mapCacheHas,MapCache.prototype.set=_mapCacheSet;var _MapCache=MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=t.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(memoize.Cache||_MapCache),r}memoize.Cache=_MapCache;var memoize_1=memoize,MAX_MEMOIZE_SIZE=500;function memoizeCapped(t){var e=memoize_1(t,function(t){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),t}),r=e.cache;return e}var _memoizeCapped=memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=_memoizeCapped(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rePropName,function(t,r,n,o){e.push(n?o.replace(reEscapeChar,"$1"):r||t)}),e}),_stringToPath=stringToPath;function arrayMap(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var _arrayMap=arrayMap,INFINITY=1/0,symbolProto=_Symbol?_Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString(t){if("string"==typeof t)return t;if(isArray_1(t))return _arrayMap(t,baseToString)+"";if(isSymbol_1(t))return symbolToString?symbolToString.call(t):"";var e=t+"";return"0"==e&&1/t==-INFINITY?"-0":e}var _baseToString=baseToString;function toString$1(t){return null==t?"":_baseToString(t)}var toString_1=toString$1;function castPath(t,e){return isArray_1(t)?t:_isKey(t,e)?[t]:_stringToPath(toString_1(t))}var _castPath=castPath,argsTag="[object Arguments]";function baseIsArguments(t){return isObjectLike_1(t)&&_baseGetTag(t)==argsTag}var _baseIsArguments=baseIsArguments,objectProto$6=Object.prototype,hasOwnProperty$6=objectProto$6.hasOwnProperty,propertyIsEnumerable=objectProto$6.propertyIsEnumerable,isArguments=_baseIsArguments(function(){return arguments}())?_baseIsArguments:function(t){return isObjectLike_1(t)&&hasOwnProperty$6.call(t,"callee")&&!propertyIsEnumerable.call(t,"callee")},isArguments_1=isArguments,MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(t,e){var r=typeof t;return!!(e=null==e?MAX_SAFE_INTEGER:e)&&("number"==r||"symbol"!=r&&reIsUint.test(t))&&t>-1&&t%1==0&&t<e}var _isIndex=isIndex,MAX_SAFE_INTEGER$1=9007199254740991;function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=MAX_SAFE_INTEGER$1}var isLength_1=isLength,INFINITY$1=1/0;function toKey(t){if("string"==typeof t||isSymbol_1(t))return t;var e=t+"";return"0"==e&&1/t==-INFINITY$1?"-0":e}var _toKey=toKey;function hasPath(t,e,r){for(var n=-1,o=(e=_castPath(e,t)).length,a=!1;++n<o;){var i=_toKey(e[n]);if(!(a=null!=t&&r(t,i)))break;t=t[i]}return a||++n!=o?a:!!(o=null==t?0:t.length)&&isLength_1(o)&&_isIndex(i,o)&&(isArray_1(t)||isArguments_1(t))}var _hasPath=hasPath;function has(t,e){return null!=t&&_hasPath(t,e,_baseHas)}var has_1=has,defineProperty=function(){try{var t=_getNative(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),_defineProperty$1=defineProperty;function baseAssignValue(t,e,r){"__proto__"==e&&_defineProperty$1?_defineProperty$1(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var _baseAssignValue=baseAssignValue,objectProto$7=Object.prototype,hasOwnProperty$7=objectProto$7.hasOwnProperty;function assignValue(t,e,r){var n=t[e];hasOwnProperty$7.call(t,e)&&eq_1(n,r)&&(void 0!==r||e in t)||_baseAssignValue(t,e,r)}var _assignValue=assignValue;function baseSet(t,e,r,n){if(!isObject_1(t))return t;for(var o=-1,a=(e=_castPath(e,t)).length,i=a-1,c=t;null!=c&&++o<a;){var s=_toKey(e[o]),u=r;if(o!=i){var l=c[s];void 0===(u=n?n(l,s,c):void 0)&&(u=isObject_1(l)?l:_isIndex(e[o+1])?[]:{})}_assignValue(c,s,u),c=c[s]}return t}var _baseSet=baseSet;function set$1(t,e,r){return null==t?t:_baseSet(t,e,r)}var set_1=set$1;_export(_export.S,"Array",{isArray:_isArray});var $filter=_arrayMethods(2);_export(_export.P+_export.F*!_strictMethod([].filter,!0),"Array",{filter:function(t){return $filter(this,t,arguments[1])}});var _arrayReduce=function(t,e,r,n,o){_aFunction(e);var a=_toObject(t),i=_iobject(a),c=_toLength(a.length),s=o?c-1:0,u=o?-1:1;if(r<2)for(;;){if(s in i){n=i[s],s+=u;break}if(s+=u,o?s<0:c<=s)throw TypeError("Reduce of empty array with no initial value")}for(;o?s>=0:c>s;s+=u)s in i&&(n=e(n,i[s],s,a));return n};_export(_export.P+_export.F*!_strictMethod([].reduce,!0),"Array",{reduce:function(t){return _arrayReduce(this,t,arguments.length,arguments[1],!1)}});var _invoke=function(t,e,r){var n=void 0===r;switch(e.length){case 0:return n?t():t.call(r);case 1:return n?t(e[0]):t.call(r,e[0]);case 2:return n?t(e[0],e[1]):t.call(r,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(r,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(r,e[0],e[1],e[2],e[3])}return t.apply(r,e)},arraySlice=[].slice,factories={},construct=function(t,e,r){if(!(e in factories)){for(var n=[],o=0;o<e;o++)n[o]="a["+o+"]";factories[e]=Function("F,a","return new F("+n.join(",")+")")}return factories[e](t,r)},_bind=Function.bind||function(t){var e=_aFunction(this),r=arraySlice.call(arguments,1),n=function(){var o=r.concat(arraySlice.call(arguments));return this instanceof n?construct(e,o.length,o):_invoke(e,o,t)};return _isObject(e.prototype)&&(n.prototype=e.prototype),n};_export(_export.P,"Function",{bind:_bind});var $sort=[].sort,test=[1,2,3];_export(_export.P+_export.F*(_fails(function(){test.sort(void 0)})||!_fails(function(){test.sort(null)})||!_strictMethod($sort)),"Array",{sort:function(t){return void 0===t?$sort.call(_toObject(this)):$sort.call(_toObject(this),_aFunction(t))}});var _fixReWks=function(t,e,r){var n=_wks(t),o=r(_defined,n,""[t]),a=o[0],i=o[1];_fails(function(){var e={};return e[n]=function(){return 7},7!=""[t](e)})&&(_redefine(String.prototype,t,a),_hide(RegExp.prototype,n,2==e?function(t,e){return i.call(t,this,e)}:function(t){return i.call(t,this)}))};_fixReWks("replace",2,function(t,e,r){return[function(n,o){var a=t(this),i=null==n?void 0:n[e];return void 0!==i?i.call(n,a,o):r.call(String(a),n,o)},r]});var _flags=function(){var t=_anObject(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};_descriptors&&"g"!=/./g.flags&&_objectDp.f(RegExp.prototype,"flags",{configurable:!0,get:_flags});var TO_STRING="toString",$toString=/./[TO_STRING],define=function(t){_redefine(RegExp.prototype,TO_STRING,t,!0)};_fails(function(){return"/a/b"!=$toString.call({source:"a",flags:"b"})})?define(function(){var t=_anObject(this);return"/".concat(t.source,"/","flags"in t?t.flags:!_descriptors&&t instanceof RegExp?_flags.call(t):void 0)}):$toString.name!=TO_STRING&&define(function(){return $toString.call(this)});var DateProto=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING$1="toString",$toString$1=DateProto[TO_STRING$1],getTime=DateProto.getTime;function peg$subclass(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function peg$SyntaxError(t,e,r,n){this.message=t,this.expected=e,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(t,e){e=void 0!==e?e:{};var r,n={},o={start:Pr},a=Pr,i=Ar("picimo-lang"),c=function(t){return tn(t)},s=Ar("top-level statement"),u=function(t){return t},l=Ar("statement"),f=function(t,e,r,n){return{verb:r,subject:n}},p=function(t,e,r,n){return n.type="declaration",n.name=e,n.declarationType=t,r&&(n.verb=r.verb,n.subject=r.subject),n},_="vertexobject",h=mr("VertexObject",!0),y="primitive",d=mr("Primitive",!0),g="spritegroup",v=mr("SpriteGroup",!0),b=function(t){return t.toLowerCase()},m="instantiates",O=mr("instantiates",!0),A=function(t){return t.toLowerCase()},C=function(t,e,r){return r.name=t,e&&(r.args=e),r},T=function(t,e){return e},S=function(t,e,r){var n={type:"dataBlock",data:tn(r)};return t&&(n.dataType=t),e.length&&e.forEach(en.bind(null,n)),n},P="{",j=mr("{",!1),E="}",x=mr("}",!1),$=Ar("constant statement"),I="=",D=mr("=",!1),w=function(t,e){!function(t,e){Qr.hasOption(t)||Qr.writeOption(t,e)}(t,e)},R=Ar("property-call statement"),F="@",M=mr("@",!1),L=function(t,e){var r={type:"propertyCall",name:t};return e&&(r.args=e),r},N=Ar("property call arguments list"),k="(",G=mr("(",!1),V=",",B=mr(",",!1),K=function(t,e){return e},H=")",z=mr(")",!1),U=function(t,e){return[t].concat(e)},Y=Ar("property call argument"),X=function(t){return t},J=Ar("named arguments list"),q=Ar("named argument"),W=":",Z=mr(":",!1),Q=function(t,e){return{name:t,value:e}},tt=Ar("data statement"),et=function(t,e,r,n){return n},rt=function(t,e,r,n,o,a){return a},nt=function(t,e,r,n,o,a){var i={type:"data",name:t};return e&&(i.args=e),null!=o&&(i.value=o),r&&(i.valueType=r),n.length&&n.forEach(en.bind(null,i)),a.length&&a.forEach(en.bind(null,i)),i},ot=Ar("data value type"),at="float32",it=mr("float32",!1),ct="int32",st=mr("int32",!1),ut="int16",lt=mr("int16",!1),ft="int8",pt=mr("int8",!1),_t="uint32",ht=mr("uint32",!1),yt="uint16",dt=mr("uint16",!1),gt="uint8",vt=mr("uint8",!1),bt=function(t){return t},mt=function(t){return t},Ot="false",At=mr("false",!1),Ct=function(){return!1},Tt="no",St=mr("no",!1),Pt="off",jt=mr("off",!1),Et="true",xt=mr("true",!1),$t=function(){return!0},It="on",Dt=mr("on",!1),wt="yes",Rt=mr("yes",!1),Ft="null",Mt=mr("null",!1),Lt=function(){return null},Nt=function(t){return t},kt=Ar("value array"),Gt=function(t,e){return e},Vt=function(t,e){return[t].concat(e)},Bt=function(t){return t||[]},Kt="[",Ht=mr("[",!1),zt="]",Ut=mr("]",!1),Yt="+",Xt=mr("+",!1),Jt="-",qt=mr("-",!1),Wt=function(t,e){return e.reduce(function(t,e){return"+"===e[1]?t+e[3]:"-"===e[1]?t-e[3]:void 0},t)},Zt="*",Qt=mr("*",!1),te="/",ee=mr("/",!1),re=function(t,e){return e.reduce(function(t,e){return"*"===e[1]?t*e[3]:"/"===e[1]?t/e[3]:void 0},t)},ne=function(t){return t},oe=function(t,e){var r=function(t){return Qr.hasOption(t)?Qr.readOption(t):t}(e);return t?-r:r},ae=Ar("number"),ie=function(){return parseFloat(br())},ce=".",se=mr(".",!1),ue=/^[1-9]/,le=Or([["1","9"]],!1,!1),fe=/^[eE]/,pe=Or(["e","E"],!1,!1),_e="0",he=mr("0",!1),ye=Ar("string"),de=function(t){return t.join("")},ge='"',ve=mr('"',!1),be="\\",me=mr("\\",!1),Oe="b",Ae=mr("b",!1),Ce=function(){return"\b"},Te="f",Se=mr("f",!1),Pe=function(){return"\f"},je="n",Ee=mr("n",!1),xe=function(){return"\n"},$e="r",Ie=mr("r",!1),De=function(){return"\r"},we="t",Re=mr("t",!1),Fe=function(){return"\t"},Me="u",Le=mr("u",!1),Ne=function(t){return String.fromCharCode(parseInt(t,16))},ke=function(t){return t},Ge=/^[^\0-\x1F"\\]/,Ve=Or([["\0",""],'"',"\\"],!0,!1),Be=/^[a-z]/i,Ke=Or([["a","z"]],!1,!0),He=function(t){return br()},ze=function(t,e){return t+(e&&function t(e){return tn(e).reduce(function(e,r){return e+(Array.isArray(r)?t(r):r)},"")}(e)||"")},Ue=/^[_a-z0-9\-]/i,Ye=Or(["_",["a","z"],["0","9"],"-"],!1,!0),Xe=Ar("whitespaces with optional line breaks"),Je=/^[ \t\n\r]/,qe=Or([" ","\t","\n","\r"],!1,!1),We=Ar("whitespaces"),Ze=/^[ \t]/,Qe=Or([" ","\t"],!1,!1),tr=Ar("new line"),er="\n",rr=mr("\n",!1),nr="\r\n",or=mr("\r\n",!1),ar="\r",ir=mr("\r",!1),cr="\f",sr=mr("\f",!1),ur=/^[0-9]/,lr=Or([["0","9"]],!1,!1),fr=/^[0-9a-f]/i,pr=Or([["0","9"],["a","f"]],!1,!0),_r=0,hr=0,yr=[{line:1,column:1}],dr=0,gr=[],vr=0;if("startRule"in e){if(!(e.startRule in o))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=o[e.startRule]}function br(){return t.substring(hr,_r)}function mr(t,e){return{type:"literal",text:t,ignoreCase:e}}function Or(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Ar(t){return{type:"other",description:t}}function Cr(e){var r,n=yr[e];if(n)return n;for(r=e-1;!yr[r];)r--;for(n={line:(n=yr[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return yr[e]=n,n}function Tr(t,e){var r=Cr(t),n=Cr(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Sr(t){_r<dr||(_r>dr&&(dr=_r,gr=[]),gr.push(t))}function Pr(){var t,e,r;if(vr++,t=_r,zr()!==n){for(e=[],r=jr();r!==n;)e.push(r),r=jr();e!==n&&(r=zr())!==n?(hr=t,t=c(e)):(_r=t,t=n)}else _r=t,t=n;return vr--,t===n&&(n,0===vr&&Sr(i)),t}function jr(){var e,r;return vr++,e=_r,(r=function(){var e,r,o,a;vr++,e=_r,(r=Kr())!==n&&Ur()!==n?(61===t.charCodeAt(_r)?(o=I,_r++):(o=n,0===vr&&Sr(D)),o!==n&&Ur()!==n&&(a=Fr())!==n?(hr=e,r=w(r,a),e=r):(_r=e,e=n)):(_r=e,e=n);vr--,e===n&&(r=n,0===vr&&Sr($));return e}())===n&&(r=function(){var e,r,o,a,i,c,s;e=_r,(r=function(){var e,r;return e=_r,t.substr(_r,12).toLowerCase()===_?(r=t.substr(_r,12),_r+=12):(r=n,0===vr&&Sr(h)),r===n&&(t.substr(_r,9).toLowerCase()===y?(r=t.substr(_r,9),_r+=9):(r=n,0===vr&&Sr(d)),r===n&&(t.substr(_r,11).toLowerCase()===g?(r=t.substr(_r,11),_r+=11):(r=n,0===vr&&Sr(v)))),r!==n&&(hr=e,r=b(r)),e=r}())!==n&&Ur()!==n&&(o=Kr())!==n&&Ur()!==n?(a=_r,(i=function(){var e,r;e=_r,t.substr(_r,12).toLowerCase()===m?(r=t.substr(_r,12),_r+=12):(r=n,0===vr&&Sr(O));r!==n&&(hr=e,r=A(r));return e=r}())!==n&&(c=Ur())!==n&&(s=Kr())!==n?(hr=a,i=f(r,o,i,s),a=i):(_r=a,a=n),a===n&&(a=null),a!==n&&(i=Ur())!==n&&(c=xr())!==n?(hr=e,r=p(r,o,a,c),e=r):(_r=e,e=n)):(_r=e,e=n);return e}()),r!==n&&Yr()!==n&&zr()!==n?(hr=e,e=r=u(r)):(_r=e,e=n),vr--,e===n&&(r=n,0===vr&&Sr(s)),e}function Er(){var t,e;return vr++,t=_r,(e=function(){var t,e,r,o;t=_r,(e=Kr())!==n&&Ur()!==n?((r=Dr())===n&&(r=null),r!==n&&Ur()!==n&&(o=xr())!==n?(hr=t,e=C(e,r,o),t=e):(_r=t,t=n)):(_r=t,t=n);return t}())===n&&(e=function(){var t,e,r,o,a,i,c,s,u,l,f;if(vr++,t=_r,(e=Kr())!==n)if(Ur()!==n)if((r=Dr())===n&&(r=null),r!==n)if(Ur()!==n)if((o=Rr())===n&&(o=null),o!==n){for(a=[],i=_r,(c=Ur())!==n&&(s=$r())!==n?(hr=i,c=et(e,r,o,s),i=c):(_r=i,i=n);i!==n;)a.push(i),i=_r,(c=Ur())!==n&&(s=$r())!==n?(hr=i,c=et(e,r,o,s),i=c):(_r=i,i=n);if(a!==n)if((i=Ur())!==n)if((c=Fr())===n&&(c=null),c!==n){for(s=[],u=_r,(l=Ur())!==n&&(f=$r())!==n?(hr=u,l=rt(e,r,o,a,c,f),u=l):(_r=u,u=n);u!==n;)s.push(u),u=_r,(l=Ur())!==n&&(f=$r())!==n?(hr=u,l=rt(e,r,o,a,c,f),u=l):(_r=u,u=n);s!==n?(hr=t,e=nt(e,r,o,a,c,s),t=e):(_r=t,t=n)}else _r=t,t=n;else _r=t,t=n;else _r=t,t=n}else _r=t,t=n;else _r=t,t=n;else _r=t,t=n;else _r=t,t=n;else _r=t,t=n;vr--,t===n&&(e=n,0===vr&&Sr(tt));return t}())===n&&(e=$r()),e!==n&&Yr()!==n&&zr()!==n?(hr=t,t=e=u(e)):(_r=t,t=n),vr--,t===n&&(e=n,0===vr&&Sr(l)),t}function xr(){var e,r,o,a,i,c;if(e=_r,(r=Rr())===n&&(r=null),r!==n){for(o=[],a=_r,(i=Ur())!==n&&(c=$r())!==n?(hr=a,a=i=T(r,c)):(_r=a,a=n);a!==n;)o.push(a),a=_r,(i=Ur())!==n&&(c=$r())!==n?(hr=a,a=i=T(r,c)):(_r=a,a=n);if(o!==n)if((a=function(){var e,r,o,a;e=_r,(r=Ur())!==n?(123===t.charCodeAt(_r)?(o=P,_r++):(o=n,0===vr&&Sr(j)),o!==n&&(a=zr())!==n?e=r=[r,o,a]:(_r=e,e=n)):(_r=e,e=n);return e}())!==n){for(i=[],c=Er();c!==n;)i.push(c),c=Er();i!==n&&(c=function(){var e,r,o,a;e=_r,(r=zr())!==n?(125===t.charCodeAt(_r)?(o=E,_r++):(o=n,0===vr&&Sr(x)),o!==n&&(a=Ur())!==n?e=r=[r,o,a]:(_r=e,e=n)):(_r=e,e=n);return e}())!==n?(hr=e,e=r=S(r,o,i)):(_r=e,e=n)}else _r=e,e=n;else _r=e,e=n}else _r=e,e=n;return e}function $r(){var e,r,o,a;return vr++,e=_r,64===t.charCodeAt(_r)?(r=F,_r++):(r=n,0===vr&&Sr(M)),r!==n&&(o=Kr())!==n&&Ur()!==n?((a=function(){var e,r,o,a,i,c,s;vr++,e=_r,40===t.charCodeAt(_r)?(r=k,_r++):(r=n,0===vr&&Sr(G));if(r!==n)if((o=Ir())!==n){for(a=[],i=_r,44===t.charCodeAt(_r)?(c=V,_r++):(c=n,0===vr&&Sr(B)),c!==n&&Ur()!==n&&(s=Ir())!==n?(hr=i,c=K(o,s),i=c):(_r=i,i=n);i!==n;)a.push(i),i=_r,44===t.charCodeAt(_r)?(c=V,_r++):(c=n,0===vr&&Sr(B)),c!==n&&Ur()!==n&&(s=Ir())!==n?(hr=i,c=K(o,s),i=c):(_r=i,i=n);a!==n?(41===t.charCodeAt(_r)?(i=H,_r++):(i=n,0===vr&&Sr(z)),i!==n?(hr=e,r=U(o,a),e=r):(_r=e,e=n)):(_r=e,e=n)}else _r=e,e=n;else _r=e,e=n;vr--,e===n&&(r=n,0===vr&&Sr(N));return e}())===n&&(a=null),a!==n?(hr=e,e=r=L(o,a)):(_r=e,e=n)):(_r=e,e=n),vr--,e===n&&(r=n,0===vr&&Sr(R)),e}function Ir(){var t,e;return vr++,t=_r,Ur()!==n?((e=Fr())===n&&(e=Kr()),e!==n&&Ur()!==n?(hr=t,t=X(e)):(_r=t,t=n)):(_r=t,t=n),vr--,t===n&&(n,0===vr&&Sr(Y)),t}function Dr(){var e,r,o,a,i,c,s;if(vr++,e=_r,40===t.charCodeAt(_r)?(r=k,_r++):(r=n,0===vr&&Sr(G)),r!==n)if((o=wr())!==n){for(a=[],i=_r,44===t.charCodeAt(_r)?(c=V,_r++):(c=n,0===vr&&Sr(B)),c!==n&&Ur()!==n&&(s=wr())!==n?(hr=i,i=c=K(o,s)):(_r=i,i=n);i!==n;)a.push(i),i=_r,44===t.charCodeAt(_r)?(c=V,_r++):(c=n,0===vr&&Sr(B)),c!==n&&Ur()!==n&&(s=wr())!==n?(hr=i,i=c=K(o,s)):(_r=i,i=n);a!==n?(41===t.charCodeAt(_r)?(i=H,_r++):(i=n,0===vr&&Sr(z)),i!==n?(hr=e,e=r=U(o,a)):(_r=e,e=n)):(_r=e,e=n)}else _r=e,e=n;else _r=e,e=n;return vr--,e===n&&(r=n,0===vr&&Sr(J)),e}function wr(){var e,r,o,a;return vr++,e=_r,Ur()!==n&&(r=Kr())!==n&&Ur()!==n?(58===t.charCodeAt(_r)?(o=W,_r++):(o=n,0===vr&&Sr(Z)),o!==n&&Ur()!==n&&(a=Fr())!==n&&Ur()!==n?(hr=e,e=Q(r,a)):(_r=e,e=n)):(_r=e,e=n),vr--,e===n&&(n,0===vr&&Sr(q)),e}function Rr(){var e,r,o;return vr++,e=_r,58===t.charCodeAt(_r)?(r=W,_r++):(r=n,0===vr&&Sr(Z)),r!==n&&Ur()!==n?(t.substr(_r,7)===at?(o=at,_r+=7):(o=n,0===vr&&Sr(it)),o===n&&(t.substr(_r,5)===ct?(o=ct,_r+=5):(o=n,0===vr&&Sr(st)),o===n&&(t.substr(_r,5)===ut?(o=ut,_r+=5):(o=n,0===vr&&Sr(lt)),o===n&&(t.substr(_r,4)===ft?(o=ft,_r+=4):(o=n,0===vr&&Sr(pt)),o===n&&(t.substr(_r,6)===_t?(o=_t,_r+=6):(o=n,0===vr&&Sr(ht)),o===n&&(t.substr(_r,6)===yt?(o=yt,_r+=6):(o=n,0===vr&&Sr(dt)),o===n&&(t.substr(_r,5)===gt?(o=gt,_r+=5):(o=n,0===vr&&Sr(vt)))))))),o!==n?(hr=e,e=r=bt(o)):(_r=e,e=n)):(_r=e,e=n),vr--,e===n&&(r=n,0===vr&&Sr(ot)),e}function Fr(){var e,r;return e=_r,Ur()!==n?((r=function(){var e,r;e=_r,t.substr(_r,4)===Ft?(r=Ft,_r+=4):(r=n,0===vr&&Sr(Mt));r!==n&&(hr=e,r=Lt());return e=r}())===n&&(r=function(){var e,r;e=_r,t.substr(_r,5)===Ot?(r=Ot,_r+=5):(r=n,0===vr&&Sr(At));r!==n&&(hr=e,r=Ct());(e=r)===n&&(e=_r,t.substr(_r,2)===Tt?(r=Tt,_r+=2):(r=n,0===vr&&Sr(St)),r!==n&&(hr=e,r=Ct()),(e=r)===n&&(e=_r,t.substr(_r,3)===Pt?(r=Pt,_r+=3):(r=n,0===vr&&Sr(jt)),r!==n&&(hr=e,r=Ct()),e=r));return e}())===n&&(r=function(){var e,r;e=_r,t.substr(_r,4)===Et?(r=Et,_r+=4):(r=n,0===vr&&Sr(xt));r!==n&&(hr=e,r=$t());(e=r)===n&&(e=_r,t.substr(_r,2)===It?(r=It,_r+=2):(r=n,0===vr&&Sr(Dt)),r!==n&&(hr=e,r=$t()),(e=r)===n&&(e=_r,t.substr(_r,3)===wt?(r=wt,_r+=3):(r=n,0===vr&&Sr(Rt)),r!==n&&(hr=e,r=$t()),e=r));return e}())===n&&(r=function(){var e,r,o,a,i,c,s,u;if(vr++,e=_r,(r=function(){var e,r,o,a;return e=_r,(r=Ur())!==n?(91===t.charCodeAt(_r)?(o=Kt,_r++):(o=n,0===vr&&Sr(Ht)),o!==n&&(a=zr())!==n?e=r=[r,o,a]:(_r=e,e=n)):(_r=e,e=n),e}())!==n){if(o=_r,(a=Fr())!==n){for(i=[],c=_r,(s=Lr())!==n&&(u=Fr())!==n?(hr=c,s=Gt(a,u),c=s):(_r=c,c=n);c!==n;)i.push(c),c=_r,(s=Lr())!==n&&(u=Fr())!==n?(hr=c,s=Gt(a,u),c=s):(_r=c,c=n);i!==n?(hr=o,a=Vt(a,i),o=a):(_r=o,o=n)}else _r=o,o=n;o===n&&(o=null),o!==n&&(a=function(){var e,r,o,a,i,c;e=_r,(r=zr())!==n?(44===t.charCodeAt(_r)?(o=V,_r++):(o=n,0===vr&&Sr(B)),o===n&&(o=null),o!==n&&(a=zr())!==n?(93===t.charCodeAt(_r)?(i=zt,_r++):(i=n,0===vr&&Sr(Ut)),i!==n&&(c=Ur())!==n?e=r=[r,o,a,i,c]:(_r=e,e=n)):(_r=e,e=n)):(_r=e,e=n);return e}())!==n?(hr=e,r=Bt(o),e=r):(_r=e,e=n)}else _r=e,e=n;vr--,e===n&&(r=n,0===vr&&Sr(kt));return e}())===n&&(r=Mr())===n&&(r=function(){var t,e,r,o;if(vr++,t=_r,(e=Br())!==n){for(r=[],o=Vr();o!==n;)r.push(o),o=Vr();r!==n&&(o=Br())!==n?(hr=t,e=de(r),t=e):(_r=t,t=n)}else _r=t,t=n;vr--,t===n&&(e=n,0===vr&&Sr(ye));return t}()),r!==n&&Ur()!==n?(hr=e,e=mt(r)):(_r=e,e=n)):(_r=e,e=n),e}function Mr(){var e,r;return e=_r,(r=function(){var e,r,o,a,i,c,s,u;if(e=_r,(r=Nr())!==n){for(o=[],a=_r,(i=Ur())!==n?(43===t.charCodeAt(_r)?(c=Yt,_r++):(c=n,0===vr&&Sr(Xt)),c===n&&(45===t.charCodeAt(_r)?(c=Jt,_r++):(c=n,0===vr&&Sr(qt))),c!==n&&(s=Ur())!==n&&(u=Nr())!==n?a=i=[i,c,s,u]:(_r=a,a=n)):(_r=a,a=n);a!==n;)o.push(a),a=_r,(i=Ur())!==n?(43===t.charCodeAt(_r)?(c=Yt,_r++):(c=n,0===vr&&Sr(Xt)),c===n&&(45===t.charCodeAt(_r)?(c=Jt,_r++):(c=n,0===vr&&Sr(qt))),c!==n&&(s=Ur())!==n&&(u=Nr())!==n?a=i=[i,c,s,u]:(_r=a,a=n)):(_r=a,a=n);o!==n?(hr=e,r=Wt(r,o),e=r):(_r=e,e=n)}else _r=e,e=n;return e}())!==n&&(hr=e,r=Nt(r)),e=r}function Lr(){var e,r,o,a;return e=_r,(r=zr())!==n?(44===t.charCodeAt(_r)?(o=V,_r++):(o=n,0===vr&&Sr(B)),o!==n&&(a=zr())!==n?e=r=[r,o,a]:(_r=e,e=n)):(_r=e,e=n),e}function Nr(){var e,r,o,a,i,c,s,u;if(e=_r,(r=kr())!==n){for(o=[],a=_r,(i=Ur())!==n?(42===t.charCodeAt(_r)?(c=Zt,_r++):(c=n,0===vr&&Sr(Qt)),c===n&&(47===t.charCodeAt(_r)?(c=te,_r++):(c=n,0===vr&&Sr(ee))),c!==n&&(s=Ur())!==n&&(u=kr())!==n?a=i=[i,c,s,u]:(_r=a,a=n)):(_r=a,a=n);a!==n;)o.push(a),a=_r,(i=Ur())!==n?(42===t.charCodeAt(_r)?(c=Zt,_r++):(c=n,0===vr&&Sr(Qt)),c===n&&(47===t.charCodeAt(_r)?(c=te,_r++):(c=n,0===vr&&Sr(ee))),c!==n&&(s=Ur())!==n&&(u=kr())!==n?a=i=[i,c,s,u]:(_r=a,a=n)):(_r=a,a=n);o!==n?(hr=e,e=r=re(r,o)):(_r=e,e=n)}else _r=e,e=n;return e}function kr(){var e,r,o,a,i;return e=_r,40===t.charCodeAt(_r)?(r=k,_r++):(r=n,0===vr&&Sr(G)),r!==n&&(o=Ur())!==n&&(a=Mr())!==n&&Ur()!==n?(41===t.charCodeAt(_r)?(i=H,_r++):(i=n,0===vr&&Sr(z)),i!==n?(hr=e,e=r=ne(a)):(_r=e,e=n)):(_r=e,e=n),e===n&&(e=function(){var e,r,o,a;vr++,e=_r,(r=Gr())===n&&(r=null);r!==n&&function(){var e,r,o,a;if((e=function(){var e;return 48===t.charCodeAt(_r)?(e=_e,_r++):(e=n,0===vr&&Sr(he)),e}())===n)if(e=_r,(r=function(){var e;ue.test(t.charAt(_r))?(e=t.charAt(_r),_r++):(e=n,0===vr&&Sr(le));return e}())!==n){for(o=[],a=Xr();a!==n;)o.push(a),a=Xr();o!==n?e=r=[r,o]:(_r=e,e=n)}else _r=e,e=n;return e}()!==n?((o=function(){var e,r,o,a;if(e=_r,(r=function(){var e;return 46===t.charCodeAt(_r)?(e=ce,_r++):(e=n,0===vr&&Sr(se)),e}())!==n){if(o=[],(a=Xr())!==n)for(;a!==n;)o.push(a),a=Xr();else o=n;o!==n?e=r=[r,o]:(_r=e,e=n)}else _r=e,e=n;return e}())===n&&(o=null),o!==n?((a=function(){var e,r,o,a,i;if(e=_r,(r=function(){var e;return fe.test(t.charAt(_r))?(e=t.charAt(_r),_r++):(e=n,0===vr&&Sr(pe)),e}())!==n)if((o=Gr())===n&&(o=function(){var e;43===t.charCodeAt(_r)?(e=Yt,_r++):(e=n,0===vr&&Sr(Xt));return e}()),o===n&&(o=null),o!==n){if(a=[],(i=Xr())!==n)for(;i!==n;)a.push(i),i=Xr();else a=n;a!==n?e=r=[r,o,a]:(_r=e,e=n)}else _r=e,e=n;else _r=e,e=n;return e}())===n&&(a=null),a!==n?(hr=e,r=ie(),e=r):(_r=e,e=n)):(_r=e,e=n)):(_r=e,e=n);vr--,e===n&&(r=n,0===vr&&Sr(ae));return e}())===n&&(e=_r,(r=Gr())===n&&(r=null),r!==n&&(o=Kr())!==n?(hr=e,e=r=oe(r,o)):(_r=e,e=n)),e}function Gr(){var e;return 45===t.charCodeAt(_r)?(e=Jt,_r++):(e=n,0===vr&&Sr(qt)),e}function Vr(){var e,r,o,a,i,c,s,u,l;return(e=function(){var e;Ge.test(t.charAt(_r))?(e=t.charAt(_r),_r++):(e=n,0===vr&&Sr(Ve));return e}())===n&&(e=_r,function(){var e;92===t.charCodeAt(_r)?(e=be,_r++):(e=n,0===vr&&Sr(me));return e}()!==n?(34===t.charCodeAt(_r)?(r=ge,_r++):(r=n,0===vr&&Sr(ve)),r===n&&(92===t.charCodeAt(_r)?(r=be,_r++):(r=n,0===vr&&Sr(me)),r===n&&(47===t.charCodeAt(_r)?(r=te,_r++):(r=n,0===vr&&Sr(ee)),r===n&&(r=_r,98===t.charCodeAt(_r)?(o=Oe,_r++):(o=n,0===vr&&Sr(Ae)),o!==n&&(hr=r,o=Ce()),(r=o)===n&&(r=_r,102===t.charCodeAt(_r)?(o=Te,_r++):(o=n,0===vr&&Sr(Se)),o!==n&&(hr=r,o=Pe()),(r=o)===n&&(r=_r,110===t.charCodeAt(_r)?(o=je,_r++):(o=n,0===vr&&Sr(Ee)),o!==n&&(hr=r,o=xe()),(r=o)===n&&(r=_r,114===t.charCodeAt(_r)?(o=$e,_r++):(o=n,0===vr&&Sr(Ie)),o!==n&&(hr=r,o=De()),(r=o)===n&&(r=_r,116===t.charCodeAt(_r)?(o=we,_r++):(o=n,0===vr&&Sr(Re)),o!==n&&(hr=r,o=Fe()),(r=o)===n&&(r=_r,117===t.charCodeAt(_r)?(o=Me,_r++):(o=n,0===vr&&Sr(Le)),o!==n?(a=_r,i=_r,(c=Jr())!==n&&(s=Jr())!==n&&(u=Jr())!==n&&(l=Jr())!==n?i=c=[c,s,u,l]:(_r=i,i=n),(a=i!==n?t.substring(a,_r):i)!==n?(hr=r,r=o=Ne(a)):(_r=r,r=n)):(_r=r,r=n))))))))),r!==n?(hr=e,e=ke(r)):(_r=e,e=n)):(_r=e,e=n)),e}function Br(){var e;return 34===t.charCodeAt(_r)?(e=ge,_r++):(e=n,0===vr&&Sr(ve)),e}function Kr(){var e,r,o,a,i,c,s,u,l,f;if(e=_r,Be.test(t.charAt(_r))?(r=t.charAt(_r),_r++):(r=n,0===vr&&Sr(Ke)),r!==n){if(o=[],a=_r,46===t.charCodeAt(_r)?(i=ce,_r++):(i=n,0===vr&&Sr(se)),i===n&&(i=null),i!==n)if((c=Hr())!==n){if(s=_r,46===t.charCodeAt(_r)?(u=ce,_r++):(u=n,0===vr&&Sr(se)),u!==n){if(l=[],(f=Hr())!==n)for(;f!==n;)l.push(f),f=Hr();else l=n;l!==n?(hr=s,s=u=He(r)):(_r=s,s=n)}else _r=s,s=n;s===n&&(s=null),s!==n?a=i=[i,c,s]:(_r=a,a=n)}else _r=a,a=n;else _r=a,a=n;for(;a!==n;)if(o.push(a),a=_r,46===t.charCodeAt(_r)?(i=ce,_r++):(i=n,0===vr&&Sr(se)),i===n&&(i=null),i!==n)if((c=Hr())!==n){if(s=_r,46===t.charCodeAt(_r)?(u=ce,_r++):(u=n,0===vr&&Sr(se)),u!==n){if(l=[],(f=Hr())!==n)for(;f!==n;)l.push(f),f=Hr();else l=n;l!==n?(hr=s,s=u=He(r)):(_r=s,s=n)}else _r=s,s=n;s===n&&(s=null),s!==n?a=i=[i,c,s]:(_r=a,a=n)}else _r=a,a=n;else _r=a,a=n;o!==n?(hr=e,e=r=ze(r,o)):(_r=e,e=n)}else _r=e,e=n;return e}function Hr(){var e;return Ue.test(t.charAt(_r))?(e=t.charAt(_r),_r++):(e=n,0===vr&&Sr(Ye)),e}function zr(){var e,r;for(vr++,e=[],Je.test(t.charAt(_r))?(r=t.charAt(_r),_r++):(r=n,0===vr&&Sr(qe));r!==n;)e.push(r),Je.test(t.charAt(_r))?(r=t.charAt(_r),_r++):(r=n,0===vr&&Sr(qe));return vr--,e===n&&(r=n,0===vr&&Sr(Xe)),e}function Ur(){var e,r;for(vr++,e=[],Ze.test(t.charAt(_r))?(r=t.charAt(_r),_r++):(r=n,0===vr&&Sr(Qe));r!==n;)e.push(r),Ze.test(t.charAt(_r))?(r=t.charAt(_r),_r++):(r=n,0===vr&&Sr(Qe));return vr--,e===n&&(r=n,0===vr&&Sr(We)),e}function Yr(){var e,r,o;return vr++,e=_r,(r=Ur())!==n?(10===t.charCodeAt(_r)?(o=er,_r++):(o=n,0===vr&&Sr(rr)),o!==n?e=r=[r,o]:(_r=e,e=n)):(_r=e,e=n),e===n&&(e=_r,(r=Ur())!==n?(t.substr(_r,2)===nr?(o=nr,_r+=2):(o=n,0===vr&&Sr(or)),o!==n?e=r=[r,o]:(_r=e,e=n)):(_r=e,e=n),e===n&&(e=_r,(r=Ur())!==n?(13===t.charCodeAt(_r)?(o=ar,_r++):(o=n,0===vr&&Sr(ir)),o!==n?e=r=[r,o]:(_r=e,e=n)):(_r=e,e=n),e===n&&(e=_r,(r=Ur())!==n?(12===t.charCodeAt(_r)?(o=cr,_r++):(o=n,0===vr&&Sr(sr)),o!==n?e=r=[r,o]:(_r=e,e=n)):(_r=e,e=n)))),vr--,e===n&&(r=n,0===vr&&Sr(tr)),e}function Xr(){var e;return ur.test(t.charAt(_r))?(e=t.charAt(_r),_r++):(e=n,0===vr&&Sr(lr)),e}function Jr(){var e;return fr.test(t.charAt(_r))?(e=t.charAt(_r),_r++):(e=n,0===vr&&Sr(pr)),e}var qr,Wr,Zr,Qr=e.ctx;function tn(t){return t.filter(function(t){return Boolean(t)})}function en(t,e){t.annotations||(t.annotations=[]),t.annotations.push(e)}if((r=a())!==n&&_r===t.length)return r;throw r!==n&&_r<t.length&&Sr({type:"end"}),qr=gr,Wr=dr<t.length?t.charAt(dr):null,Zr=dr<t.length?Tr(dr,dr+1):Tr(dr,dr),new peg$SyntaxError(peg$SyntaxError.buildMessage(qr,Wr),qr,Wr,Zr)}new Date(NaN)+""!=INVALID_DATE&&_redefine(DateProto,TO_STRING$1,function(){var t=getTime.call(this);return t==t?$toString$1.call(this):INVALID_DATE}),peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(t,e){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+n(t)})}return"Expected "+function(t){var e,n,o,a=new Array(t.length);for(e=0;e<t.length;e++)a[e]=(o=t[e],r[o.type](o));if(a.sort(),a.length>0){for(e=1,n=1;e<a.length;e++)a[e-1]!==a[e]&&(a[n]=a[e],n++);a.length=n}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."};var parse=peg$parse,_objectSap=function(t,e){var r=(_core.Object||{})[t]||Object[t],n={};n[t]=e(r),_export(_export.S+_export.F*_fails(function(){r(1)}),"Object",n)};_objectSap("keys",function(){return function(t){return _objectKeys(_toObject(t))}});var $map=_arrayMethods(1);function compact(t){for(var e=-1,r=null==t?0:t.length,n=0,o=[];++e<r;){var a=t[e];a&&(o[n++]=a)}return o}_export(_export.P+_export.F*!_strictMethod([].map,!0),"Array",{map:function(t){return $map(this,t,arguments[1])}});var compact_1=compact,$find=_arrayMethods(5),KEY="find",forced=!0;KEY in[]&&Array(1)[KEY](function(){forced=!1}),_export(_export.P+_export.F*forced,"Array",{find:function(t){return $find(this,t,arguments.length>1?arguments[1]:void 0)}}),_addToUnscopables(KEY);var _FACTORIES,DATA="data",DATA_BLOCK="dataBlock",DECLARATION="declaration",PROPERTY_CALL="propertyCall",findPropertyCall=function(t,e,r){if(t){var n=t.find(function(t){var r=t.type,n=t.name;return r===PROPERTY_CALL&&n===e});return void 0!==n&&r&&r(n),n}},hasPropertyCall=function(t,e){return Boolean(findPropertyCall(t,e))},firstPropertyCallArg=function(t,e){return get(findPropertyCall(t,e),"args[0]")},setByFirstPropertyCallArg=function(t,e,r,n){return findPropertyCall(r,n||e,function(r){t[e]=get(r,"args[0]")})},readFlag=function(t,e){return null==t?e:!t.args||1!==t.args.length||Boolean(t.args[0])},setFlagByPropertyCall=function(t,e,r){var n=findPropertyCall(e,r);void 0!==n&&(t[r]=readFlag(n))},findNamedArgument=function(t,e,r){return t&&t.find(function(t){var n=t.name,o=t.value,a=n===e;return a&&r&&r(o),a})},setByNamedArgument=function(t,e,r){return findNamedArgument(t,r,function(t){e[r]=t})},findData=function(t,e,r){return t&&t.find(function(t){var n=t.name===e;return n&&r&&r(t),n})},attachDataValue=function(t,e,r){return findData(e,r,function(e){var n=e.value;return Object.assign(t,_defineProperty({},r,n))})},attachDataValues=function(t,e,r){return r.forEach(attachDataValue.bind(null,t,e))},parseVoDefaultValues=function(t){return function(e,r){void 0!==r&&(Array.isArray(r)?r.forEach(function(r,n){t["".concat(e).concat(n)]=r}):t[e]=r)}},readOption=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e.reduce(function(e,r){if("function"==typeof r){var n=r(t);return void 0!==n?n:e}return r&&t in r?r[t]:e},r)}},assignOptions=function(t,e,r,n){return e.forEach(function(e){var o=r(e);n&&"string"==typeof o&&(o=n(o)),void 0!==o&&(t[e]=o)}),t},DEFAULT_ATTR_TYPE="float32",create=function(t){var e=t.declaration,r=t.ctx,n=t.options,o="instantiates"===e.verb?r.create(e.subject):void 0,a=e.voDescriptor,i=n||a.proto;return new VODescriptor(_objectSpread({},a,{instanceOf:o,proto:"string"==typeof i?r.readOption(i):i}))},transform=function(t){var e={},r={},n=parseVoDefaultValues(e),o={voDescriptor:{vertexCount:firstPropertyCallArg(t.data,"vertexCount"),attributes:compact_1(t.data.filter(function(t){var e=t.type;return e===DATA||e===DATA_BLOCK}).map(function(t){var e=findPropertyCall(t.annotations,"alias");if(e&&e.args&&"string"==typeof e.args[0])return r[t.name]=e.args[0],null;var o={name:t.name};return t.type===DATA?(o.type=t.valueType||DEFAULT_ATTR_TYPE,findNamedArgument(t.args,"size",function(t){o.size=t})):t.type===DATA_BLOCK&&(o.type=t.dataType||DEFAULT_ATTR_TYPE,o.scalars=t.data.filter(function(t){return t.type===DATA}).map(function(t){var e=t.name,r=t.value;return n(e,r),e}),o.size=o.scalars.length),hasPropertyCall(t.annotations,"uniform")&&(o.uniform=!0),n(t.name,t.value),e?(findNamedArgument(t.args,"offset",function(t){o.offset=t}),r[t.name]=o,null):o}))}};return Object.keys(r).length&&(o.voDescriptor.aliases=r),Object.keys(e).length&&(o.voNew=e),findPropertyCall(t.data,"prototype",function(t){var e=t.args;o.voDescriptor.proto=e[0]}),o},VertexObject=Object.freeze({create:create,transform:transform}),create$1=function(t){var e=t.declaration,r=t.options;if(e.generate)return new IndexedPrimitive(e.primitiveType,ElementIndexArray.Generate(r.capacity,e.indices,e.stride,e.offset));console.warn("TODO implementation: Primitive with(out) @generate(no)")},transform$1=function(t){var e=t.data,r={primitiveType:firstPropertyCallArg(e,"type")};return hasPropertyCall(e,"generate")&&(r.generate=!0),attachDataValues(r,e,["stride","offset","indices"]),r},Primitive=Object.freeze({create:create$1,transform:transform$1}),createPrimitive=function(t,e,r){switch(_typeof(e)){case"string":return t.create(e,{capacity:r});default:return e}},create$2=function(t){var e=t.ctx,r=t.declaration,n=t.options,o=void 0===n?{}:n,a=r.voDescriptor,i=o[a],c=r[a],s=e.readOption.bind(e),u=assignOptions({},["autotouch","capacity","doubleBuffer","maxAllocVOSize","usage"],readOption(r,c,o,i));assignOptions(u,["setSize","setTexCoordsByTexture"],readOption(r,c,o,i),readOption(s,o,i)),u.primitive=createPrimitive(e,r.primitive,u.capacity),assignOptions(u,["vertexShader","fragmentShader","shaderProgram"],readOption(r,o),readOption(s));var l=assignOptions({},["prototype"],readOption(c,i),readOption(s,o)).prototype,f=e.create(a,l);return new SpriteGroup(f,u)},readVoPoolOptions=function(t){var e={};return findPropertyCall(t,"dynamic",function(t){e.usage=readFlag(t,!0)?"dynamic":"static"}),setFlagByPropertyCall(e,t,"doubleBuffer"),setFlagByPropertyCall(e,t,"autotouch"),setFlagByPropertyCall(e,t,"textured"),setByFirstPropertyCallArg(e,"setSize",t),setByFirstPropertyCallArg(e,"setTexCoordsByTexture",t),setByFirstPropertyCallArg(e,"prototype",t),attachDataValue(e,t,"capacity"),attachDataValue(e,t,"maxAllocVOSize"),findData(t,"textures",function(t){if(t&&t.type===DATA_BLOCK){var r={};e.textureMap=r,t.data.forEach(function(t){var e=t.name,n=t.value,o=t.annotations,a=t.args,i={};r[e]={hints:i,src:n,type:hasPropertyCall(o,"atlas")?"atlas":"texture"},setByNamedArgument(a,i,"flipY"),setByNamedArgument(a,i,"repeatable"),setByNamedArgument(a,i,"premultiplyAlpha"),setByNamedArgument(a,i,"nearest")})}}),e},transform$2=function(t){var e=t.data,r=firstPropertyCallArg(e,"vertexObject"),n={voDescriptor:r,primitive:firstPropertyCallArg(e,"primitive")};return setByFirstPropertyCallArg(n,"vertexShader",e),setByFirstPropertyCallArg(n,"fragmentShader",e),setByFirstPropertyCallArg(n,"shaderProgram",e),Object.assign(n,readVoPoolOptions(e)),r&&findData(e,r,function(t){Object.assign(n,_defineProperty({},r,readVoPoolOptions(t.data,{})))}),n},SpriteGroup$1=Object.freeze({create:create$2,transform:transform$2}),VERTEX_OBJECT="vertexobject",PRIMITIVE="primitive",SPRITE_GROUP="spritegroup",FACTORIES=(_defineProperty(_FACTORIES={},VERTEX_OBJECT,VertexObject),_defineProperty(_FACTORIES,PRIMITIVE,Primitive),_defineProperty(_FACTORIES,SPRITE_GROUP,SpriteGroup$1),_FACTORIES),log=getLogger("picimo.toolkit.Context"),getFactory=function(t){var e=FACTORIES[t];return t||log.error("Context: unknown declaration type:",t),e},transformDeclaration=function(t){var e=getFactory(t.declarationType);return e?e.transform(t):t},createInstanceFromDeclaration=function(t,e,r){var n=get(t.declaration,e);if(n){var o=getFactory(n.declarationType);return o?o.create({ctx:t,name:e,declaration:n,options:r}):null}},pickDeclaration=pick(["declarationType","verb","subject"]),Context=function(){function t(e){_classCallCheck(this,t),this.config=Object.assign({},e),this.declaration={}}return _createClass(t,[{key:"hasOption",value:function(t){return has_1(this.config,t)}},{key:"readOption",value:function(t){return get(this.config,t)}},{key:"writeOption",value:function(t,e){set_1(this.config,t,e)}},{key:"configure",value:function(t){return Object.assign(this.config,t),this}},{key:"compile",value:function(t,e){var r=this;return e&&this.configure(e),parse(t,{ctx:this}).forEach(function(t){t.type===DECLARATION&&set_1(r.declaration,t.name,Object.assign(transformDeclaration(t),pickDeclaration(t)))}),this}},{key:"create",value:function(t,e){return createInstanceFromDeclaration(this,t,e)}}]),t}(),configure=function(t){return new Context(t)},compile=function(t,e){return new Context(e).compile(t)};export{compile,configure,Context};
//# sourceMappingURL=picimo-toolkit.js.map
